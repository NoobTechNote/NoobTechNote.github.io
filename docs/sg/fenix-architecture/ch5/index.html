<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-sg/fenix-architecture/ch5">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Ch5: 架構安全性 | Noob Tech Note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch5"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ch5: 架構安全性 | Noob Tech Note"><meta data-rh="true" name="description" content="在軟體系統設計中，如何讓應用能夠在各種環境中安全高效的訪問是個複雜的問題，而計算機系統安全，不只是免於「防禦系統不被駭客攻擊」，並至少包括以下問題的解決方案。"><meta data-rh="true" property="og:description" content="在軟體系統設計中，如何讓應用能夠在各種環境中安全高效的訪問是個複雜的問題，而計算機系統安全，不只是免於「防禦系統不被駭客攻擊」，並至少包括以下問題的解決方案。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch5"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch5" hreflang="en"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch5" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.40771ce4.css">
<link rel="preload" href="/assets/js/runtime~main.8ee15afe.js" as="script">
<link rel="preload" href="/assets/js/main.302dd2ef.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Noob Tech Note</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/sg">Study Group</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/sg/">Study Group Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Study Group Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/clean-architecture/">Clean Architecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Clean Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/sg/fenix-architecture/">鳳凰架構</a><button aria-label="Toggle the collapsible sidebar category &#x27;鳳凰架構&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch0">Ch0: 前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch1">Ch1: 服務架構演進史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch2">Ch2: 存取遠端服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch3">Ch3: 交易處理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4">Ch4: 透明多級分流系統</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4.5-6">Ch4.5~6: 負載均衡和服務端緩存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/sg/fenix-architecture/ch5">Ch5: 架構安全性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch6">Ch6: 分佈式共識算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch7">Ch7: 從函式庫到服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch8">Ch8: 流量治理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch9">Ch9: 可靠通信</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch10">Ch10: 可觀測性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch11">Ch11: 虛擬化容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch12">Ch12: 容器間網路</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch13">Ch13: 持久化存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch14">Ch14: 資源與調度</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch15">Ch15: 服務網格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch16">Ch16: 向微服務邁進</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/five-lines-of-code/">五行程式碼規則</a><button aria-label="Toggle the collapsible sidebar category &#x27;五行程式碼規則&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/fundamentals-of-software-architecture/">軟體架構原理 - 工程方法</a><button aria-label="Toggle the collapsible sidebar category &#x27;軟體架構原理 - 工程方法&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/web-api-the-good-parts/">Web API: The Good Parts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web API: The Good Parts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/"><span itemprop="name">Study Group Notes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/fenix-architecture/"><span itemprop="name">鳳凰架構</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ch5: 架構安全性</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ch5: 架構安全性</h1></header><p>在軟體系統設計中，如何讓應用能夠在各種環境中安全高效的訪問是個複雜的問題，而計算機系統安全，不只是免於「防禦系統不被駭客攻擊」，並至少包括以下問題的解決方案。</p><p>以下皆使用系統安全的標準方案來逐一探討處理方法，並以 <a href="http://icyfenix.cn/exploration/projects/" target="_blank" rel="noopener noreferrer">Fenix&#x27;s Bookstore</a> 作為案實踐。</p><ul><li>認證（Authentication）：系統如何正確分辨出操作用戶的真實身份？</li><li>授權（ Authorization）：系統如何控制一個用戶該看到哪些數據、能操作哪些功能？</li><li>憑證（Credential）：系統如何保證它與用戶之間的承諾是雙方當時真實意圖的體現，是準確、完整且不可抵賴的？</li><li>保密（Confidentiality）：系統如何保證敏感數據無法被包括系統管理員在內的內外部人員所竊取、濫用？</li><li>傳輸（Transport Security）：系統如何保證通過網絡傳輸的信息無法被第三方竊聽、篡改和冒充？</li><li>驗證（Verification）：系統如何確保提交到每項服務中的數據是合乎規則的，不會對系統穩定性、數據一致性、正確性產生風險？</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="51-認證authentication">5.1 <a href="http://icyfenix.cn/architect-perspective/general-architecture/system-security/authentication" target="_blank" rel="noopener noreferrer">認證</a>（Authentication）<a href="#51-認證authentication" class="hash-link" aria-label="Direct link to 51-認證authentication" title="Direct link to 51-認證authentication">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>系统如何正確分辨出操作用戶的真實身份？系統如何辨認“你”？</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="511-認證標準">5.1.1 認證標準<a href="#511-認證標準" class="hash-link" aria-label="Direct link to 5.1.1 認證標準" title="Direct link to 5.1.1 認證標準">​</a></h3><p>此架構安全的經驗原則包含兩部分：</p><ol><li>以標準規費為指導、以標準接口實現</li><li>內置的 Basic、Digest、Form 和 Client-Cert。四種認證方案分別覆蓋以下三種認證：<ol><li>通信信道上的認證：你和我建立通信連接之前，要先證明你是誰。在網絡傳輸（Network）場景中的典型是基於 SSL/TLS 傳輸安全層的認證。</li><li>通信協議上的認證：你請求獲取我的資源之前，要先證明你是誰。在互聯網（Internet）場景中的典型是基於 HTTP 協議的認證。</li><li>通信內容上的認證：你使用我提供的服務之前，要先證明你是誰。在萬維網（World Wide Web）場景中的典型是基於 Web 內容的認證。</li></ol></li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-http-認證">1. HTTP 認證<a href="#1-http-認證" class="hash-link" aria-label="Direct link to 1. HTTP 認證" title="Direct link to 1. HTTP 認證">​</a></h4><blockquote><p><strong>認證方案（Authentication Schemes)</strong> ：它是指生成用戶身份憑證的某種方法，這個概念最初源於 HTTP 協議的認證框架（Authentication Framework）。
<strong>目的</strong>：把「要產生身份憑證」的目的與「具體如何產生憑證」的實現分離開來。</p></blockquote><p><strong>IETF <a href="https://tools.ietf.org/html/rfc7235" target="_blank" rel="noopener noreferrer">RFC 7235</a></strong></p><ol><li>所有支持 HTTP 協議的服務器，在未授權的用戶意圖訪問服務端保護區域的資源時，應返回 401 Unauthorized 的狀態碼</li><li>在響應報文頭里附帶以下兩個分別代表<strong>網頁認證</strong>和<strong>代理認證</strong>的 Header 之一</li></ol><p>Response Header</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WWW-Authenticate: &lt;認證方案&gt; realm=&lt;保護區域的描述信息&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Proxy-Authenticate: &lt;認證方案&gt; realm=&lt;保護區域的描述信息&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Request Header</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: &lt;認證方案&gt; &lt;憑證內容&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Proxy-Authorization: &lt;認證方案&gt; &lt;憑證內容&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="圖 5-1. HTTP 認證框架的工作流程時序圖" src="/assets/images/5-1-7920bd4f6d39595eb4bcbed387eb89d1.png" width="930" height="908" class="img_ev3q">
<em>圖 5-1. HTTP 認證框架的工作流程時序圖</em></p><blockquote><p><strong>HTTP Basic 認證</strong>
以演示為目的且應用於一些不要求安全性的場合。（例如：家中路由器登錄等）
方法：讓用戶輸入用戶名和密碼，經過 Base64 編碼“加密”後作為身份憑證</p></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 401 Unauthorized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Mon, 24 Feb 2020 16:50:53 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WWW-Authenticate: Basic realm=&quot;example from icyfenix.cn&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>上為：請求資源 GET/admin 後瀏覽器收到的 Server Response</em></p><p><img loading="lazy" alt="圖 5-2 HTTP Basic 認證對話框" src="/assets/images/5-2-3b459af580cc10a39a4a6966f5fff637.png" width="761" height="519" class="img_ev3q">
<em>圖 5-2 HTTP Basic 認證對話框</em></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /admin HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Basic aWN5ZmVuaXg6MTIzNDU2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>上為：HTTP Request</em></p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>注意 Base64 只是一種編碼方式，並非任何形式的加密，因此 Base64 認證是有風險的。</p></div></div><p>除了 Basic 認證之外，IETF 定義如下三種認證方案：</p><ol><li>Digest：<a href="https://www.rfc-editor.org/rfc/rfc7616" target="_blank" rel="noopener noreferrer">RFC 7616</a>，HTTP 摘要認證，Basic 認證的改良版本，針對 Base64 明文發送的風險，Digest 認證把用戶名和密碼加鹽（一個被稱為 Nonce 的變化值作為鹽值）後再通過 MD5/SHA 等哈希算法取摘要發送出去</li><li>Bearer：<a href="https://www.rfc-editor.org/rfc/rfc6750" target="_blank" rel="noopener noreferrer">RFC 6750</a>，基於 OAuth 2 規範來完成認證，OAuth2 是一個同時涉及認證與授權的協議，在“授權”小節將詳細介紹 OAuth 2</li><li>HOBA：<a href="https://www.rfc-editor.org/rfc/rfc7486" target="_blank" rel="noopener noreferrer">RFC 7486</a> ，HOBA（HTTP Origin-Bound Authentication）是一種基於自簽名證書的認證方案。<ul><li>採用 CA（Certification Authority）層次結構的模型，由 CA 中心簽發證書</li><li>以 IETF 的 Token Binding 協議為基礎的 OBC（Origin Bound Certificate）自簽名證書模型</li></ul></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>何謂“加鹽”？
是指在雜湊之前將雜湊內容（例如：密碼）的任意固定位置插入特定的字串。 這個在雜湊中加入字串的方式稱為「加鹽」。</p><p><img loading="lazy" alt="加鹽流程" src="/assets/images/salt-13f815d9cec882670e675d6943bb4640.jpeg" width="600" height="283" class="img_ev3q"></p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-web-認證">2. <strong>Web 認證</strong><a href="#2-web-認證" class="hash-link" aria-label="Direct link to 2-web-認證" title="Direct link to 2-web-認證">​</a></h4><p><strong>HTTP (HyperText Transfer Protocol，超文本傳輸協議)</strong>：把資源從 Server 端傳輸到 Client 端，資源內容須由 Client 自行解析驅動。</p><ol><li>IETF 為 HTTP 認證框架設計“可插拔 (Pluggable) 的認證方案。</li><li>依靠內容而不是傳輸協議來實現的認證方案，也稱<mark>表單認證</mark>（Form Authentication）</li><li>表單認證與 HTTP 認證可以結合使用<blockquote><p>以 Fenix&#x27;s Bookstore 的登錄功能為例：頁面表單是自行設計的 Vue.js 頁面；認證的整個交互過程遵循 OAuth 2 規範的密碼模式</p></blockquote></li></ol><p><img loading="lazy" alt="圖 5-3 不同瀏覽器上使用 WebAuthn 登錄的對比" src="/assets/images/5-3-94e919177d78e863d32bd514055093f7.png" width="1067" height="583" class="img_ev3q">
<em>圖 5-3 不同瀏覽器上使用 WebAuthn 登錄的對比</em></p><p><img loading="lazy" alt="圖 5-4 註冊流程步驟" src="/assets/images/5-4-a261cce67e905d7a36c366f4e1f1bcea.png" width="1994" height="1336" class="img_ev3q">
<em>圖 5-4 註冊流程步驟圖</em></p><p><strong>註冊流程步驟</strong></p><ol><li>用戶進入系統的註冊頁面 （此不包含在 WebAuthn 標準定義範圍內)</li><li>用戶訊息填完後，點擊送出按鈕後，Server 先暫存用戶所提交的數據生成隨機字串(稱作 Challenge)和用戶的 UserID，並返回 Client 端傳輸到</li><li>Client 端的 WebAuthn API 接收到 Challenge 和 UserID 後把訊息發送給驗證器 (Authenticator)</li><li>Authenticator 提示用戶進行驗證，驗證結果生成一個密鑰對，由 Authenticator 儲存私鑰、用戶訊息及當前域名。使用私鑰對 Challenge 進行簽名，並將結果、UserID 和公鑰一起返回 Client 端傳輸到</li><li>瀏覽器將 Authenticator 返回結果轉發給 Server</li><li>Server 檢驗訊息，若註冊通過，由 Server 儲存 UserID 對應的公鑰</li></ol><p><strong>登錄流程步驟</strong></p><ol><li>用戶訪問登錄頁面，填入 UserID 並按下登錄按鈕</li><li>Server 返回隨機字串 Challenge、UserID</li><li>瀏覽器將 Challenge 和 UserID 轉發給 Authenticator</li><li>Authenticator 提示用戶進行操作</li><li>Server 接收到瀏覽器轉發來被私鑰加密的 Challenge，與註冊時儲存公鑰進行解密，解密成功及登錄成功</li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>WebAuthn 採用非對稱加密的公私鑰替代傳統密碼，私鑰是保密的且只有 Authenticator 知道。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="512-認證的實現-介紹在-java-中如何實現">5.1.2 認證的實現 （介紹在 Java 中如何實現）<a href="#512-認證的實現-介紹在-java-中如何實現" class="hash-link" aria-label="Direct link to 5.1.2 認證的實現 （介紹在 Java 中如何實現）" title="Direct link to 5.1.2 認證的實現 （介紹在 Java 中如何實現）">​</a></h3><ol><li><p>Java 1.3 時代，由 Sun 公司提出的同時面向代碼級安全和用戶級安全的認證授權服務——<mark>JAAS</mark>（Java Authentication and Authorization Service，Java 認證和授權服務，Java 1.3 處於擴展包中，Java 1.4 時納入標準包）</p><ul><li>此時期定義的 API<ul><li>LoginModule （javax.security.auth.spi.LoginModule）</li><li>LoginContext （javax.security.auth.login.LoginContext）</li><li>Subject （javax.security.auth.Subject）</li><li>Principal （java.security.Principal）</li><li>Credentials（javax.security.auth.Destroyable、javax.security.auth.Refreshable）</li></ul></li></ul></li><li><p>現今常用的為兩個私有的（私有的意思是不由 JSR 所規範的，即沒有 java/javax.<!-- -->*<!-- -->作為包名的）的安全框架：<mark><a href="https://shiro.apache.org/" target="_blank" rel="noopener noreferrer">Apache Shiro</a></mark> 和 <mark><a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener noreferrer">Spring Security</a></mark></p><ul><li>此兩種安全框架所提供的功能<ul><li>認證功能：以 HTTP 協議中定義的各種認證、表單等認證方式確認用戶身份，這是本節的主要話題</li><li>安全上下文：用戶獲得認證之後，要開放一些接口，讓應用可以得知該用戶的基本資料、用戶擁有的權限、角色，等等</li><li>授權功能：判斷並控制認證後的用戶對什麼資源擁有哪些操作許可，這部分內容會放到“授權”介紹</li><li>密碼的存儲與驗證：密碼是燙手的山芋，存儲、傳輸還是驗證都應謹慎處理，我們會放到“保密”去具體討論</li></ul></li></ul></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="52-授權authorization">5.2 授權（Authorization）<a href="#52-授權authorization" class="hash-link" aria-label="Direct link to 5.2 授權（Authorization）" title="Direct link to 5.2 授權（Authorization）">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>系統如何控制一個用戶該看到哪些數據、能操作哪些功能？
AAAA (Authentication、Authorization、Audit、Account)：認證、授權、審計、帳號</p></div></div><p><strong>安全領域中的授權</strong></p><ol><li>確保授權的過程可靠<ul><li>單一系統：授權過程比較容易控制</li><li>多方系統：授權過程較困難，常用授權協議有 <mark>OAuth 2</mark> 和 <mark>SAML 2.0</mark></li></ul></li><li>確保授權的結果可控：授權的結果用於對程序功能或者資源的<a href="https://en.wikipedia.org/wiki/Access-control_list" target="_blank" rel="noopener noreferrer">訪問控制</a>（Access Control）<ul><li>自主訪問控制（Discretionary Access Control，DAC）</li><li>強制訪問控制（Mandatory Access Control，MAC）</li><li>基於屬性的訪問控制（Attribute-Based Access Control，ABAC）</li><li>基於角色的訪問控制（Role-Based Access Control，RBAC）<strong>最常用</strong></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="521-rbac-role-based-access-control基於角色的訪問控制">5.2.1 RBAC （Role-Based Access Control，基於角色的訪問控制)<a href="#521-rbac-role-based-access-control基於角色的訪問控制" class="hash-link" aria-label="Direct link to 5.2.1 RBAC （Role-Based Access Control，基於角色的訪問控制)" title="Direct link to 5.2.1 RBAC （Role-Based Access Control，基於角色的訪問控制)">​</a></h3><p><strong>目的：管理垂直和水平權限</strong></p><ul><li>垂直權限：功能權限，某個角色完成某項操作的許可<ul><li>例如：審稿編輯有通過審核的權限、出納有從帳戶提取資金的權限</li></ul></li><li>水平權限：數據權限，只能由訊息系統自主完成，不存在通用數據權限框架<ul><li>例如：A、B 都屬於同一個角色，但各自在系統中產生的數據完全有可能是私有的，A 訪問或是刪除 B 的數據即屬越權</li></ul></li></ul><p><img loading="lazy" alt="圖 5-5 RBAC 的主要元素的關係示意圖" src="/assets/images/5-5-e18bcbecd3259bb8a7849a686b3e24dc.png" width="1524" height="172" class="img_ev3q">
<em>圖 5-5 RBAC 的主要元素的關係示意圖</em></p><blockquote><p>說明</p><ul><li>角色：解耦用戶與權限之間的多對多關係</li><li>許可：允許何種操作作用於哪些資源之上，解耦操作與資源之間的多對多關係（不同數據都能有增、刪、改等操作)</li></ul></blockquote><p>優點：</p><ul><li>簡化配置操作</li><li>滿足計算機安全中的“最小特權原則” (Least Privilege)，角色擁有許可數量根據完成該角色工作職責所需的最小權限來賦予</li><li>不同角色之間定義關聯與約束關係<ul><li>繼承關係（RBAC-1 模型)：角色權限繼承關係，例如：開發經理和開發人員一樣有代碼提交權限，開發人員和任何員工都有食堂就餐權限，</li><li>互斥關係 (RBAC-1 模型)：角色職責分離關係，例如：不能同時一個人當會計也當出納</li></ul></li></ul><p><img loading="lazy" alt="圖 5-6 Spring Security 的訪問控制模型" src="/assets/images/5-6-ae505c5530106ee2939dad8a47718573.png" width="1780" height="368" class="img_ev3q">
<em>圖 5-6 Spring Security 的訪問控制模型</em></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>角色和權限的核心差異取決於用戶打算如何使用這些特性，在框架層面他們的差別是極小的，基本採用了完全相同的方式來進行處理。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="522-oauth-2-認證授權協議">5.2.2 OAuth 2 認證授權協議<a href="#522-oauth-2-認證授權協議" class="hash-link" aria-label="Direct link to 5.2.2 OAuth 2 認證授權協議" title="Direct link to 5.2.2 OAuth 2 認證授權協議">​</a></h3><p>提出以令牌(Token)代替用戶密碼作為授權憑證，解決把用戶賬號和密碼都告訴 Travis-CI 而產生的密碼洩漏、訪問範圍及授權回收問題</p><p><img loading="lazy" alt="圖 5-7 加 Token 後的授權流程示意圖" src="/assets/images/5-7-f46d4f2c2cbe840a0d12d45e043b1b68.png" width="1692" height="788" class="img_ev3q">
<em>圖 5-7 加 Token 後的授權流程示意圖</em></p><ol><li>第三方應用（Third-Party Application）：需要得到授權訪問我資源的那個應用，即此場景中的“Travis-CI”</li><li>授權服務器（Authorization Server）：能夠根據我的意願提供授權（授權之前肯定已經進行了必要的認證過程，但它與授權可以沒有直接關係）的服務器，即此場景中的“GitHub”</li><li>資源服務器（Resource Server）：能夠提供第三方應用所需資源的服務器，它與認證服務可以是相同的服務器，也可以是不同的服務器，此場景中的“我的代碼倉庫”</li><li>資源所有者（Resource Owner）： 擁有授權權限的人，即此場景中的“我”</li><li>操作代理（User Agent）：指用戶用來訪問服務器的工具，對於人類用戶來說，這個通常是指瀏覽器，但在微服務中一個服務經常會作為另一個服務的用戶，此時指的可能就是 HttpClient、RPCClient 或者其他訪問途徑</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="授權碼模式authorization-code">授權碼模式（Authorization Code）<a href="#授權碼模式authorization-code" class="hash-link" aria-label="Direct link to 授權碼模式（Authorization Code）" title="Direct link to 授權碼模式（Authorization Code）">​</a></h4><p><img loading="lazy" alt="圖 5-8 授權碼模式的調用時序圖" src="/assets/images/5-8-8124d851e9c7746251bea81a5cd6e892.png" width="2104" height="1186" class="img_ev3q">
<em>圖 5-8 授權碼模式的調用時序圖</em></p><p>OAuth 2 設計用意：</p><ol><li>會不會有其他應用冒充第三方應用騙取授權？</li><li>為什麼要先發放授權碼再用授權碼換令牌？</li><li>為什麼要設計一個實現較長的刷新令牌和實現較短的訪問令牌？不能直接把訪問令牌時間調長嗎？</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="隱式授權模式implicit">隱式授權模式（Implicit）<a href="#隱式授權模式implicit" class="hash-link" aria-label="Direct link to 隱式授權模式（Implicit）" title="Direct link to 隱式授權模式（Implicit）">​</a></h4><ol><li>省略通過授權馬換 Token 的步驟，授權過程中不需要服務端支持</li><li>限制第三方應用的 URI 地址必須與註冊時提供的域名一致</li><li>RFC 6749：Token 必須是“通過 Fragment 帶回” （Fragment, 地址中 “#” 號後面的部分)</li></ol><p><img loading="lazy" alt="圖 5-9 隱式授權的調用時序圖" src="/assets/images/5-9-3224b31eea6b6823a82fe0c263864307.png" width="1772" height="786" class="img_ev3q">
<em>圖 5-9 隱式授權的調用時序圖</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="密碼模式resource-owner-password-credentials">密碼模式（Resource Owner Password Credentials）<a href="#密碼模式resource-owner-password-credentials" class="hash-link" aria-label="Direct link to 密碼模式（Resource Owner Password Credentials）" title="Direct link to 密碼模式（Resource Owner Password Credentials）">​</a></h4><p><strong>第三方應用拿著用戶名和密碼向授權服務器換取令牌</strong></p><ol><li>認證和授權整合再一起</li><li>僅限用戶對第三方應用是高度可性的</li><li>“如何確保安全” 在此無法由 OAuth 2 承擔，只能由用戶和第三方應用自行保障</li></ol><p><img loading="lazy" alt="圖 5-10 密碼模式的調用時序圖" src="/assets/images/5-10-37f8b47d634a227c511eca972eb726ca.png" width="1432" height="580" class="img_ev3q">
<em>圖 5-10 密碼模式的調用時序圖</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客戶端模式client-credentials">客戶端模式（Client Credentials）<a href="#客戶端模式client-credentials" class="hash-link" aria-label="Direct link to 客戶端模式（Client Credentials）" title="Direct link to 客戶端模式（Client Credentials）">​</a></h4><p><strong>第三方應用以自己名義，向授權服務器申請資源許可</strong></p><p><img loading="lazy" alt="圖 5-11 客戶端模式的調用時序圖" src="/assets/images/5-11-15ff16c2b2768191407dd51e73a8a2af.png" width="922" height="514" class="img_ev3q">
<em>圖 5-11 客戶端模式的調用時序圖</em></p><p><img loading="lazy" alt="圖 5-12 設備碼模式的調用時序圖" src="/assets/images/5-12-eed653d8fe4bf634e06ed8a0de338154.png" width="988" height="644" class="img_ev3q">
<em>圖 5-12 設備碼模式的調用時序圖</em></p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="53-憑證">5.3 憑證<a href="#53-憑證" class="hash-link" aria-label="Direct link to 5.3 憑證" title="Direct link to 5.3 憑證">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="531-cookie-session">5.3.1 Cookie-Session<a href="#531-cookie-session" class="hash-link" aria-label="Direct link to 5.3.1 Cookie-Session" title="Direct link to 5.3.1 Cookie-Session">​</a></h3><p>優點：</p><ol><li>狀態訊息儲存於服務端，依靠客戶端的同源策略和 HTTP 的傳輸層安全，保證 Cookie 中的鍵值不被竊取而身份被冒用，就可避免訊息在傳輸過程中被洩露和串改</li><li>服務端有主動的狀態管理能力，可根據自己的意願隨時修改、清除任意上下文訊息</li><li>適合用於單節點的單體服務環境</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="532-jwt-json-web-token">5.3.2 JWT (JSON Web Token)<a href="#532-jwt-json-web-token" class="hash-link" aria-label="Direct link to 5.3.2 JWT (JSON Web Token)" title="Direct link to 5.3.2 JWT (JSON Web Token)">​</a></h3><p><strong>定義於 RFC 7519 標準之中，目前廣泛使用的 Token 格式，經常與 OAuth2 配合應用於分佈式的、涉及多方的應用系統中。</strong></p><p><img loading="lazy" alt="圖 5-13 JWT 令牌結構" src="/assets/images/5-13-e4ae9fef5e9e28952c7cf2ca7146b0b3.png" width="1182" height="810" class="img_ev3q">
<em>圖 5-13 JWT 令牌結構</em></p><p>使用方式：附在 Authorization 的 Header 發送給服務端，前綴在 RFC 6750 中被規定為 Bearer</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /restful/products/1 HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: icyfenix.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJpY3lmZW5peCIsInNjb3BlIjpbIkFMTCJdLCJleHAiOjE1ODQ5NDg5NDcsImF1dGhvcml0aWVzIjpbIlJPTEVfVVNFUiIsIlJPTEVfQURNSU4iXSwianRpIjoiOWQ3NzU4NmEtM2Y0Zi00Y2JiLTk5MjQtZmUyZjc3ZGZhMzNkIiwiY2xpZW50X2lkIjoiYm9va3N0b3JlX2Zyb250ZW5kIiwidXNlcm5hbWUiOiJpY3lmZW5peCJ9.539WMzbjv63wBtx4ytYYw_Fo1ECG_9vsgAn8bheflL8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>用 JWT 令牌的 HTTP 實際請求</em></p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>JWT 只解決防篡改的問題，並不解決防洩漏的問題
（圖 5-13 右邊的狀態訊息是對令牌使用 Base64URL 轉碼後得到的明文）</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jwt-結構">JWT 結構<a href="#jwt-結構" class="hash-link" aria-label="Direct link to JWT 結構" title="Direct link to JWT 結構">​</a></h4><ol><li>令牌頭(Header)</li><li>負載(Payload): 令牌真正需要向服務端傳遞的信息，告知服務端“這個用戶是誰”。可以完全自定義，根據具體要解決的問題不同，設計自己所需要的信息，只是總容量不能太大，受到 HTTP Header 大小的限制</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;username&quot;: &quot;icyfenix&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;authorities&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ROLE_USER&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ROLE_ADMIN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scope&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ALL&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exp&quot;: 1584948947,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;jti&quot;: &quot;9d77586a-3f4f-4cbb-9924-fe2f77dfa33d&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;client_id&quot;: &quot;bookstore_frontend&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>JWT Payload 的例子</em></p><ol start="3"><li>簽名（Signature）：確保負載中的信息是可信的、沒有被篡改的，也沒有在傳輸過程中丟失任何信息，且只能由認證授權服務器完成（只有它知道 Secret）</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload) , secret)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>優點：</p><ol><li>不需要任何一個服務節點保留任何一點狀態信息，就能夠保障認證服務與用戶之間的承諾是雙方當時真實意圖的體現，是準確、完整、不可篡改、且不可抵賴的</li><li>可以攜帶少量信息，有利於 RESTful API 的設計，易達成無狀態服務</li></ol><p>缺點：</p><ol><li><p>令牌難以主動失效：JWT 令牌一旦簽發，在到期之前就會始終有效，除非服務器部署額外的邏輯去處理失效問題</p></li><li><p>相對更容易遭受重放攻擊：解決重放攻擊需要付出比較大的代價，無論是加入全局序列號（HTTPS 協議的思路）、Nonce 字符串（HTTP Digest 驗證的思路）、挑戰應答碼（當下網銀動態令牌的思路）、還是縮短令牌有效期強制頻繁刷新令牌</p><ul><li>解決方案是在信道層次（譬如啟用 HTTPS）上解決，而不提倡在服務層次（譬如在令牌或接口其他參數上增加額外邏輯）上解決</li></ul></li><li><p>只能攜帶相當有限的數據：各種服務器、瀏覽器都會有各自約束的大小，因此令牌中存儲過多的數據不僅耗費傳輸帶寬，還有額外的出錯風險</p></li><li><p>必須考慮令牌在客戶端如何存儲</p></li><li><p>無狀態也不總是好的</p></li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><strong>指散列消息認證碼(Hash-based Message Authentication Code，HMAC)</strong>
一種帶有密鑰的哈希摘要算法，實現形式上通常是把密鑰以加鹽方式混入，與內容一起做哈希摘要。</p><table><thead><tr><th>普通哈希</th><th>HMAC 哈希</th></tr></thead><tbody><tr><td>通過 Hash 函數結果易變性保證了原有內容未被篡改</td><td>1. 保證了內容未被篡改過; 2. 該哈希確實是由密鑰的持有人所生成的</td></tr></tbody></table><p><img loading="lazy" alt="圖 5-14 HMAC 哈希與普通哈希算法的差別" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnoAAAFbCAMAAAB1bNMwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5Mzk2RjlFRURBQzAxMUVBODQ5QjgxRjUyQTJERjNDMiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5Mzk2RjlFRkRBQzAxMUVBODQ5QjgxRjUyQTJERjNDMiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjkzOTZGOUVDREFDMDExRUE4NDlCODFGNTJBMkRGM0MyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjkzOTZGOUVEREFDMDExRUE4NDlCODFGNTJBMkRGM0MyIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ky7Y0AAAAYBQTFRFaaBUttGr4ezddahiMjIySkpKqKionMGOXl5ezuDHyd3C5e7h3t7e9vn1sc6mqcmdbGxsUpI50tLSb6Rbxdu9zN/F7+/vosSV+fn5S44yhYWFsLCw6PDk1uXRmL6K2ujV0eLLpcaYkpKSirV5wtm6YZtLWpdDxMTE9Pjz2OfTlLyGY51NPj4+tra2+vv6jo6OrcuhgrBwVpU+krqC2NjYutSxenp6lr2IXZlGY2Nj5/DjZp5Qjrh+caVeRIkpcnJym5ub3+raQognurq67vTrf65tbKJXjLd8/P38r8yk8fbvUVFR6/LoWVlZ0+PNrsyi8vfweatmRYorP4Uk1OTOfa1qQYgnSIsuTpA1g7FyXppHgK9vdqljP4YkP4YjNzc3z+DIn8OSzMzM9/f3vdWzh7R2v9e2P4cky97E6vLne6xp7/XtlLuF7PPq6fHmYZxLVJM7k7uEj7mAx9y/4OvcdKdgQIck5+fnPoYk7Ozs8/PzgbBv3+vbjLZ7wde4////DHxMqAAAAIB0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wA4BUtnAAAX9UlEQVR42uydi1sTSdbGuRSSGMLFYJgQgRAhgs6wDjsEB5FxWUGdcXQcZlZ0ODskMIh4v8xl99Ov/vWtqr5fohHTne7O+z6PTaq641Pp/uXUOZWqU10cgtqiLtwCCOhBQA+CgB4E9CAI6EFAD4KAHgT0IAjoxUDZXR9lY9DwdDotjiV1nEun51RVyTyRWPRqzWo36p+k+68/yKU/toZi8Ah6qV8cbxKJ4xmiM+IP0UVx7KfeJKOXoyYVefTeiUZu2VssC6sxQm/WQu9CZ6CXa0YxQK8mSMutWOUV0eiHNaAXYfSaejqxQO8S0eUeo9hzmUQF0AN6YaCXOyCanddK87NESzmgB/TCQY+fLFBFxoa8VKHCKI86egfPNa/0odtNtaqFLteSh54cfRBPRxxlad9fZ+KA3tOjNwo9fnuRRg45PxyhxZL2vXqzMRFl77QpHSQPPfOzydK0/8fuiQF64hn2a+jxqedUmJkp0OyUbtL7iZYfRbPZl9XX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" width="634" height="347" class="img_ev3q">
<em>圖 5-14 HMAC 哈希與普通哈希算法的差別</em></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="54-保密confidentiality">5.4 保密（Confidentiality）<a href="#54-保密confidentiality" class="hash-link" aria-label="Direct link to 5.4 保密（Confidentiality）" title="Direct link to 5.4 保密（Confidentiality）">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>系統如何保證敏感數據無法被包括系統管理員在內的內外部人員所竊取、濫用？
保密是<strong>加密</strong>和<strong>解密</strong>的統稱</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="保密的强度">保密的强度<a href="#保密的强度" class="hash-link" aria-label="Direct link to 保密的强度" title="Direct link to 保密的强度">​</a></h3><blockquote><p>追求越高的安全等級，就要付出越多的工作量與算力消耗
保密的安全的强度是有盡頭的
一次性密碼（One Time Password）有絕對安全性（需要提前安全地把密碼或密碼列表傳達給對方）</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端加密">客户端加密<a href="#客户端加密" class="hash-link" aria-label="Direct link to 客户端加密" title="Direct link to 客户端加密">​</a></h3><blockquote><p>是否應該從客戶端開始加密?
<strong>啟用 HTTPS</strong> 對大部分訊息系統足夠
真正防禦性的密碼加密存儲確實應該在<strong>服務端</strong>中進行，但這是為了防禦服務端被攻破而批量洩漏密碼的風險，並不是為了增加傳輸過程的安全</p></blockquote><p>“不應把明文傳遞到服務端”</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="密码存储和验证">密码存储和验证<a href="#密码存储和验证" class="hash-link" aria-label="Direct link to 密码存储和验证" title="Direct link to 密码存储和验证">​</a></h3><blockquote><p><strong>普通安全強度</strong>：在具有一定保密安全性的同時，避免消耗過多的運算資源，驗證起來也相對便捷
（譬如密碼要求長度、特殊字符等，再配合 HTTPS 傳輸)</p></blockquote><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="55-傳輸transport-security">5.5 傳輸Transport Security<a href="#55-傳輸transport-security" class="hash-link" aria-label="Direct link to 5.5 傳輸Transport Security" title="Direct link to 5.5 傳輸Transport Security">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>系统如何保证通过网络传输的信息无法被第三方窃听、篡改和冒充？</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="摘要加密與簽名">摘要、加密與簽名<a href="#摘要加密與簽名" class="hash-link" aria-label="Direct link to 摘要、加密與簽名" title="Direct link to 摘要、加密與簽名">​</a></h3><p>什麼是簽名?
為什麼簽名就能讓payload中的訊息變得不可篡改跟不可抵賴呢?
解釋數位簽章(Digital Signature)之前，必須先解釋&quot;摘要&quot;跟&quot;加密&quot;</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="摘要-digital-digest">摘要 Digital Digest<a href="#摘要-digital-digest" class="hash-link" aria-label="Direct link to 摘要 Digital Digest" title="Direct link to 摘要 Digital Digest">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SHA256</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">base64UrlEncode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">base64UrlEncode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secret</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Hash特性:</p><ol><li>易變性<ul><li>輸入端任何一點細微變動，會造成輸出端的結果產生極大的變化 (e.g., 檔案附上hash)</li></ul></li></ol><p>易變性例子</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; echo Tom_is_so_handsome | sha256sum </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10a143d676527916255ba500a5c039ddc492f36de5bba50626ab8e587833a016</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; echo T0m_is_so_handsome | sha256sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4aee6030bd3b165cb42a53d969e1e2664fa1d5120f3978a5f6dd98a72ed76d49</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>不可逆性<ul><li>不可能從摘要結果逆向推出輸入值，常常聽到有人說破解 SHA1, MD5，指的不是解密，指的是找到碰撞的方法 </li><li><a href="https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html" target="_blank" rel="noopener noreferrer">Announcing the first SHA1 collision</a></li></ul></li></ol><p>Q: Hash 為什麼會產生碰撞 (collisions)?</p><p>A: (鴿籠原理)</p><p>加密與摘要本質區別在加密是可逆的，逆過程就是解密。以前加密需要保護演算法，現代密碼學加解密算法都完全公開。
安全建立在計算問題的複雜度之上。常見例子就是質因數分解</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">97667323933</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128764321253</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12576066674829627448049</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如何對大數進行質因數分解，至今沒有找到多項式時間的算法。</p><p>根據加密或解密是否採用同一個密鑰，來決定密碼學算法是對稱式加密還是非對稱式加密。</p><p>對稱式加密缺點: 通信成員變多，彼此都用獨立的密鑰，數量就會與成員數量成正比。
而更困難的問題是，當通信管道不安全時，如何才能確保拿到正確的鑰匙。
如果假設通道是安全的，為什麼不用這個通道傳訊息就好了
<img loading="lazy" alt="圖 5-15 雞生蛋，蛋生雞" src="/assets/images/5-15_chicken_egg-018cb028a958cfc8f8920c2f97f690d2.png" width="600" height="482" class="img_ev3q"></p><p>解法就是，非對稱式加密!，非對稱式加密算法根據使用方法不同，可以提供兩種功能</p><ul><li>公鑰加密，私鑰解密: 這種就是加密，大家都可以用公鑰加密，但只有擁有私鑰的人能解開</li><li>私鑰加密，公鑰解密: 這種就是簽章，只有擁有私鑰的人能產生加密過後的文件，大家都有公鑰可以解開內容確認是某人寫的文件</li></ul><p>補充: RSA為什麼公鑰私鑰都可以加解密 <a href="https://dev.to/dandyvica/understanding-public-private-rsa-keys-3j81" target="_blank" rel="noopener noreferrer">Understanding public/private RSA keys</a></p><p>但是非對稱式的計算效率比對稱式加密差上好幾個量級。而且現行的非對稱式加密不支援分組加密(只能加密不超過密鑰長度的資料)。</p><p>在加密方面，一般是對稱與非稱式的結合，用非對稱來傳遞少量訊息，後續再用對稱式加密傳輸數據
在簽名方面，一般是摘要+非對稱式加密的組合，將檔案做摘要，然後加密摘要做傳輸</p><p><img loading="lazy" alt="三种密码学算法的对比" src="/assets/images/5-16_crypto_comparison-76ca14feb90a5b8403ba5f302e0b3a9e.png" width="1280" height="356" class="img_ev3q"></p><p>上述方法看似可以解決很多問題，但問題是，公鑰雖然是公開的，但在網路裡，公開到底是一個什麼樣的操作
如果網路是不安全的:</p><ul><li>攻擊者可以返回自己的公鑰，之後攻擊者都用自己的私鑰簽名，接著大家就會無條件信他的所有行為</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="數字證書-digital-signature">數字證書 (Digital Signature)<a href="#數字證書-digital-signature" class="hash-link" aria-label="Direct link to 數字證書 (Digital Signature)" title="Direct link to 數字證書 (Digital Signature)">​</a></h3><p>達成信任方法不外乎以下兩種途徑:</p><ul><li>基於共同私密信息的信任<ul><li>通關密語, 共同小秘密</li></ul></li><li>基於權威公證人的信任<ul><li>Tom過來跟我說，他是 VicOne 的人，我很懷疑，但我信任 Mech，Mech 擔保他確實是 VicOne 的人，那 Tom 很有可能是 VicOne 的人</li></ul></li></ul><p>現實世界不能假設授權伺服器和資源伺服器是互相認識的，所以不會採用第一種方法。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="公開金鑰基礎建設">公開金鑰基礎建設<a href="#公開金鑰基礎建設" class="hash-link" aria-label="Direct link to 公開金鑰基礎建設" title="Direct link to 公開金鑰基礎建設">​</a></h2><p>由硬件、软件、参与者、管理政策与流程组成的基础架构，其目的在于创造、管理、分配、使用、存储以及撤销数字证书。
CA (Certificate Authority) 将用户的个人身份跟公开密钥链接在一起，创建过程可由 CA 的各种软件或者在人为监督下完成。
PKI 的确定链接关系的这一角色称为注册管理中心（Registration Authority，RA）。RA 确保公开密钥和个人身份链接，可以防抵赖。</p></div></div><p><a href="https://youtu.be/i-rtxrEz_E8" target="_blank" rel="noopener noreferrer">What is Public Key Infrastructure (PKI) by Securemetric</a></p><p>但是萬一有人假冒 CA 怎麼辦，好險世界上一堆Server的公鑰是不可數的，但 CA 是可數的，所以我們可以預先安裝到瀏覽器或 OS</p><p>一個 Digital Signature 包含以下訊息:</p><ol><li>Version</li><li>Serial Number</li><li>Signature Algorithm ID</li><li>Certificate Signature</li><li>Issuer Name</li><li>Validity Period</li><li>Subject</li><li>Public-Key</li></ol><p>Mac Certificate path: <code>/System/Library/Security/Certificates.bundle/Contents/Resources/TrustStore.html</code></p><p>補充: <a href="https://lh5.googleusercontent.com/_JiU4f3pMlOg/TY882fPEFpI/AAAAAAAAAQA/80juTCnWJMs/%E6%95%B8%E4%BD%8D%E7%B0%BD%E7%AB%A0.png" target="_blank" rel="noopener noreferrer">數位簽章演算法</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="傳輸安全層-transport-layer-security-tls">傳輸安全層 Transport Layer Security (TLS)<a href="#傳輸安全層-transport-layer-security-tls" class="hash-link" aria-label="Direct link to 傳輸安全層 Transport Layer Security (TLS)" title="Direct link to 傳輸安全層 Transport Layer Security (TLS)">​</a></h3><p>在计算机科学里，隔离复杂性的最有效手段（没有之一）就是分层，如果一层不够就再加一层。
主流版本為TLS1.2
以TLS 1.2 為例，介紹傳輸安全層是如何</p><ul><li>保障所有信息都是第三方無法竊聽(加密傳輸)</li><li>無法篡改(一旦篡改通信算法會立刻發現)</li><li>無法冒充(證書驗證身分)</li></ul><p><a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/" target="_blank" rel="noopener noreferrer">What happens during a TLS handshake?</a></p><p>During the course of a TLS handshake, the client and server together will do the following:</p><p>Specify which version of TLS (TLS 1.0, 1.2, 1.3, etc.) they will use
Decide on which cipher suites (see below) they will use
Authenticate the identity of the server via the server’s public key and the SSL certificate authority’s digital signature
Generate session keys in order to use symmetric encryption after the handshake is complete</p><p><img loading="lazy" alt="圖 5-17" src="/assets/images/5-17-2cfdb3515ba51361e0b11e7db05a44d8.png" width="812" height="730" class="img_ev3q"></p><ol><li>客户端请求：Client Hello
客户端向服务器请求进行加密通信，在这个请求里面，它会以明文的形式，向服务端提供以下信息。</li></ol><ul><li>支持的协议版本，譬如 TLS 1.2</li><li>一个客户端生成的 32 Bytes 随机数，这个随机数将稍后用于产生加密的密钥。</li><li>一个可选的 SessionID，这个 SessionID 是指传输安全层的 Session，是为了 TLS 的连接复用而设计的。</li><li>一系列支持的密码学算法套件，例如TLS_RSA_WITH_AES_128_GCM_SHA256，代表着密钥交换算法是 RSA，加密算法是 AES128-GCM，消息认证码算法是 SHA256</li><li>一系列支持的数据压缩算法。</li></ul><ol start="2"><li>服务器回应：Server Hello
服务器接收到客户端的通信请求后，如果客户端声明支持的协议版本和加密算法组合与服务端相匹配的话，就向客户端发出回应。如果不匹配，将会返回一个握手失败的警告提示。这次回应同样以明文发送的，包括以下信息：</li></ol><ul><li>服务端确认使用的 TLS 协议版本。</li><li>第二个 32 Bytes 的随机数，稍后用于产生加密的密钥。</li><li>一个 SessionID，以后可通过连接复用减少一轮握手。</li><li>服务端在列表中选定的密码学算法套件。</li><li>服务端在列表中选定的数据压缩方法。</li><li>根據不同的加密算法，會有不同的key交換方式</li></ul><ol start="3"><li>客户端确认：Client Handshake Finished
由于密码学套件的组合复杂多样，这里仅以 RSA 算法为密钥交换算法为例介绍后续过程。
客户端收到服务器应答后，先要验证服务器的证书合法性。如果证书不是可信机构颁布的，或者证书中信息存在问题，譬如域名与实际域名不一致、或者证书已经过期、或通过在线证书状态协议得知证书已被吊销，等等，都会向访问者显示一个“证书不可信任”的警告，由用户自行选择是否还要继续通信。如果证书没有问题，客户端就会从证书中取出服务器的公钥，并向服务器发送以下信息：</li></ol><ul><li>客户端证书（可选）</li><li>第三个 32 Bytes 的随机数，这个随机数不再是明文发送，而是以服务端传过来的公钥加密的，它被称为 PreMasterSecret，将与前两次发送的随机数一起，根据特定算法计算出 48 Bytes 的 MasterSecret ，这个 MasterSecret 即为后续内容传输时的对称加密算法所采用的私钥。</li><li>编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。</li><li>客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的哈希值，以供服务器校验。</li></ul><ol start="4"><li>服务端确认：Server Handshake Finished
服务端向客户端回应最后的确认通知，包括以下信息。</li></ol><p>编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的哈希值，以供客户端校验。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="56-驗證-verification">5.6 驗證 (Verification)<a href="#56-驗證-verification" class="hash-link" aria-label="Direct link to 5.6 驗證 (Verification)" title="Direct link to 5.6 驗證 (Verification)">​</a></h2><ul><li>你是誰 (Authentication)</li><li>你能做什麼 (Authorization)</li><li>你做的對不對 (Verification)</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">前  端： 提交一份用户数据（姓名:某, 性别:男, 爱好:女, 签名:xxx, 手机:xxx, 邮箱:null）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">控制器： 发现邮箱是空的，抛ValidationException(&quot;邮箱没填&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">前  端： 已修改，重新提交</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">安  全： 发送验证码时发现手机号少一位，抛RemoteInvokeException(&quot;无法发送验证码&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">前  端： 已修改，重新提交</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">服务层： 邮箱怎么有重复啊，抛BusinessRuntimeException(&quot;不允许开小号&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">前  端： 已修改，重新提交</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">持久层： 签名字段超长了插不进去，抛SQLException(&quot;插入数据库失败，SQL：xxx&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">…… ……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">前  端： 你们这些坑管挖不管埋的后端，各种异常都往前抛！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">用  户： 这系统牙膏厂生产的？</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在 Controller 层做，在 Service 层不做。理由是从 Service 开始会有同级重用，出现 ServiceA.foo(params)调用 ServiceB.bar(params)时，就会对 params 重复校验了两次。</li><li>在 Service 层做，在 Controller 层不做。理由是无业务含义的格式校验已在前端表单验证处理过，有业务含义的校验，放在 Controller 层无论如何不合适。</li><li>在 Controller、Service 层各做各的。Controller 做格式校验，Service 层做业务校验，听起来很合理，但这其实就是上面段子中被嘲笑的行为。</li><li>还有其他一些意见，譬如还有提在持久层做校验，理由是这是最终入口，把守好写入数据库的质量最重要。</li></ul><p>避免对输入数据的防御污染到业务代码，如果你的代码里面如果很多下面这样的条件判断，就应该考虑重构了：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 一些已执行的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">someParam </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RuntimeExcetpion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;客官不可以！&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于无业务含义的格式验证，可以做到预置。
对于有业务含义的业务验证，可以做到重用</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* 创建新的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@POST</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Response</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@Valid</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#393A34">@UniqueAccount</span><span class="token plain"> </span><span class="token class-name">Account</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">CommonResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">op</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createAccount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">* 更新用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@PUT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@CacheEvict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#user.username&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Response</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">updateUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token annotation punctuation" style="color:#393A34">@Valid</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#393A34">@AuthenticatedAccount</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#393A34">@NotConflictAccount</span><span class="token plain"> </span><span class="token class-name">Account</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">CommonResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">op</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">updateAccount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>@UniqueAccount：传入的用户对象必须是唯一的，不与数据库中任何已有用户的名称、手机、邮箱产生重复。</li><li>@AuthenticatedAccount：传入的用户对象必须与当前登录的用户一致。</li><li>@NotConflictAccount：传入的用户对象中的信息与其他用户是无冲突的，譬如将一个注册用户的邮箱，修改成与另外一个已存在的注册用户一致的值，这便是冲突。</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AuthenticatedAccountValidator</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AccountValidation</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">AuthenticatedAccount</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AuthenticatedAccount</span><span class="token plain"> constraintAnnotation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">AuthenticAccount</span><span class="token plain"> loginUser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">AuthenticAccount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAuthentication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPrincipal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loginUser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">UniqueAccountValidator</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AccountValidation</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">UniqueAccount</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UniqueAccount</span><span class="token plain"> constraintAnnotation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">existsByUsernameOrEmailOrTelephone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUsername</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTelephone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">NotConflictAccountValidator</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">AccountValidation</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">NotConflictAccount</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">NotConflictAccount</span><span class="token plain"> constraintAnnotation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Collection</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Account</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> collection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findByUsernameOrEmailOrTelephone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getUsername</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getTelephone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 将用户名、邮件、电话改成与现有完全不重复的，或者只与自己重复的，就不算冲突</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> collection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">collection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> collection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iterator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">equals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 表示一个用户的信息是无冲突的</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * “无冲突”是指该用户的敏感信息与其他用户不重合，譬如将一个注册用户的邮箱，修改成与另外一个已存在的注册用户一致的值，这便是冲突</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Documented</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Retention</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">RUNTIME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Target</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">FIELD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">METHOD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PARAMETER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TYPE</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Constraint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">validatedBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">AccountValidation</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">NotConflictAccountValidator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#393A34">@interface</span><span class="token plain"> </span><span class="token class-name">NotConflictAccount</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户名称、邮箱、手机号码与现存用户产生重复&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">groups</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Class</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics operator" style="color:#393A34">?</span><span class="token generics"> </span><span class="token generics keyword" style="color:#00009f">extends</span><span class="token generics"> </span><span class="token generics class-name">Payload</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">payload</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将不带业务含义的格式校验注解放到 Bean 的类定义之上，将带业务逻辑的校验放到 Bean 的类定义的外面。这两者的区别是放在类定义中的注解能够自动运行，而放到类外面则需要像前面代码那样，明确标出注解时才会运行。譬如用户账号实体中的部分代码为：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Account</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">BaseEntity</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户不允许为空&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;用户姓名不允许为空&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> avatar</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Pattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">regexp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1\\d{10}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;手机号格式不正确&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> telephone</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Email</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;邮箱格式不正确&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/fenix-architecture/ch5.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-11-12T15:36:35.000Z">Nov 12, 2023</time></b> by <b>Mech</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/sg/fenix-architecture/ch4.5-6"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ch4.5~6: 負載均衡和服務端緩存</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/sg/fenix-architecture/ch6"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ch6: 分佈式共識算法</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#51-認證authentication" class="table-of-contents__link toc-highlight">5.1 認證（Authentication）</a><ul><li><a href="#511-認證標準" class="table-of-contents__link toc-highlight">5.1.1 認證標準</a></li><li><a href="#512-認證的實現-介紹在-java-中如何實現" class="table-of-contents__link toc-highlight">5.1.2 認證的實現 （介紹在 Java 中如何實現）</a></li></ul></li><li><a href="#52-授權authorization" class="table-of-contents__link toc-highlight">5.2 授權（Authorization）</a><ul><li><a href="#521-rbac-role-based-access-control基於角色的訪問控制" class="table-of-contents__link toc-highlight">5.2.1 RBAC （Role-Based Access Control，基於角色的訪問控制)</a></li><li><a href="#522-oauth-2-認證授權協議" class="table-of-contents__link toc-highlight">5.2.2 OAuth 2 認證授權協議</a></li></ul></li><li><a href="#53-憑證" class="table-of-contents__link toc-highlight">5.3 憑證</a><ul><li><a href="#531-cookie-session" class="table-of-contents__link toc-highlight">5.3.1 Cookie-Session</a></li><li><a href="#532-jwt-json-web-token" class="table-of-contents__link toc-highlight">5.3.2 JWT (JSON Web Token)</a></li></ul></li><li><a href="#54-保密confidentiality" class="table-of-contents__link toc-highlight">5.4 保密（Confidentiality）</a><ul><li><a href="#保密的强度" class="table-of-contents__link toc-highlight">保密的强度</a></li><li><a href="#客户端加密" class="table-of-contents__link toc-highlight">客户端加密</a></li><li><a href="#密码存储和验证" class="table-of-contents__link toc-highlight">密码存储和验证</a></li></ul></li><li><a href="#55-傳輸transport-security" class="table-of-contents__link toc-highlight">5.5 傳輸Transport Security</a><ul><li><a href="#摘要加密與簽名" class="table-of-contents__link toc-highlight">摘要、加密與簽名</a></li><li><a href="#數字證書-digital-signature" class="table-of-contents__link toc-highlight">數字證書 (Digital Signature)</a></li><li><a href="#傳輸安全層-transport-layer-security-tls" class="table-of-contents__link toc-highlight">傳輸安全層 Transport Layer Security (TLS)</a></li></ul></li><li><a href="#56-驗證-verification" class="table-of-contents__link toc-highlight">5.6 驗證 (Verification)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023. DEX Study Group</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8ee15afe.js"></script>
<script src="/assets/js/main.302dd2ef.js"></script>
</body>
</html>