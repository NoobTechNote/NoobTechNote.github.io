<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-sg/fenix-architecture/ch10">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Ch10: 可觀測性 | Noob Tech Note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch10"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ch10: 可觀測性 | Noob Tech Note"><meta data-rh="true" name="description" content="可觀測性(Observability)"><meta data-rh="true" property="og:description" content="可觀測性(Observability)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch10"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch10" hreflang="en"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch10" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.40771ce4.css">
<link rel="preload" href="/assets/js/runtime~main.20c108ea.js" as="script">
<link rel="preload" href="/assets/js/main.2d5dd4a1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Noob Tech Note</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/sg">Study Group</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/sg/">Study Group Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Study Group Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/clean-architecture/">Clean Architecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Clean Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/sg/ddia/ch1">資料密集型應用系統設計</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/sg/fenix-architecture/">鳳凰架構</a><button aria-label="Toggle the collapsible sidebar category &#x27;鳳凰架構&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch0">Ch0: 前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch1">Ch1: 服務架構演進史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch2">Ch2: 存取遠端服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch3">Ch3: 交易處理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4">Ch4: 透明多級分流系統</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4.5-6">Ch4.5~6: 負載均衡和服務端緩存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch5">Ch5: 架構安全性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch6">Ch6: 分佈式共識算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch7">Ch7: 從函式庫到服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch8">Ch8: 流量治理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch9">Ch9: 可靠通信</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/sg/fenix-architecture/ch10">Ch10: 可觀測性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch11">Ch11: 虛擬化容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch12">Ch12: 容器間網路</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch13">Ch13: 持久化存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch14">Ch14: 資源與調度</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch15">Ch15: 服務網格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch16">Ch16: 向微服務邁進</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/five-lines-of-code/">五行程式碼規則</a><button aria-label="Toggle the collapsible sidebar category &#x27;五行程式碼規則&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/fundamentals-of-software-architecture/">軟體架構原理 - 工程方法</a><button aria-label="Toggle the collapsible sidebar category &#x27;軟體架構原理 - 工程方法&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/web-api-the-good-parts/">Web API: The Good Parts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web API: The Good Parts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/"><span itemprop="name">Study Group Notes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/fenix-architecture/"><span itemprop="name">鳳凰架構</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ch10: 可觀測性</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ch10: 可觀測性</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="可觀測性observability">可觀測性(Observability)<a href="#可觀測性observability" class="hash-link" aria-label="Direct link to 可觀測性(Observability)" title="Direct link to 可觀測性(Observability)">​</a></h2><blockquote><p><img loading="lazy" alt="issue-img" src="/assets/images/10-1-173f71a398ac6c1257357fd285209703.png" width="2232" height="968" class="img_ev3q"></p></blockquote><blockquote><p>前言：某專案後端用 AWS Lambda + python , client 端用 iOS , Android。
常常 JSON payload 傳錯導致 crash 或 API response 都好幾秒，News List 頁面要等 6 秒，
總不可能每天手動滑 APP 做 test，看 GA 分析 user 滯留時間出奇的低!!!
前端當作除錯工具，我在想有更好的方式解決?</p><p>就來講到今天主題</p></blockquote><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>What Is API Observability?</div><div class="admonitionContent_S0QG"><p>API 可觀察性是指通過 API 發出的信號可以理解 API 內部狀態的程度。
幫助團隊監控其 API 性能、解決問題、了解業務邏輯貼近市場需求和辨識效能優化方向。</p></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>What Is API Observability?</summary><div><div class="collapsibleContent_i85q"><p></p><ul><li>真實用戶數據</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-可觀察性收集和分析-api-流量的實時流量數據以監控真實的客戶數據而不是虛假數據">API 可觀察性收集和分析 API 流量的實時流量數據，以監控真實的客戶數據而不是虛假數據。<a href="#api-可觀察性收集和分析-api-流量的實時流量數據以監控真實的客戶數據而不是虛假數據" class="hash-link" aria-label="Direct link to API 可觀察性收集和分析 API 流量的實時流量數據，以監控真實的客戶數據而不是虛假數據。" title="Direct link to API 可觀察性收集和分析 API 流量的實時流量數據，以監控真實的客戶數據而不是虛假數據。">​</a></h4><p>通過這樣做，您可以確保您的監控與客戶遇到的情況一致，從而增加您在問題對客戶產生重大影響之前發現問題的可能性。</p><ul><li>使用系統數據調試</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用-api-可觀察性技術將使您能夠從整個系統中獲取數據這與黑盒監控不同">使用 API 可觀察性技術將使您能夠從整個系統中獲取數據，這與黑盒監控不同。<a href="#使用-api-可觀察性技術將使您能夠從整個系統中獲取數據這與黑盒監控不同" class="hash-link" aria-label="Direct link to 使用 API 可觀察性技術將使您能夠從整個系統中獲取數據，這與黑盒監控不同。" title="Direct link to 使用 API 可觀察性技術將使您能夠從整個系統中獲取數據，這與黑盒監控不同。">​</a></h4><p>例如，當發生錯誤時，可以提供比簡單的 API 響應快照更多的資訊。這意味著使用 API 可觀察性工具，您的工程師將能夠更快地解決問題。</p><p><img loading="lazy" alt="API-observability" src="/assets/images/API-observability-f0a30365fa32b4e6aaa9e3095623a0a6.png" width="1600" height="185" class="img_ev3q"></p><p></p></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="可觀測性-observability-三大支柱">可觀測性 (Observability) 三大支柱<a href="#可觀測性-observability-三大支柱" class="hash-link" aria-label="Direct link to 可觀測性 (Observability) 三大支柱" title="Direct link to 可觀測性 (Observability) 三大支柱">​</a></h3><ul><li>日誌(Logging)</li><li>追踪(Tracing)</li><li>指標(Metrics)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="日誌-logging">日誌 (Logging)<a href="#日誌-logging" class="hash-link" aria-label="Direct link to 日誌 (Logging)" title="Direct link to 日誌 (Logging)">​</a></h3><p>日誌是在任何服務器、操作系統或應用程序中觀察到的活動的記錄。</p><p>通常，日誌文件包含與在服務器中觀察到的小活動相關的
所有詳細資訊。它們可以是結構化或非結構化的代碼行，其中包含您要查找的所有詳細資訊。</p><p>日誌記錄是記錄您的操作的過程。它不需要任何人工協助，因為該過程是自動且自發的。</p><p>首選日誌來觀察系統的原因是，</p><ul><li>所有系統都有日誌，過程不需要任何手動操作。</li><li>如果出現錯誤，日誌將包含與問題相關的故障的所有詳細資訊。</li><li>要對系統進行故障排除或調試，檢查記錄的日誌文件就足夠了。</li></ul><p>日誌可觀察性也有一個必須注意的限制，</p><ul><li>如果不注意日誌文件，可能會導致記錄失敗，並且無法正確保存收集的數據。</li></ul><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Logs-vs-traces</summary><div><div class="collapsibleContent_i85q"><p></p><p><img loading="lazy" alt="Logs-vs-traces-red" src="/assets/images/Logs-vs-traces-red@2x-2-b0d9b44d5d45a77add0a2c0baecd45da.webp" width="1142" height="856" class="img_ev3q">
<a href="https://www.aspecto.io/blog/logging-vs-tracing-why-logs-arent-enough-to-debug-your-microservices/" target="_blank" rel="noopener noreferrer">Ref</a></p><p></p></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="追踪-tracing">追踪 (Tracing)<a href="#追踪-tracing" class="hash-link" aria-label="Direct link to 追踪 (Tracing)" title="Direct link to 追踪 (Tracing)">​</a></h3><p>一種完全不同的數據以軌跡的形式存儲。</p><p>Tracing 是一種流動形式，通過它可以很容易地看到和分析活動背後的整個歷史。</p><p>由於可以記錄系統的整個框架，因此追踪被廣泛用於確定可觀察性。通過 Tracing 的具體點，您可以識別並糾正錯誤。</p><p>優點:</p><ul><li>可以以語義的形式記錄和收集數據，以便更好地理解。</li><li>收集的數據為您的問題提供了準確的答案。</li></ul><p>缺點:</p><ul><li>Tracing 有時可能會有間隙，這會使調試和故障排除變得更加困難。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="指標-metrics">指標 (Metrics)<a href="#指標-metrics" class="hash-link" aria-label="Direct link to 指標 (Metrics)" title="Direct link to 指標 (Metrics)">​</a></h3><p>數據收集可以通過多種方式完成，其中一種方法是使用指標。</p><p>指標是一種數字數據形式，以離散值的形式存儲，有助於快速識別問題。</p><p>一般來說，給出規律時間間隔行為資訊的是數學數據。數據可以以圖表的形式標註，便於追踪系統的高點和低點。</p><p>指標的使用一般用於業務和統計相關資訊，以追踪頻率。</p><p>優點:</p><ul><li>數據的可視化更容易，並且可以快速分析數據。</li><li>節省時間，因為為您提供了清晰詳細的價值。</li><li>與日誌相比，公制系統的複雜性較小。</li></ul><p>缺點:</p><ul><li>指標數據只有在達到閾值時才會通知故障排除。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="日誌指標和追踪是相互關聯的">日誌、指標和追踪是相互關聯的<a href="#日誌指標和追踪是相互關聯的" class="hash-link" aria-label="Direct link to 日誌、指標和追踪是相互關聯的" title="Direct link to 日誌、指標和追踪是相互關聯的">​</a></h3><blockquote><p><img loading="lazy" alt="LoggingTracingMetrics" src="/assets/images/10-2-61e9f59d31c2cc83e7939fa296661758.png" width="613" height="400" class="img_ev3q"></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="事件日志">事件日志<a href="#事件日志" class="hash-link" aria-label="Direct link to 事件日志" title="Direct link to 事件日志">​</a></h2><p>日誌用來記錄系統運行期間發生過的離散事件。
print log 很簡單，在分散式系統，就很難只依靠 tail、grep、awk 來從日誌中挖掘資訊了，
往往還要有專門的全局查詢和可視化功能。此時，從打印日誌到分析查詢之間，
還隔著收集、緩衝、聚合、加工、索引、存儲等若干個步驟。
Elastic Stack 技術棧來說</p><blockquote><p><img loading="lazy" alt="LoggingProcessing" src="/assets/images/10-3-11b4ea21e3181ba26e2e9c7b0ddb7df3.jpg" width="867" height="164" class="img_ev3q"></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="輸出">輸出<a href="#輸出" class="hash-link" aria-label="Direct link to 輸出" title="Direct link to 輸出">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="不應該有的資訊">不應該有的資訊：<a href="#不應該有的資訊" class="hash-link" aria-label="Direct link to 不應該有的資訊：" title="Direct link to 不應該有的資訊：">​</a></h4><ul><li>避免打印敏感資訊:</li></ul><p>不該將密碼，銀行賬號，身份證件這些敏感資訊打到日誌裡。個資外洩！！！</p><ul><li>避免引用慢操作:</li></ul><p>日誌中打印的資訊應該是上下文中可以直接取到的，如果當前上下文中根本沒有這項數據，
需要專門調用遠程服務或者從數據庫獲取，又或者通過大量計算才能取到的話，那應該先考慮這項資訊放到日誌中是不是必要且恰當的。</p><ul><li>避免打印追踪診斷資訊:</li></ul><p>日誌中不要打印方法輸入參數、輸出結果、方法執行時長之類的調試資訊。</p><ul><li>避免誤導他人:</li></ul><p><a href="https://blog.51cto.com/u_15127511/3436116" target="_blank" rel="noopener noreferrer">JAVA 中不要用 e.printStackTrace()</a>，e.printStackTrace() 語句要產生的字符串記錄的是堆棧資訊，太長太多，memory 被填滿了！</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="應該有的資訊">應該有的資訊：<a href="#應該有的資訊" class="hash-link" aria-label="Direct link to 應該有的資訊：" title="Direct link to 應該有的資訊：">​</a></h4><ul><li>處理請求時的 TraceID。</li><li>系統運行過程中的關鍵事件。</li><li>啟動時輸出系統資訊。
<img loading="lazy" alt="System-Information" src="/assets/images/10-12-f247c49f8c901cf82c1a3b00538b2c99.jpg" width="795" height="276" class="img_ev3q"></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="收集與緩衝">收集與緩衝<a href="#收集與緩衝" class="hash-link" aria-label="Direct link to 收集與緩衝" title="Direct link to 收集與緩衝">​</a></h3><p>Beats 是用 Go 編寫的輕量級數據傳輸器，你可以把它安裝在你的服務器上，以捕獲各種操作數據
（如日誌、指標或網絡包數據）。 Beats 將操作數據直接或通過 Logstash 發送到 Elasticsearch，
因此可以用 Kibana 進行可視化。</p><table><thead><tr><th>Beat</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://github.com/elastic/beats/tree/main/auditbeat" target="_blank" rel="noopener noreferrer">Auditbeat</a></td><td>Collect your Linux audit framework data and monitor the integrity of your files.</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/filebeat" target="_blank" rel="noopener noreferrer">Filebeat</a></td><td>Tails and ships log files</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/x-pack/functionbeat" target="_blank" rel="noopener noreferrer">Functionbeat</a></td><td>Read and ships events from serverless infrastructure.</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/heartbeat" target="_blank" rel="noopener noreferrer">Heartbeat</a></td><td>Ping remote services for availability</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/metricbeat" target="_blank" rel="noopener noreferrer">Metricbeat</a></td><td>Fetches sets of metrics from the operating system and services</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/packetbeat" target="_blank" rel="noopener noreferrer">Packetbeat</a></td><td>Monitors the network and applications by sniffing packets</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/winlogbeat" target="_blank" rel="noopener noreferrer">Winlogbeat</a></td><td>Fetches and ships Windows Event logs</td></tr><tr><td><a href="https://github.com/elastic/beats/tree/main/x-pack/osquerybeat" target="_blank" rel="noopener noreferrer">Osquerybeat</a></td><td>Runs Osquery and manages interraction with it.</td></tr></tbody></table><blockquote><p>在 Logstash 之前架設一個 Kafka 或者 Redis 作為緩衝層，面對高流量。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="加工與聚合">加工與聚合<a href="#加工與聚合" class="hash-link" aria-label="Direct link to 加工與聚合" title="Direct link to 加工與聚合">​</a></h3><p>將日誌集中收集之後，存入 Elasticsearch 之前，一般還要對它們進行加工轉換和聚合處理。
這是因為日誌是非結構化數據，一行日誌中通常會包含多項資訊，如果不做處理，
那在 Elasticsearch 就只能以全文檢索的原始方式去使用日誌，既不利於統計對比，也不利於條件過濾。
舉個具體例子，下面是一行 Nginx 服務器的 Access Log，代表了一次頁面訪問操作：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">14.123</span><span class="token plain">.255.234 - - </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">19</span><span class="token plain">/Feb/2020:00:12:11 +0800</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GET /index.html HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1314</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://icyfenix.cn&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>數據項</th><th>值</th></tr></thead><tbody><tr><td>IP 地址</td><td>14.123.255.234</td></tr><tr><td>用戶名 - -</td><td>無效的</td></tr><tr><td>請求的時間戳</td><td>19/二月/2020:00:12:11 +0800</td></tr><tr><td>請求的方法</td><td>得到</td></tr><tr><td>請求的 URL</td><td>/index.html</td></tr><tr><td>HTTP 協議的版本號</td><td>HTTP/1.1</td></tr><tr><td>HTTP Status Code</td><td>200</td></tr><tr><td>伺服器回應的內容長度，1314 個位元組</td><td>1314</td></tr><tr><td>請求的來源網址</td><td><a href="https://www.cncf.io/" target="_blank" rel="noopener noreferrer">https://www.cncf.io/</a></td></tr><tr><td>發送請求的用戶端瀏覽器的 User-Agent，這裡表示使用的是 Chrome 瀏覽器。</td><td>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36</td></tr></tbody></table><p>通過<a href="https://doc.yonyoucloud.com/doc/logstash-best-practice-cn/filter/grok.html" target="_blank" rel="noopener noreferrer">Grok 表達式語法</a>轉換為上面表格那樣的結構化數據</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="存儲與查詢">存儲與查詢<a href="#存儲與查詢" class="hash-link" aria-label="Direct link to 存儲與查詢" title="Direct link to 存儲與查詢">​</a></h3><ul><li><p>從數據特徵的角度看</p></li><li><p>從數據價值的角度看</p></li><li><p>從數據使用的角度看</p><p><a href="https://www.elastic.co/cn/kibana/" target="_blank" rel="noopener noreferrer">Kibana</a>
<img loading="lazy" alt="kibana-dashboard.jpeg" src="/assets/images/kibana-dashboard-9626fe8327f504ef84e9431d77e40d20.jpeg" width="1094" height="616" class="img_ev3q"></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="鏈路追踪tracinganalysis">鏈路追踪(TracingAnalysis)<a href="#鏈路追踪tracinganalysis" class="hash-link" aria-label="Direct link to 鏈路追踪(TracingAnalysis)" title="Direct link to 鏈路追踪(TracingAnalysis)">​</a></h2><p>分佈式追踪系統的起源
<a href="https://static.googleusercontent.com/media/research.google.com/zh-CN//archive/papers/dapper-2010-1.pdf" target="_blank" rel="noopener noreferrer">《Dapper：a Large-Scale Distributed Systems Tracing Infrastructure》</a>論文。</p><p>一個完整的分散式追踪系統由數據收集、數據存儲和數據展示三個相對獨立的子系統組成，
而鏈路追踪僅指數據收集部分。追踪系統常被稱為“APM 系統”（Application Performance Management）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="追踪與跨度">追踪與跨度<a href="#追踪與跨度" class="hash-link" aria-label="Direct link to 追踪與跨度" title="Direct link to 追踪與跨度">​</a></h2><blockquote><p><img loading="lazy" alt="TracingAndSpan" src="/assets/images/10-5-739e3a8946bf0681e7219cbdd37b1219.png" width="647" height="494" class="img_ev3q"></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="追踪tracing">追踪(Tracing)<a href="#追踪tracing" class="hash-link" aria-label="Direct link to 追踪(Tracing)" title="Direct link to 追踪(Tracing)">​</a></h4><p>從客戶端發起請求抵達系統的邊界開始，記錄請求流經的每一個服務，直到到向客戶端返迴響應為止，這整個過程。</p><blockquote><p><img loading="lazy" alt="Tracing" src="/assets/images/10-4-ed089a48a24b11f2513ac45ab937777f.png" width="1934" height="798" class="img_ev3q"></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="跨度span">跨度(Span)<a href="#跨度span" class="hash-link" aria-label="Direct link to 跨度(Span)" title="Direct link to 跨度(Span)">​</a></h4><p>由於每次 Trace 都可能會調用數量不定、坐標不定的多個服務，為了能夠記錄具體調用了哪些服務，以及調用的順序、
開始時點、執行時長等資訊，每次開始調用服務前都要先埋入一個調用記錄，這個記錄稱為一個&quot;跨度&quot;(Span)。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景">適用場景<a href="#適用場景" class="hash-link" aria-label="Direct link to 適用場景" title="Direct link to 適用場景">​</a></h4><ul><li>低性能損耗：分佈式追踪不能對服務本身產生明顯的性能負擔。追踪的主要目的之一就是為了尋找性能缺陷，越慢的服務越是需要追踪，所以工作場景都是性能敏感的地方。</li><li>對應用透明：追踪系統通常是運維期才事後加入的系統，應該盡量以非侵入或者少侵入的方式來實現追踪，對開發人員做到透明化。</li><li>隨應用擴縮：現代的分佈式服務集群都有根據流量壓力自動擴縮的能力，這要求當業務系統擴縮時，追踪系統也能自動跟隨，不需要運維人員人工參與。</li><li>持續的監控：要求追踪系統必須能夠 7x24 小時工作，否則就難以定位到系統偶爾抖動的行為。</li></ul><p><a href="https://mp.weixin.qq.com/s/cqgGHFdKdDrGj_cpW_uBPQ#at" target="_blank" rel="noopener noreferrer">原來 10 張圖就可以搞懂分佈式鏈路追踪系統原理</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="數據收集">數據收集<a href="#數據收集" class="hash-link" aria-label="Direct link to 數據收集" title="Direct link to 數據收集">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="基於日誌的追踪log-based-tracing">基於日誌的追踪(Log-Based Tracing)<a href="#基於日誌的追踪log-based-tracing" class="hash-link" aria-label="Direct link to 基於日誌的追踪(Log-Based Tracing)" title="Direct link to 基於日誌的追踪(Log-Based Tracing)">​</a></h4><ul><li><p>基於日誌的追踪的思路是將 Trace、Span 等資訊直接輸出到應用日誌中，然後隨著所有節點的日誌歸集過程匯聚到一起，
再從全局日誌資訊中反推出完整的調用鏈拓撲關係。</p><p>日誌追踪的代表產品是 Spring Cloud Sleuth，下面是一段由 Sleuth 在調用時自動生成的日誌記錄，
可以從中觀察到 TraceID、SpanID、父 SpanID 等追踪資訊。</p></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 以下为调用端的日志输出：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created new Feign span [Trace: cbe97e67ce162943, Span: bb1798f7a7c9c142, Parent: cbe97e67ce162943, exportable:false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-06-30 09:43:24.022 [http-nio-9010-exec-8] DEBUG o.s.c.s.i.web.client.feign.TraceFeignClient - The modified request equals GET http://localhost:9001/product/findAll HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-B3-ParentSpanId: cbe97e67ce162943</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-B3-Sampled: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-B3-TraceId: cbe97e67ce162943</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-Span-Name: http:/product/findAll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X-B3-SpanId: bb1798f7a7c9c142</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 以下为服务端的日志输出：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[findAll] to a span [Trace: cbe97e67ce162943, Span: bb1798f7a7c9c142, Parent: cbe97e67ce162943, exportable:false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Adding a class tag with value [ProductController] to a span [Trace: cbe97e67ce162943, Span: bb1798f7a7c9c142, Parent: cbe97e67ce162943, exportable:false]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="基於服務的追踪service-based-tracing">基於服務的追踪(Service-Based Tracing)<a href="#基於服務的追踪service-based-tracing" class="hash-link" aria-label="Direct link to 基於服務的追踪(Service-Based Tracing)" title="Direct link to 基於服務的追踪(Service-Based Tracing)">​</a></h4><ul><li>服務追踪的實現思路是通過某些手段給目標應用注入追踪探針(Probe)</li></ul><p><a href="https://www.jaegertracing.io/" target="_blank" rel="noopener noreferrer">jaeger</a></p><ul><li>應用程序拓撲圖</li><li>實時監控您的應用程序</li><li>獲得對每筆交易的代碼級可見性</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="jaeger-tracing-architecture">Jaeger Tracing Architecture<a href="#jaeger-tracing-architecture" class="hash-link" aria-label="Direct link to Jaeger Tracing Architecture" title="Direct link to Jaeger Tracing Architecture">​</a></h4><blockquote><p><img loading="lazy" alt="Jaeger Tracing Architecture" src="/assets/images/10-14-883a01c3f46c61627d1112b649555b18.jpeg" width="1400" height="836" class="img_ev3q"></p></blockquote><blockquote><p><img loading="lazy" alt="jaeger" src="/assets/images/10-13-89f90329e9f67c5b21bf2be6858ad719.png" width="1400" height="546" class="img_ev3q"></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="基於邊車代理的追踪sidecar-based-tracing">基於邊車代理的追踪(Sidecar-Based Tracing)<a href="#基於邊車代理的追踪sidecar-based-tracing" class="hash-link" aria-label="Direct link to 基於邊車代理的追踪(Sidecar-Based Tracing)" title="Direct link to 基於邊車代理的追踪(Sidecar-Based Tracing)">​</a></h4><ul><li><p>服務網格
Envoy 是專為大型現代 SOA（Service-oriented Architecture 服務導向架構）架構設計的 L7 代理和<a href="https://zh.wikipedia.org/zh-tw/%E4%B8%B2%E8%A1%8C%E9%80%9A%E4%BF%A1" target="_blank" rel="noopener noreferrer">序列通訊</a>，體積小，性能高。它的誕生源於以下理念：
對於應用程序而言，網絡應該是透明的，當發生網絡和應用程序故障時，能夠很容易定位出問題的根源。</p></li><li><p>非侵入的架構 : Envoy 是一個獨立進程，設計為伴隨每個應用程序服務運行。
所有的 Envoy 形成一個透明的通信網格，每個應用程序發送消息到本地主機或從本地主機接收消息，
不需要知道網絡拓撲，對服務的實現語言也完全無感知，這種模式也被稱為 Sidecar。</p><blockquote><p><img loading="lazy" alt="envoy-sidecar" src="/assets/images/10-7-1d5012f7d2483cf545f9113eb1d896a0.png" width="480" height="480" class="img_ev3q"></p></blockquote></li></ul><blockquote><p>Ref: <a href="https://icloudnative.io/envoy-handbook/docs/overview/overview/" target="_blank" rel="noopener noreferrer">envoy-handbook</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="追踪規範什麼是-opentelemetry">追踪規範。什麼是 OpenTelemetry？<a href="#追踪規範什麼是-opentelemetry" class="hash-link" aria-label="Direct link to 追踪規範。什麼是 OpenTelemetry？" title="Direct link to 追踪規範。什麼是 OpenTelemetry？">​</a></h3><p><del>兩個規範搶話語權，最終握手和解產生 OpenTelemetry</del></p><p>OpenTelemetry 是一組 API 和 SDK，允許我們收集和導出跟踪、日誌和指標（也稱為可觀察性的三大支柱）。</p><p>它是一個 CNCF 社區驅動的開源項目（Cloud Native Computing Foundation，Kubernetes 的負責人）。</p><p>OpenTelemetry 使我們能夠檢測我們的雲原生應用程序。檢測您的代碼意味著從您系統中發生的事件中收集遙測數據，這最終有助於我們了解軟件的性能和行為。</p><p>OpenTelemetry 項目之所以獨一無二，主要有以下 3 個原因：</p><ul><li>它是開源的。</li><li>收集日誌、指標和跟踪，並充當將它們聚集在一起的粘合劑。</li><li>所有供應商都尊重的一種規範——標準的可觀察性框架。</li></ul><p>OpenTelemetry 用作標準的可觀察性框架，可在單一規範下捕獲所有遙測數據。</p><p>它提供了幾個組件，包括：</p><ul><li>用於生成遙測的每種編程語言的 API 和 SDK</li><li>OpenTelemetry 收集器；接收、處理遙測數據並將其導出到不同的目的地。</li><li>用於傳輸遙測數據的<a href="https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md" target="_blank" rel="noopener noreferrer">OTLP</a>協議</li></ul><p><a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a></p><p><a href="https://github.com/open-telemetry/opentelemetry-collector" target="_blank" rel="noopener noreferrer">OpenTelemetry Collector</a></p><p><a href="https://www.aspecto.io/blog/what-is-opentelemetry-the-infinitive-guide/?utm_source=jaeger-medium&amp;utm_medium=post&amp;utm_campaign=jaeger-tracing-the-ultimate-guide" target="_blank" rel="noopener noreferrer">What is OpenTelemetry? A Straightforward Guide</a></p><blockquote><p><img loading="lazy" alt="envoy-OpenTelemetry" src="/assets/images/10-8-cd5b9191b94d31d74685d49376b97401.webp" width="783" height="324" class="img_ev3q"></p></blockquote><p>Ref:<a href="https://blog.envoyproxy.io/envoy-support-for-opentelemetry-access-logging-e4b08160d32c" target="_blank" rel="noopener noreferrer">Announcing Alpha OpenTelemetry
access logging support in
Envoy</a></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>這週 Scrum</summary><div><div class="collapsibleContent_i85q"><p>iOS 專案我開始動手做 OpenTelemetry + Jaeger</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="聚合度量metrics">聚合度量(Metrics)<a href="#聚合度量metrics" class="hash-link" aria-label="Direct link to 聚合度量(Metrics)" title="Direct link to 聚合度量(Metrics)">​</a></h2><p>指標(Metrics)：是在一段固定間隔收集的測量或系統狀態的紀錄。</p><p><img loading="lazy" alt="Metrics" src="/assets/images/10-9-ef84d1017a5e301e129c2714dacdc192.webp" width="1134" height="511" class="img_ev3q"></p><p>指標可用來偵測或預測問題，例如突然飆高的 CPU 使用率或將要沒有使用空間的主機，
也可以用做更主動地分析來優化系統，最後還可以用來做衝擊分析(impact analysis)，像是應用服務掛掉的那段時間，
造成使用者不爽不用了或是對營收的影響等等。</p><p>本書用<a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus</a>介紹</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="指標收集">指標收集<a href="#指標收集" class="hash-link" aria-label="Direct link to 指標收集" title="Direct link to 指標收集">​</a></h3><p>指標收集部分要解決兩個問題：&quot;如何定義指標&quot;以及&quot;如何將這些指標告訴服務端&quot;</p><ul><li>計數度量器(Counter)：這是最好理解也是最常用的指標形式，計數器就是對有相同量綱、可加減數值的合計量，譬如業務指標像銷售額、貨物庫存量、職工人數等等；技術指標像服務調用次數、網站訪問人數等都屬於計數器指標。</li><li>瞬態度量器(Gauge)：瞬態度量器比計數器更簡單，它就表示某個指標在某個時點的數值，連加減統計都不需要。譬如當前 Java 虛擬機堆內存的使用量，這就是一個瞬態度量器；又譬如，網站訪問人數是計數器，而網站在線人數則是瞬態度量器。</li><li>吞吐率度量器(Meter)：吞吐率度量器顧名思義是用於統計單位時間的吞吐量，即單位時間內某個事件的發生次數。譬如交易系統中常以 TPS 衡量事務吞吐率，即每秒發生了多少筆事務交易；又譬如港口的貨運吞吐率常以“噸/每天”為單位計算，10 萬噸/天的港口通常要比 1 萬噸/天的港口的貨運規模更大。</li><li>直方圖度量器(Histogram)：直方圖是常見的二維統計圖，它的兩個坐標分別是統計樣本和該樣本對應的某個屬性的度量，以長條圖的形式表示具體數值。譬如經濟報告中要衡量某個地區歷年的 GDP 變化情況，常會以 GDP 為縱坐標，時間為橫坐標構成直方圖來呈現。</li><li>採樣點分位圖度量器(Quantile Summary)：分位圖是統計學中通過比較各分位數的分佈情況的工具，用於驗證實際值與理論值的差距，評估理論值與實際值之間的擬合度。譬如，我們說“高考成績一般符合正態分佈”，這句話的意思是：高考成績高低分的人數都較少，中等成績的較多，將人數按不同分數段統計，得出的統計結果一般能夠與正態分佈的曲線較好地擬合。
除了以上常見的度量器之外，還有 Timer、Set、Fast Compass、Cluster Histogram 等其他各種度量器，採用不同的度量系統，支持度量器類型的範圍肯定會有差別，譬如 Prometheus 支持了上面提到五種度量器中的 Counter、Gauge、Histogram 和 Summary 四種。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="如何將這些指標告訴服務端">如何將這些指標告訴服務端<a href="#如何將這些指標告訴服務端" class="hash-link" aria-label="Direct link to 如何將這些指標告訴服務端" title="Direct link to 如何將這些指標告訴服務端">​</a></h4><ul><li>推送式採集(Push-Based Metrics Collection)
Push 就是由目標系統主動向度量系統推送指標。</li><li>拉取式採集(Pull-Based Metrics Collection)
Pull 是指度量系統主動從目標系統中拉取指標
<a href="https://prometheus.io/docs/introduction/faq/#why-do-you-pull-rather-than-push?" target="_blank" rel="noopener noreferrer">why do you pull rather than push?</a></li></ul><blockquote><p><img loading="lazy" alt="prometheus-stake" src="/assets/images/prometheus-stake-87eff3cf7157ad0a423d2a07d5b159ab.jpeg" width="1280" height="881" class="img_ev3q"></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="存儲查詢">存儲查詢<a href="#存儲查詢" class="hash-link" aria-label="Direct link to 存儲查詢" title="Direct link to 存儲查詢">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;timestamp&quot;: 1599117392,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 指标名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;metric&quot;: &quot;total_website_visitors&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 标签组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tags&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;host&quot;: &quot;icyfenix.cn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;job&quot;: &quot;prometheus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 指标值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: 10086</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="監控預警">監控預警<a href="#監控預警" class="hash-link" aria-label="Direct link to 監控預警" title="Direct link to 監控預警">​</a></h4><p>Prometheus 配合<a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana</a></p><p>指標是數據的數字表示。它包括名稱、標籤、值、發生時間等值，並傳達有關應用程序組件的資訊。</p><p>它們代表被監視的系統或應用程序的特定方面。它們提供了一種衡量系統性能、健康狀況和行為的方法，可用於識別問題、觸發警報和衡量變更的影響。</p><p>通常監控的一些常見指標類型包括：</p><ul><li>資源利用率指標：這些指標衡量各種系統資源的利用率，如 CPU、內存、磁盤空間、網絡帶寬等。</li><li>性能指標：這些指標衡量系統的性能，例如響應時間、延遲、吞吐量等。</li><li>錯誤率指標：這些指標衡量系統中發生的錯誤、異常或故障的數量。</li><li>飽和度指標：這些指標衡量資源被利用的程度，例如活動連接數、打開文件等。</li><li>可用性指標：這些指標衡量系統的可用性，例如係統正常運行的時間百分比、不可用的次數等。</li><li>可以使用多種方法收集指標，包括手動監控、系統日誌和專門的監控工具。指標的選擇將取決於被監控的系統和監控工作的目標。</li></ul><p>度量標準的目的是通知系統管理員他們的應用程序健康狀況。它在各個領域的表現如何，需要緊急關注什麼。</p><p>它帶有警報功能；每當某個指標超過閾值時，用<a href="https://zh.wikipedia.org/zh-tw/%E7%BD%91%E7%BB%9C%E9%92%A9%E5%AD%90" target="_blank" rel="noopener noreferrer">Webhook</a>通知，
管理員就會收到消息。這使他能夠在有針對性的問題上迅速採取行動。</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>未來週 Scrum</summary><div><div class="collapsibleContent_i85q"><p>某後端專案我開始動手做 <a href="https://blog.techbridge.cc/2019/08/26/how-to-use-prometheus-grafana-in-flask-app/" target="_blank" rel="noopener noreferrer">Prometheus + Grafana</a></p></div></div></details></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/fenix-architecture/ch10.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-06-12T03:16:35.000Z">Jun 12, 2024</time></b> by <b>Mech</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/sg/fenix-architecture/ch9"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ch9: 可靠通信</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/sg/fenix-architecture/ch11"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ch11: 虛擬化容器</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#可觀測性observability" class="table-of-contents__link toc-highlight">可觀測性(Observability)</a><ul><li><a href="#可觀測性-observability-三大支柱" class="table-of-contents__link toc-highlight">可觀測性 (Observability) 三大支柱</a></li><li><a href="#日誌-logging" class="table-of-contents__link toc-highlight">日誌 (Logging)</a></li><li><a href="#追踪-tracing" class="table-of-contents__link toc-highlight">追踪 (Tracing)</a></li><li><a href="#指標-metrics" class="table-of-contents__link toc-highlight">指標 (Metrics)</a></li><li><a href="#日誌指標和追踪是相互關聯的" class="table-of-contents__link toc-highlight">日誌、指標和追踪是相互關聯的</a></li></ul></li><li><a href="#事件日志" class="table-of-contents__link toc-highlight">事件日志</a><ul><li><a href="#輸出" class="table-of-contents__link toc-highlight">輸出</a></li><li><a href="#收集與緩衝" class="table-of-contents__link toc-highlight">收集與緩衝</a></li><li><a href="#加工與聚合" class="table-of-contents__link toc-highlight">加工與聚合</a></li><li><a href="#存儲與查詢" class="table-of-contents__link toc-highlight">存儲與查詢</a></li></ul></li><li><a href="#鏈路追踪tracinganalysis" class="table-of-contents__link toc-highlight">鏈路追踪(TracingAnalysis)</a></li><li><a href="#追踪與跨度" class="table-of-contents__link toc-highlight">追踪與跨度</a><ul><li><a href="#數據收集" class="table-of-contents__link toc-highlight">數據收集</a></li><li><a href="#追踪規範什麼是-opentelemetry" class="table-of-contents__link toc-highlight">追踪規範。什麼是 OpenTelemetry？</a></li></ul></li><li><a href="#聚合度量metrics" class="table-of-contents__link toc-highlight">聚合度量(Metrics)</a><ul><li><a href="#指標收集" class="table-of-contents__link toc-highlight">指標收集</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024. DEX Study Group</div></div></div></footer></div>
<script src="/assets/js/runtime~main.20c108ea.js"></script>
<script src="/assets/js/main.2d5dd4a1.js"></script>
</body>
</html>