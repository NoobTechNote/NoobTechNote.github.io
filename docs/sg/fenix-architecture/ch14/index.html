<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-sg/fenix-architecture/ch14">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Ch14: 資源與調度 | Noob Tech Note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch14"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ch14: 資源與調度 | Noob Tech Note"><meta data-rh="true" name="description" content="調度是指為新創建出來的 Pod 尋找到一個最恰當的宿主機節點來運行它，這個過程成功與否、結果恰當與否，關鍵取決於容器編排系統是如何管理與分配集群節點的資源的。"><meta data-rh="true" property="og:description" content="調度是指為新創建出來的 Pod 尋找到一個最恰當的宿主機節點來運行它，這個過程成功與否、結果恰當與否，關鍵取決於容器編排系統是如何管理與分配集群節點的資源的。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch14"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch14" hreflang="en"><link data-rh="true" rel="alternate" href="https://noobtechnote.github.io/docs/sg/fenix-architecture/ch14" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7933f3c4.css">
<link rel="preload" href="/assets/js/runtime~main.35c1734a.js" as="script">
<link rel="preload" href="/assets/js/main.912b5dd3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon-144.png" alt="Noob Tech Note" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Noob Tech Note</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/sg">Study Group</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/sg/">Study Group Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Study Group Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/clean-architecture/">Clean Architecture</a><button aria-label="Toggle the collapsible sidebar category &#x27;Clean Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/sg/fenix-architecture/">鳳凰架構</a><button aria-label="Toggle the collapsible sidebar category &#x27;鳳凰架構&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch0">Ch0: 前言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch1">Ch1: 服務架構演進史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch2">Ch2: 存取遠端服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch3">Ch3: 交易處理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4">Ch4: 透明多級分流系統</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch4.5-6">Ch4.5~6: 負載均衡和服務端緩存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch5">Ch5: 架構安全性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch6">Ch6: 分佈式共識算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch7">Ch7: 從函式庫到服務</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch8">Ch8: 流量治理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch9">Ch9: 可靠通信</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch10">Ch10: 可觀測性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch11">Ch11: 虛擬化容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch12">Ch12: 容器間網路</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch13">Ch13: 持久化存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/sg/fenix-architecture/ch14">Ch14: 資源與調度</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch15">Ch15: 服務網格</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sg/fenix-architecture/ch16">Ch16: 向微服務邁進</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/fundamentals-of-software-architecture/">軟體架構原理 - 工程方法</a><button aria-label="Toggle the collapsible sidebar category &#x27;軟體架構原理 - 工程方法&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/sg/web-api-the-good-parts/">Web API: The Good Parts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web API: The Good Parts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/"><span itemprop="name">Study Group Notes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/sg/fenix-architecture/"><span itemprop="name">鳳凰架構</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ch14: 資源與調度</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>資源與調度</h1><blockquote><p>調度是指為新創建出來的 Pod 尋找到一個最恰當的宿主機節點來運行它，這個過程成功與否、結果恰當與否，關鍵取決於容器編排系統是如何管理與分配集群節點的資源的。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="資源模型">資源模型<a href="#資源模型" class="hash-link" aria-label="Direct link to 資源模型" title="Direct link to 資源模型">​</a></h2><p>資源在 Kubernetes 中是極為常用的術語，廣義上講，Kubernetes 系統中所有你能夠接觸的方方面面都被抽象成了資源</p><ul><li>工作負荷的資源（Pod、ReplicaSet、Service、……）</li><li>存儲的資源（Volume、PersistentVolume、Secret、……）</li><li>策略的資源（SecurityContext、ResourceQuota、LimitRange、……）</li><li>身份的資源（ServiceAccount、Role、ClusterRole、……）</li></ul><p>從編排系統的角度來看，Node 是資源的提供者，Pod 是資源的使用者，調度是將兩者進行恰當的撮合。</p><p>Node 通常能夠提供的三方面的資源：</p><ul><li>計算資源（如處理器、圖形處理器、內存）<ul><li>處理器這樣的資源被稱作可壓縮資源（Compressible Resources）</li><li>內存這樣的資源，則被稱作不可壓縮資源（Incompressible Resources）</li></ul></li><li>存儲資源（如磁盤容量、不同類型的介質）</li><li>網絡資源（如帶寬、網絡地址）</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="服務質量與優先級">服務質量與優先級<a href="#服務質量與優先級" class="hash-link" aria-label="Direct link to 服務質量與優先級" title="Direct link to 服務質量與優先級">​</a></h2><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>設定資源計量單位的目的是為了管理員能夠限制某個 Pod 對資源的過度佔用，避免影響到其他 Pod 的正常運行。</p></div></div><ul><li>具體的配置是 Pod 的 <code>spec.containers[].resource.limits/requests.cpu/memory</code> 字段。<ul><li><code>requests</code> 是給調度器用的，Kubernetes 選擇哪個節點運行 Pod，只會根據 <code>requests</code> 的值來進行決策</li><li><code>limits</code> 才是給 cgroups 用的，Kubernetes 在向 cgroups 的傳遞資源配額時，會按照 <code>limits</code> 的值來進行設置。</li></ul></li></ul><p><strong>服務質量等級（Quality of Service Level，QoS Level）</strong></p><blockquote><p>質量等級是 Pod 的一個隱含屬性，也是 Kubernetes 優先保障重要的服務，放棄一些沒那麼重要的服務的衡量準繩。</p></blockquote><p>Kubernetes 目前提供的服務質量等級一共分為三級，由高到低分別為 Guaranteed、Burstable 和 BestEffort。</p><ul><li>Guaranteed: Pod 中所有的容器都設置了 <code>limits</code> 和 <code>requests</code>，且兩者的值相等</li><li>Burstable: Pod 中有部分容器的 <code>requests</code> 值小於 <code>limits</code> 值，或者只設置了 <code>requests</code> 而未設置 limits</li><li>BestEffort: <code>limits</code> 和 <code>requests</code> 兩個都沒設置</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>除了服務質量等級以外，Kubernetes 還允許系統管理員自行決定 Pod 的優先級，這是通過類型為 PriorityClass 的資源來實現的。</p></div></div><p><strong>優先級（Priority）</strong></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>優先級會影響調度這很容易理解，它是指當多個 Pod 同時被調度的話，高優先級的 Pod 會優先被調度。</p></div></div><p>優先級影響更大的另一方面是指 Kubernetes 的<strong>搶占機制（Preemption）</strong>，正常未設置優先級的情況下，如果 Pod 調度失敗，就會暫時處於 Pending 狀態被擱置起來，直到集群中有新節點加入或者舊 Pod 退出。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="驅逐機制">驅逐機制<a href="#驅逐機制" class="hash-link" aria-label="Direct link to 驅逐機制" title="Direct link to 驅逐機制">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Pod 的驅逐機制是通過 kubelet 來執行的，kubelet 是部署在每個節點的集群管理程序，由於本身就運行在節點中，所以最容易感知到節點的資源實時耗用情況。kubelet 一旦發現某種不可壓縮資源將要耗盡，就會主動終止節點上較低服務質量等級的 Pod，以保證其他更重要的 Pod 的安全。被驅逐的 Pod 中所有的容器都會被終止，Pod 的狀態會被更改為 Failed。</p></div></div><ul><li>可用內存（<code>memory.available</code>）</li><li>宿主機的可用磁盤空間（<code>nodefs.available</code>）</li><li>文件系統可用 inode 數量（<code>nodefs.inodesFree</code>）</li><li>可用的容器運行時鏡像存儲空間（<code>imagefs.available</code>）</li></ul><p>後面三個的閾值都是按照實際容量的百分比來計算的，具體的默認值如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">memory.available &lt; 100Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nodefs.available &lt; 10%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nodefs.inodesFree &lt; 5%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imagefs.available &lt; 15%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>管理員可以在 kubelet 啟動時，通過命令行參數來修改這些默認值</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubelet --eviction-hard</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">memory.available</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>驅逐機制中就有了軟驅逐（Soft Eviction）、硬驅逐（Hard Eviction）以及優雅退出期（Grace Period）的概念：</p><ul><li><strong>軟驅逐</strong>：通常配置一個較低的警戒線（譬如可用內存僅剩 20%），觸及此線時，系統將進入一段觀察期。</li><li><strong>硬驅逐</strong>：通常配置一個較高的終止線（譬如可用內存僅剩 10%），一旦觸及此紅線，立即強制殺掉 Pod，不理會優雅退出。</li></ul><p>軟驅逐是為了減少資源抖動對服務的影響，硬驅逐是為了保障核心系統的穩定，它們並不矛盾，一般會同時使用，譬如以下例子所示：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubelet --eviction-hard</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">memory.available</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">% </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          --eviction-soft</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">memory.available</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">20</span><span class="token plain">% </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          --eviction-soft-grace-period</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">memory.available</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">1m30s </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          --eviction-max-pod-grace-period</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="默認調度器">默認調度器<a href="#默認調度器" class="hash-link" aria-label="Direct link to 默認調度器" title="Direct link to 默認調度器">​</a></h2><p>Kubernetes 是如何撮合 Pod 與 Node 的，這其實也是最困難的一個問題。調度是為新創建出來的 Pod 尋找到一個最恰當的宿主機節點去運行它，這句話裡就包含有“運行”和“恰當”兩個調度中關鍵過程，它們具體是指：</p><ol><li><strong>運行</strong>：從集群所有節點中找出一批剩餘資源可以滿足該 Pod 運行的節點。為此，Kubernetes 調度器設計了一組名為 Predicate 的篩選算法。</li><li><strong>恰當</strong>：從符合運行要求的節點中找出一個最適合的節點完成調度。為此，Kubernetes 調度器設計了一組名為 Priority 的評價算法。</li></ol><p><strong>共享狀態（Shared State）的雙循環調度機制</strong></p><p>這種調度機制後來不僅應用在 Google 的 Omega 系統（Borg 的下一代集群管理系統）中，也同樣被 Kubernetes 繼承了下來。</p><p><img loading="lazy" alt="圖14-1 狀態共享的雙循環" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAx0AAAFZCAMAAADKEbLyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozNjRDODBENDBBRDIxMUVCQTMyOUY2RDczMzYyQzNBMiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozNjRDODBENTBBRDIxMUVCQTMyOUY2RDczMzYyQzNBMiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjM2NEM4MEQyMEFEMjExRUJBMzI5RjZENzMzNjJDM0EyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjM2NEM4MEQzMEFEMjExRUJBMzI5RjZENzMzNjJDM0EyIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+TuHsswAAAYBQTFRFycnJ9vb2np6e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" width="797" height="345" class="img_ev3q"></p><ul><li><p><strong>Informer Loop</strong></p><ul><li>它是一系列 Informer 的集合，這些 Informer 持續監視 Etcd 中與調度相關資源（主要是 Pod 和 Node）的變化情況，一旦 Pod、Node 等資源出現變動，就會觸發對應 Informer 的 Handler。</li><li>根據 Etcd 中的資源變化去更新調度隊列（Priority Queue）和調度緩存（Scheduler Cache）中的信息，譬如當有新 Pod 生成，就將其入隊（Enqueue）到調度隊列中，如有必要，還會根據優先級觸發上一節提到的插隊和搶占操作。</li></ul></li><li><p><strong>Scheduler Loop</strong></p><blockquote><p>核心邏輯是不停地將調度隊列中的 Pod 出隊（Pop），然後使用 Predicate 算法進行節點選擇。</p></blockquote><ul><li><strong>Predicate</strong><blockquote><p>一組節點過濾器（Filter）</p><ul><li><strong>通用過濾策略</strong>：最基礎的調度過濾策略，用來檢查節點是否能滿足 Pod 聲明中需要的資源。</li><li><strong>卷過濾策略</strong>：與存儲相關的過濾策略，用來檢查節點掛載的 Volume 是否存在衝突（譬如將一個塊設備掛載到兩個節點上），或者 Volume 的可用區域是否與目標節點衝突，等等。</li><li><strong>節點過濾策略</strong>：與宿主機相關的過濾策略，最典型的是 Kubernetes 的污點與容忍度機制（Taints and Tolerations），譬如默認情況下 Kubernetes 會設置 Master 節點不允許被調度，這就是通過在 Master 中施加污點來避免的。</li></ul></blockquote></li></ul></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Predicate 算法所使用的一切數據均來自於調度緩存，絕對不會去遠程訪問節點本身。只有 Informer Loop 與 Etcd 的監視操作才會涉及到遠程調用，Scheduler Loop 中除了最後的異步綁定要發起一次遠程的 Etcd 寫入外，其餘全部都是進程內訪問，這一點是調度器執行效率的重要保證。</p></div></div><p>調度緩存就是兩個控制循環的共享狀態（Shared State），這樣的設計避免了每次調度時主動去輪詢所有集群節點，保證了調度器的執行效率。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/fenix-architecture/ch14.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-15T16:41:40.000Z">Aug 15, 2023</time></b> by <b>Mech</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/sg/fenix-architecture/ch13"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ch13: 持久化存储</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/sg/fenix-architecture/ch15"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ch15: 服務網格</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#資源模型" class="table-of-contents__link toc-highlight">資源模型</a></li><li><a href="#服務質量與優先級" class="table-of-contents__link toc-highlight">服務質量與優先級</a></li><li><a href="#驅逐機制" class="table-of-contents__link toc-highlight">驅逐機制</a></li><li><a href="#默認調度器" class="table-of-contents__link toc-highlight">默認調度器</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023. DEX Study Group</div></div></div></footer></div>
<script src="/assets/js/runtime~main.35c1734a.js"></script>
<script src="/assets/js/main.912b5dd3.js"></script>
</body>
</html>