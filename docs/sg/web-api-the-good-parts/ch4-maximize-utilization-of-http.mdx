---
title: "Ch4: æœ€å¤§åŒ–çš„åˆ©ç”¨HTTP Protocol"
sidebar_label: "Ch4: æœ€å¤§åŒ–çš„åˆ©ç”¨HTTP Protocol"
sidebar_position: 4
---

## 4.1 ä½¿ç”¨ HTTP å”è­°è¦ç¯„çš„æ„ç¾©

    - RFC (Request For Comments)

![http_request_message_format](./ch4/http_request_message_format.png)
![http_response_message_format](./ch4/http_response_message_format.png)

Image From:[The TCP/IP Guide](http://www.tcpipguide.com/free/t_HTTPGenericMessageFormat.htm)

## 4.2 æ­£ç¢ºä½¿ç”¨ç‹€æ…‹ç¢¼

### HTTP ç‹€æ…‹ç¢¼å¯å€åˆ†ç‚ºäº”å¤§é¡ï¼š

- 1xx æ¶ˆæ¯
- 2xx æˆåŠŸ
- 3xx é‡æ–°å°å‘
- 4xx å®¢æˆ¶ç«¯éŒ¯èª¤
- 5xx ä¼ºæœå™¨éŒ¯èª¤

**ä¸»è¦çš„ç‹€æ…‹ç¢¼**

| Status code | Nmae                   | Description                          |
| ----------- | ---------------------- | ------------------------------------ |
| 200         | OK                     | è«‹æ±‚æˆåŠŸ                             |
| 201         | Created                | è«‹æ±‚å·²è¢«æ¥å—ï¼Œæ–°çš„è³‡æºå·²å‰µå»º         |
| 202         | Accepted               | è«‹æ±‚æˆåŠŸ                             |
| 204         | No Content             | æ²’æœ‰å…§å®¹                             |
| 300         | Multiple Choices       | è¿”å›å¤šæ¢é‡å®šå‘ä¾›é¸æ“‡                 |
| 301         | Moved Permanently      | æ°¸ä¹…é‡å®šå‘                           |
| 302         | Found                  | è‡¨æ—¶é‡å®šå‘                           |
| 303         | See Other              | ç•¶å‰è«‹æ±‚çš„è³‡æºåœ¨å…¶å®ƒåœ°å€             |
| 304         | Not Modified           | è«‹æ±‚è³‡æºèˆ‡æœ¬åœ°ç·©å­˜ç›¸åŒï¼Œæœªä¿®æ”¹       |
| 307         | Temporary Redirect     | è‡¨æ™‚é‡å®šå‘ï¼ŒåŒ 302                   |
| 400         | Bad Request            | è«‹æ±‚éŒ¯èª¤ï¼Œé€šå¸¸æ˜¯è¨ªå•çš„åŸŸåæœªç¶å®šå¼•èµ· |
| 401         | Unauthorized           | éœ€è¦èº«ä»½è®¤è¯éªŒè¯                     |
| 403         | Forbidden              | ç¦æ­¢è¨ªå•                             |
| 404         | Not Found              | è«‹æ±‚çš„å…§å®¹æœªæ‰¾åˆ°æˆ–å·²åˆªé™¤             |
| 405         | Method Not Allowed     | ä¸å…è®¸çš„è¯·æ±‚æ–¹æ³•                     |
| 406         | Not Acceptable         | ç„¡æ³•éŸ¿æ‡‰ï¼Œå› è³‡æºç„¡æ³•æ»¿è¶³å®¢æˆ¶ç«¯æ¢ä»¶   |
| 408         | Request Timeout        | è«‹æ±‚è¶…æ™‚                             |
| 409         | Conflict               | å­˜åœ¨è¡çª                             |
| 410         | Gone                   | è³‡æºå·²ç¶“ä¸å­˜åœ¨(éå»å­˜åœ¨)             |
| 413         | Payload Too Large      | è«‹æ±‚çš„ URI éé•·                      |
| 414         | Request-URI Too Long   | è«‹æ±‚è³‡æºèˆ‡æœ¬åœ°ç·©å­˜ç›¸åŒï¼Œæœªä¿®æ”¹       |
| 415         | Unsupported Media Type | ç„¡æ³•è™•ç†çš„åª’é«”æ ¼å¼                   |
| 429         | Too Many Requests      | ä¸¦ç™¼è«‹æ±‚éå¤š                         |
| 500         | Internal Server Error  | æœå‹™å™¨ç«¯ç¨‹åºéŒ¯èª¤                     |
| 503         | Service Unavailable    | æœå‹™å™¨ç«¯è‡¨æ™‚éŒ¯èª¤                     |

```
HTTP/1.1 200 OK
Content-Type: application/json

{
    "head": {
        "errorCode": 1001,
        "errorMessage": "Invalid parameter"
    },
    "body": {
        :
    }
}
```

## 4.3 Cache èˆ‡ HTTP

- æ¸›å°‘æœå‹™å™¨çš„é€£ç·šæ•¸é‡ï¼Œå¯ä»¥æå‡ç”¨æˆ¶è¨ªå•é€Ÿåº¦
- åœ¨ç¶²è·¯é€£ç·šæ–·é–‹çš„ç‹€æ…‹ä¸‹ä¹Ÿå¯ä»¥åœ¨æŸç¨®ç¨‹åº¦æä¾›æœå‹™
- å®¢æˆ¶ç«¯å°‡è³‡æ–™æš«å­˜

:::info Discussion
åå‘ä»£ç†æœå‹™å™¨ Reverse Proxy
:::

### 4.3.1 éæœŸæ¨¡å‹(Expiration Model)

- ç·©å­˜å¯ç”¨ç‹€æ…‹ fresh(æ–°é®®)
- ç·©å­˜ä¸å¯ç”¨ç‹€æ…‹ stale(ä¸æ–°é®®)

:::info Discussion
ä½ æœ‰ç”¨é Expires, Cache-Control çš„ç¶“é©—å—ï¼Ÿ
:::

> HTTP æ™‚é–“æ ¼å¼, åªèƒ½ç”¨ GMT æ™‚å€

### 4.3.2 é©—è­‰æ¨¡å‹(Validation Model)

æœ€å¾Œæ›´æ–°æœƒå¡«åœ¨ Last-Modified, ETag

```
Last-Modified: Tue, 01 Jul 2014 00:00:00 GMT
ETag: "ff39b31e285573ee373af0d492aca581"
```

    - MD5, SHA1

å¼·æ ¡é©—å’Œå¼±æ ¡é©—

```
"123456789" -- ä¸€å€‹å¼·ETagé©—è­‰ç¬¦
W/"123456789" -- ä¸€å€‹å¼±ETagé©—è­‰ç¬¦
```

:::info Discussion
ä½ æœ‰åšéé©—è­‰æ¨¡å‹çš„ç›¸é—œåŠŸèƒ½å—ï¼Ÿ
:::

### 4.3.3 å•Ÿç™¼å¼éæœŸ(Heuristic Expiration)

client ç«¯æ ¹æ“š server ç«¯çš„æ›´æ–°é »ç‡,å…·é«”ç‹€æ…‹ç­‰è¨Šæ¯ï¼Œè‡ªè¡Œæ±ºå®šç·©å­˜æ™‚é–“ã€‚

### 4.3.4 ä¸å¸Œæœ›å¯¦æ–½ç·©å­˜çš„æƒ…æ³

```
Cache-Control: no-cache
```

### 4.3.5 ä½¿ç”¨ Vary ä¾†æŒ‡å®šç·©å­˜å–®ä½

æœå‹™å™¨é©…å‹•çš„å…§å®¹å”å•†(Server Driven Content Negotiation)

```
Accept-Language: ja
Vary: Accept-Language
```

## 4.4 Content-Type çš„æŒ‡å®š

Content-Type æ˜¯ä¸€å€‹çš„ HTTP Headerï¼Œç”¨ä¾†å‘Šè¨´å°æ–¹è‡ªå·±æ‰€å‚³é€çš„é€™åŒ… payload æ˜¯ä»€éº¼æ¨£çš„é¡å‹

```
Content-Type: type/subtype [;options]

# Example
Content-Type: text/html; charset=utf-8
```

### èˆ‡ Content-Type æœ‰é—œçš„æƒ…å¢ƒ

#### Request æ¨™æ˜ Server çš„è™•ç†æ–¹å¼

- ä¾‹å¦‚ï¼ŒAWS API Gateway å°æ–¼ä¸åŒçš„ request Content-Type æœ‰ä¸€å¥—é è¨­çš„[è™•ç†æ–¹å¼](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-payload-encodings-workflow.html)

#### Response æ§åˆ¶ç€è¦½å™¨çš„è¡Œç‚º

- Github ç”¨`text/plain`å‚³é€çš„ JS Source code å…§å®¹ï¼Œè®“ç€è¦½å™¨ç›´æ¥æª¢è¦– source code è€Œä¸æœƒè¢«æ„å¤–åŸ·è¡Œ
  https://raw.githubusercontent.com/NoobTechNote/NoobTechNote.github.io/main/sidebars.js

å¦‚æœåœ¨ HTML å…§ä½¿ç”¨`<script>`Tag å­˜å–ä¸Šé¢çš„ js linkï¼Œæœƒå¾—åˆ°éŒ¯èª¤

```
Refused to execute script from 'https://raw.githubusercontent.com/NoobTechNote/NoobTechNote.github.io/main/sidebars.js'
because its MIME type ('application/json') is not executable, and strict MIME type checking is enabled.
```

:::info Notice
ä¸€å€‹å¸¸è¦‹çš„éŒ¯èª¤å…¶å¯¦æ˜¯ä½¿ç”¨Content-Type: text/htmlå‚³é€Javascriptå…§å®¹çµ¦å‰ç«¯ã€‚å¦‚æœä½ éƒ½é‡éé€™é¡å•é¡Œï¼Œæ˜¯å› ç‚ºä½ ç”¨çš„Backend Frameworkæœ‰åœ¨å¹«ä½ è™•ç†Responseçš„Content-Type

ä¾‹å¦‚ PHP çš„ [Symfony Response](https://github.com/symfony/symfony/blob/6.2/src/Symfony/Component/HttpFoundation/Response.php#L259)
:::

:::caution
ç€è¦½å™¨å…¶å¯¦ä¸ç¸½æ˜¯æœƒè½ Content-Type çš„æ„æ€ï¼Œæœ‰æ™‚æœƒä¾ç…§å…§å®¹çŒœæ¸¬ï¼Œè©²ç”¨ä»€éº¼è¡Œç‚ºè™•ç†é€™å€‹ HTTP response

X-Content-Type-Options: nosniff å¯ä»¥å”åŠ©ä½ é˜»æ­¢ç€è¦½å™¨çŒœæ¸¬ response å…§å®¹å°è‡´éé æœŸçš„è¡Œç‚º
:::

### Response çš„ Content Type

#### å¸¸è¦‹çš„ Content-Type

| Content-Type           | å«ç¾©                                                                                                           |
| ---------------------- | -------------------------------------------------------------------------------------------------------------- |
| text/plain             | ç´”æ–‡å­— [(è¨» 1)](#anchor1)                                                                                      |
| text/html              | HTML æ–‡ä»¶ [(è¨» 1)](#anchor1)                                                                                   |
| application/xml        | XML æ–‡ä»¶                                                                                                       |
| application/rss+xml    | RSS XML æ–‡ä»¶                                                                                                   |
| application/json       | JSON æ–‡ä»¶                                                                                                      |
| text/css               | CSS æ–‡ä»¶                                                                                                       |
| application/javascript | Javascript ç¨‹å¼ï¼ŒèˆŠç¨± text/javascriptï¼Œä½†åœ¨[RFC4329](https://datatracker.ietf.org/doc/html/rfc4329#page-9)å»¢é™¤ |
| multipart/form-data    | è¡¨å–®è³‡æ–™ï¼Œå¸¸ç”¨åœ¨ Form POST Request                                                                             |
|                        |                                                                                                                |

<p id='anchor1'>
  <strong>è¨»1</strong>ï¼š èªæ„ä¸Šå…¶å¯¦è©²å±¬æ–¼<code>application/</code>
  ï¼Œä½†å› ç‚ºæ­·å²å› ç´ ç¶­æŒ<code>text/</code>åˆ†é¡
</p>

#### X- é–‹é ­çš„ Content Type

`x-`é–‹é ­çš„ Content Type ä»£è¡¨æ²’æœ‰åœ¨ IANA è¨»å†Šï¼Œé€šå¸¸å…·å‚™ç‰¹æ®Šç”¨é€”ï¼Œæˆ–æ˜¯è‡ªå®šç¾©çš„ Content Type æœƒä½¿ç”¨`x-`é–‹é ­å»å®šç¾©ï¼Œä¾‹å¦‚

| Content Type          |                                                 |
| --------------------- | ----------------------------------------------- |
| application/x-msgpack | MessagePack                                     |
| application/x-yaml    | YAML æ–‡ä»¶                                       |
| application/x-plist   | Mac çš„ property listï¼Œå¸¸è¦‹æ–¼ä¸‹è¼‰ iOS App çš„å¼•å° |

ä½†ï¼Œå› ç‚ºæ­·å²å› ç´ ï¼Œæœ‰äº›`x-`é–‹é ­çš„ Content Type æ˜¯æœ‰åœ¨ IANA è¨»å†Šçš„

| Content Type             |                              |
| ------------------------ | ---------------------------- |
| application/x-javascript | Javascript ç¨‹å¼              |
| application/x-json       | JSON æ–‡ä»¶                    |
| image/x-png              | PNG åœ–ç‰‡                     |
| x-www-form-urlencoded    | HTML Form [(è¨» 2)](#anchor2) |

<p id='anchor2'>
  <strong>è¨»2</strong>
  ï¼šç”¨`x-www-form-urlencoded`å‚³é€çš„è³‡æ–™ï¼Œå³ä½¿ä½ ç”¨POSTå‚³é€ï¼Œä½†å¯¦éš›ä¸Šæœƒè¢«åšURL Encodeæ”¾åœ¨URLä¸Šã€‚å› ç‚ºURLç„¡æ³•åŠ å¯†ï¼Œå¦‚æœå¸¶æœ‰æ•æ„Ÿè¨Šæ¯å¾ˆå®¹æ˜“æœƒè¢«å„ç¨®logæˆ–ä¸­é–“äººæ””æˆª
</p>

#### è‡ªå®šç¾©çš„ Content Type

[RFC6838](https://datatracker.ietf.org/doc/html/rfc6838#section-3)æœ‰è¦å®šä¸€çµ„ï¼Œå¦‚æœä½ éœ€è¦è‡ªå·±å®šç¾© Content Type æ™‚çš„åƒè€ƒ

- Standard Tree: ç„¡å‰ç¶´ï¼Œæ¨™æº–ä¸­æœ‰å®šç¾©çš„ content-typeï¼Œå±¬æ–¼è¢«ä¿ç•™çš„ä¸€ç¾¤
- Vendor Tree: `vnd`ï¼Œæœ‰è¢« IANA èªè­‰éçš„å…¬å¸ä½¿ç”¨ã€‚é€šå¸¸æœƒè¢«å¤§ç¯„åœä½¿ç”¨ï¼Œä½†ç”±ç‰¹å®šå…¬å¸ç®¡ç†
  - application/vnd.ms-excel
  - application/vnd.github.v3+json
- Personal Tree: `prs.`ï¼Œå€‹äººä½¿ç”¨ï¼Œæˆ–å¯¦é©—æ€§ç”¨é€”ï¼Œåªåœ¨éå…¬é–‹çš„ç‹€æ³ä¸‹è¢«ä½¿ç”¨
  - appliccation/prs.mech.v1+json
- Unregistered Tree: `x.`ï¼Œåƒ…ç§æœ‰ä½¿ç”¨ï¼Œä¸èƒ½è¢«è¨»å†Š

:::caution
æ³¨æ„`x.`è·Ÿ`x-`æ˜¯ä¸åŒçš„ï¼Œå¾Œè€…æ˜¯æœ‰å¯èƒ½è¢«è¨»å†Šæˆæ¨™æº–çš„ä¸€éƒ¨ä»½
:::

:::info Discussion
ä½ æœ‰ç”¨ééæ¨™æº–çš„Content Typeå—ï¼Ÿå¥½ç”¨å—ï¼Ÿåœ¨ä»¥ä¸‹ä¾‹å­ä¸­ï¼ŒGithubçš„APIç‚ºä»€éº¼é€™éº¼å›æ‡‰ï¼Ÿ

```
HTTP/1.1 200 OK
Server: Github.com
Content-Type: application/json; charset=utf-8
X-GitHub-Media-Type: github.v3
```

:::

### Request çš„ Content Type

Accept: æˆ‘èƒ½å¤ åƒæ€æ¨£çš„Responseæ ¼å¼
Content-Type: å®£å‘Šç›®å‰å‚³é€çš„payloadæ˜¯æ€æ¨£çš„æ ¼å¼

#### Accept Header

- `q`å¯ä»¥æŒ‡å®šå„ªå…ˆç´šï¼Œæ•¸å­—è¶Šå¤§å„ªå…ˆæ¬Šè¶Šé«˜ï¼Œé è¨­æ˜¯æœ€é«˜`1`
- æ‰€æœ‰å›æ‡‰æ ¼å¼éƒ½åƒçš„è©±ï¼Œä½¿ç”¨`*/*`

ç¿»è­¯ï¼š_æˆ‘åƒ html, xhtmlï¼Œä½†å¦‚æœéƒ½æ²’æœ‰çš„è©±ï¼Œä¹Ÿå¯ä»¥çµ¦æˆ‘ xmlï¼Œå†æ²’æœ‰å¯ä»¥çµ¦æˆ‘ webpï¼ŒçœŸçš„æ²’è¾¦æ³•å°±éš¨ä¾¿å§_

```
Accept: text/html,application/xhtml+xml,application/xml;q=0.9;image/webp,*/*;q=0.8
```

ç¿»è­¯ï¼š_æˆ‘åƒ jsonï¼Œä½†æ²’è¾¦æ³•çš„è©± xml ä¹Ÿå¯ä»¥_

```
Accept: application/json,application/xml;q=0.9
```

#### Vary: Accept

åœ¨æœ‰ API Gateway, Reversed Proxy å­˜åœ¨è«‹æ±‚ç«¯èˆ‡ä¼ºæœç«¯çš„ä¸­é–“æ™‚ï¼ŒAccept Header æœ‰å¯èƒ½æœƒè¢«æ”¹è®Šã€‚

æ­¤æ™‚éœ€è¦åŠ ä¸Š`Vary: Accept` Header è¦æ±‚ Gateway è½‰äº¤ Accept Header æˆ–åšé€²ä¸€æ­¥è™•ç†

## 4.5 Same Origin Policy èˆ‡ CORS

ä¸»è¦æ˜¯å®‰å…¨è€ƒé‡ï¼Œç€è¦½å™¨åªå…è¨±å¾ç›¸åŒçš„ä¾†æº(Origin)è®€å–è³‡æ–™

| URL                                             | Outcome	Reason                                         |
| ----------------------------------------------- | ------------------------------------------------------ |
| http://store.company.com/dir2/other.html        | Same origin	Only the path differs                      |
| http://store.company.com/dir/inner/another.html | Same origin	Only the path differs                      |
| https://store.company.com/page.html             | Failure Different protocol                             |
| http://store.company.com:81/dir/page.html       | Failure	Different port (http:// is port 80 by default) |
| http://news.company.com/dir/page.html           | Failure	Different host                                 |

(è¡¨æ ¼ä¾†è‡ª[MDN](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy))


### CORSè·¨åŸŸè«‹æ±‚

å¦‚æœè¦çªç ´Originçš„é™åˆ¶ï¼Œæœƒéœ€è¦ä¸€äº›é¡å¤–çš„ä½œæ³•ã€‚ä¸€èˆ¬ä¾†èªªæ²’è¾¦æ³•å‰ç«¯è‡ªå·±åšï¼Œéœ€è¦serveré…åˆ

:::info
ç°¡å–®ä¾†èªªï¼Œè¦é”æˆCORSä½ éœ€è¦è¨­å®šè®“**è¢«å­˜å–çš„æ•¸æ“š**å…è¨±å‰ç«¯éä¾†å­˜å–ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœä½ ä¸æ˜¯æ•¸æ“šæˆ–APIçš„æä¾›æ–¹æˆ–æ²’æœ‰æ¬Šé™æ›´å‹•å…¶è¡Œç‚ºï¼Œä½ æ²’è¾¦æ³•è¾¦åˆ°CORS
:::

* Server responseçš„[Access-Control-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)ç³»åˆ—Headers
  * Access-Control-Allow-Credentials
  * Access-Control-Allow-Headers
  * Access-Control-Allow-Methods
  * Access-Control-Allow-Origin
  * Access-Control-Expose-Headers
  * Access-Control-Max-Age
  * Access-Control-Request-Headers
  * Access-Control-Request-Method

å¦å¤–ï¼Œ[JSONP](https://zh.m.wikipedia.org/zh-tw/JSONP)ä¹Ÿæ˜¯ä¸€ç¨®æ–¹å¼ï¼Œä½†ä¾ç„¶éœ€è¦Serveré…åˆ

### CORSçš„Pre-flight Request

åœ¨é€å‡ºçœŸçš„CORSè³‡æ–™è«‹æ±‚ä¹‹å‰ï¼ŒBrowseræœƒé å…ˆç™¼èµ·ä¸€å€‹`OPTION`è«‹æ±‚ï¼Œæ¢ç´¢å°æ–¹æ˜¯å¦å…è¨±CORS

ç€è¦½å™¨æœƒç™¼èµ·Pre-flight Requestçš„æ¢ä»¶

* Request Methodä¸æ˜¯HEAD/GET/POST
* Request Headeræ²’æœ‰å¸¶æœ‰é€™äº›headers
  * Accept
  * Accept-Language
  * Content-Language
  * Content-Type
* Content-Type headerä¸æ˜¯é€™äº›é¡å‹
  * application/x-www-form-urlencoded
  * multipart/form-data
  * text/plain


Pre-flightçš„è«‹æ±‚èˆ‡å›æ‡‰æœƒé•·å¾—åƒé€™æ¨£ï¼Œä¸‹åˆ—ç¯„ä¾‹ä¾†è‡ª[MDN](https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request)


```bash
OPTIONS /resource/foo
Access-Control-Request-Method: DELETE # æˆ‘å¯ä»¥æ‰“DELETEå—ï¼Ÿ
Access-Control-Request-Headers: origin, x-requested-with
Origin: https://foo.bar.org # é€éé€™å€‹Originä¾†æ‰“
```

```bash
HTTP/1.1 204 No Content
Connection: keep-alive
Access-Control-Allow-Origin: https://foo.bar.org # é€éé€™å€‹Origin
Access-Control-Allow-Methods: POST, GET, OPTIONS, DELETE # ä½ å¯ä»¥æ‰“POST, GET, OPTIONS, DELETEå–”
Access-Control-Max-Age: 86400
```

### æ¡ˆä¾‹ï¼šPCHome24è³¼ç‰©æ”¹ç‰ˆ

æœ€è¿‘æ­£ç´…çš„PCHome24é¦–é æ”¹ç‰ˆï¼Œæœ‰å€‹console error

![](./ch4/pchome_cors_mime_error.png)

:::info Discussion
å•é¡Œæ˜¯å‡ºåœ¨å“ªè£¡å‘¢ï¼Ÿ
:::

Request
```
Request URL: https://tracker-api.netforce.com.tw/cdp-rawdata-pchome24h
Request Method: POST
Status Code: 200
Remote Address: [2606:4700:3037::6815:a4f]:443
Referrer Policy: strict-origin-when-cross-origin
```

Response
```
alt-svc: h3=":443"; ma=86400, h3-29=":443"; ma=86400
cf-cache-status: DYNAMIC
cf-ray: 72c472df0a92969a-SJC
content-type: application/vnd.kafka.v2+json
date: Sun, 17 Jul 2022 16:45:34 GMT
expect-ct: max-age=604800, report-uri="https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct"
nel: {"success_fraction":0,"report_to":"cf-nel","max_age":604800}
report-to: {"endpoints":[{"url":"https:\/\/a.nel.cloudflare.com\/report\/v3?s=EZifM3cYBLYijrHeUK7pUWwnKJEUJIjNIzo5mU7asCrGl7PPkWbQarf5AvRCrX0JIsneDPEKhEz%2BGi5%2Bjto1zvadqJ8rXZIDMEUYiYC9ScTAGj%2FrBX5AZ5g2Ucaw2hvaC3E8ntIamQn4k%2B2mZyIS07cq%2FriFuoqqPK8%3D"}],"group":"cf-nel","max_age":604800}
server: cloudflare
vary: Accept-Encoding, User-Agent
via: 1.1 22d43bf299ac98b08849f5a01a8af246.cloudfront.net (CloudFront)
x-amz-apigw-id: Va5rOHz7tjMFYgQ=
x-amz-cf-id: 9gowKMyAERvJZore7__TUIe8vr1I5FUWH_BxiPvV59xbbRvzDDhRmg==
x-amz-cf-pop: SFO5-P2
x-amzn-remapped-date: Sun, 17 Jul 2022 16:45:34 GMT
x-amzn-requestid: 2dc54a16-6928-4a7a-b195-dda519176780
x-cache: Miss from cloudfront
```

### åƒè€ƒè³‡æ–™

é—œæ–¼Same Origin Policyå¾ˆä¸éŒ¯çš„åƒè€ƒè³‡æ–™

* [Hannah - ç°¡å–®å¼„æ‡‚åŒæºæ”¿ç­– (Same Origin Policy) èˆ‡è·¨ç¶²åŸŸ (CORS)](https://medium.com/starbugs/%E5%BC%84%E6%87%82%E5%90%8C%E6%BA%90%E6%94%BF%E7%AD%96-same-origin-policy-%E8%88%87%E8%B7%A8%E7%B6%B2%E5%9F%9F-cors-e2e5c1a53a19)
* [Jayden - ç¶²ç«™å®‰å…¨ğŸ”’ Same Origin Policy åŒæºæ”¿ç­– ! ä¸€åˆ‡å®‰å…¨çš„åŸºç¤](https://medium.com/%E7%A8%8B%E5%BC%8F%E7%8C%BF%E5%90%83%E9%A6%99%E8%95%89/same-origin-policy-%E5%90%8C%E6%BA%90%E6%94%BF%E7%AD%96-%E4%B8%80%E5%88%87%E5%AE%89%E5%85%A8%E7%9A%84%E5%9F%BA%E7%A4%8E-36432565a226)


## 4.6 å®šç¾©ç§æœ‰çš„ HTTP Header

è¦å®šç¾©ç§æœ‰ç”¨é€”çš„HTTP Headerè«‹ä½¿ç”¨`X-`é–‹é ­ï¼Œä¸èƒ½èªªæ˜¯ä¸€ç¨®ç¡¬æ€§è¦å®šï¼Œä½†æ˜¯æ¯”è¼ƒå®¹æ˜“è¢«è­˜åˆ¥

* X-Github-Request-Id

ä¹Ÿæœ‰ä¸å°‘æ…£ä¾‹ï¼Œæˆ–æ˜¯IANAè¦å®šçš„Headeræ˜¯`X-`é–‹é ­ï¼Œéœ€è¦å®šç¾©ç§æœ‰Headeræ™‚é‚„æ˜¯è¦é¿é–‹ã€‚ä¾‹å¦‚ï¼š

* X-Forwarded-For
* X-Forwarded-Host
* X-Forwarded-Proto
* X-Frame-Options
* X-XSS-Protection
* X-Content-Type-Options
* X-DNS-Prefetch-Control

### HTTP Headerçš„è±†çŸ¥è­˜

#### 1. æ”¾åœ¨headerçš„è³‡è¨Šï¼Œç‚ºäº†ç›¸å®¹æ€§ï¼Œç¸½å’Œä¸è¦è¶…é8KB
  * Apache 2.4 [Http Header Limit](https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestfieldsize)æ˜¯8KB
    * é•èƒŒçš„è©±æœƒreturn HTTP 413 Entity Too Large

  * Set-Cookieä¹Ÿæ˜¯ä¸€ç¨®headerï¼Œæ‰€ä»¥ä¹Ÿä¸è¦åœ¨Cookieå…§è¨­å®šå¤ªå¤šæ±è¥¿
    * çœŸçš„æœ‰éœ€è¦æ›´å¤§çš„ç©ºé–“ï¼Œåœ¨JS Runtimeç”¨LocalStorage, WebSQL, IndexedDB

#### 2. Header Nameæ˜¯case-insensitiveçš„

#### 3. Headerçš„é †åºä¸é‡è¦(å—ï¼Ÿ)
  * åƒè€ƒ[RFC2616 4.2 Message Headers](https://www.rfc-editor.org/rfc/rfc2616#section-4.2)
  * ä½†å¦‚æœä½ æœ‰å¤šå€‹åŒåçš„Headerï¼Œæœƒæœ‰è¦†è“‹å•é¡Œ
  * å› ç‚ºæ•ˆç‡å•é¡Œï¼Œæœ‰CDNæœƒåœ¨ä½ æ”¹è®Šé‡è¦Headerçš„é †åºæ™‚æœ‰ä¸åŒçš„çµæœ
    * [Why ordering HTTP headers is important](https://sansec.io/research/http-header-order-is-important)
    * é€™ç¯‡æ–‡ç« æœ‰åœ¨2017ä¸Š[Hacker News](https://news.ycombinator.com/item?id=14245577)

