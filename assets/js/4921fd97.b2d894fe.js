"use strict";(self.webpackChunknoobtechnote_github_io_source=self.webpackChunknoobtechnote_github_io_source||[]).push([[9698],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return k}});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,c=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=u(n),k=l,s=d["".concat(c,".").concat(k)]||d[k]||p[k]||i;return n?a.createElement(s,r(r({ref:t},m),{},{components:n})):a.createElement(s,r({ref:t},m))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3180:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return c},default:function(){return k},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return p}});var a=n(7462),l=n(3366),i=(n(7294),n(3905)),r=["components"],o={title:"Ch3: \u4e8b\u52d9\u8655\u7406",tsidebar_label:"Ch3: \u4e8b\u52d9\u8655\u7406",sidebar_position:3},c="\u4ea4\u6613\u8655\u7406 (Transaction)",u={unversionedId:"sg/fenix-architecture/ch3",id:"sg/fenix-architecture/ch3",title:"Ch3: \u4e8b\u52d9\u8655\u7406",description:"\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u7cfb\u7d71\u53ef\u80fd\u9047\u5230\u7684\u5e7e\u7a2e\u932f\u8aa4\uff1a",source:"@site/docs/sg/fenix-architecture/ch3.md",sourceDirName:"sg/fenix-architecture",slug:"/sg/fenix-architecture/ch3",permalink:"/docs/sg/fenix-architecture/ch3",draft:!1,editUrl:"https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/fenix-architecture/ch3.md",tags:[],version:"current",lastUpdatedBy:"tom-c-chen",lastUpdatedAt:1670774481,formattedLastUpdatedAt:"12/11/2022",sidebarPosition:3,frontMatter:{title:"Ch3: \u4e8b\u52d9\u8655\u7406",tsidebar_label:"Ch3: \u4e8b\u52d9\u8655\u7406",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Ch1: \u670d\u52d9\u67b6\u69cb\u6f14\u9032\u53f2",permalink:"/docs/sg/fenix-architecture/ch1"},next:{title:"Web API the Good Parts",permalink:"/docs/sg/web-api-the-good-parts/"}},m={},p=[{value:"3.1\u3000\u672c\u5730\u4ea4\u6613(Local Transaction)",id:"31\u672c\u5730\u4ea4\u6613local-transaction",level:2},{value:"3.1.1 \u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027",id:"311-\u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027",level:3},{value:"Commit Logging",id:"commit-logging",level:3},{value:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record):",id:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record",level:4},{value:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record)\u5c31\u767c\u751f\u6545\u969c\uff1a",id:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record\u5c31\u767c\u751f\u6545\u969c",level:4},{value:"Solution: Write-Ahead Logging(WAL)",id:"solution-write-ahead-loggingwal",level:3},{value:"Undo Log\uff1a",id:"undo-log",level:4},{value:"Redo Log\uff1a",id:"redo-log",level:4},{value:"WAL \u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5\uff1a",id:"wal-\u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5",level:4},{value:"3.1.2 \u5be6\u73fe\u9694\u96e2\u6027",id:"312-\u5be6\u73fe\u9694\u96e2\u6027",level:2},{value:"\u5e38\u898b\u7684\u9694\u96e2\u5c64\u7d1a\uff1a",id:"\u5e38\u898b\u7684\u9694\u96e2\u5c64\u7d1a",level:3},{value:"Read Uncommitted",id:"read-uncommitted",level:3},{value:"Read Committed",id:"read-committed",level:3},{value:"Repeatable Read",id:"repeatable-read",level:3},{value:"Snapshot",id:"snapshot",level:3},{value:"Serializable",id:"serializable",level:3},{value:"3.2 \u5168\u5c40\u4ea4\u6613",id:"32-\u5168\u5c40\u4ea4\u6613",level:2}],d={toc:p};function k(e){var t=e.components,o=(0,l.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u4ea4\u6613\u8655\u7406-transaction"},"\u4ea4\u6613\u8655\u7406 (Transaction)"),(0,i.kt)("p",null,"\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u7cfb\u7d71\u53ef\u80fd\u9047\u5230\u7684\u5e7e\u7a2e\u932f\u8aa4\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u8cc7\u6599\u5eab\u6545\u969c"),(0,i.kt)("li",{parentName:"ul"},"\u61c9\u7528\u7a0b\u5f0f\u5d29\u6f70"),(0,i.kt)("li",{parentName:"ul"},"\u61c9\u7528\u7a0b\u5f0f\u8207\u8cc7\u6599\u5eab\u9593\u7684\u7db2\u8def\u9023\u7dda\u4e2d\u65b7"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("del",{parentName:"li"},"\u5404\u7a2e\u9b3c\u6545\u4e8b"),"......")),(0,i.kt)("p",null,"\u8cc7\u6599\u5eab\u7684\u4ea4\u6613(Transaction)\u6d88\u9664\u8cc7\u6599\u662f\u5426\u66f4\u65b0\u7684\u7591\u616e\uff0c\u4fee\u6539\u8cc7\u6599\u5fc5\u9808\u6eff\u8db3\u5b9a\u7fa9\u597d\u7684\u898f\u5247\uff0c\u5305\u542b\u8cc7\u6599\u7684\u5b8c\u6574\u6027\u3001\u5931\u6557\u6642\u89f8\u767c\u56de\u6efe (rollback) \u7b49\u7b49\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Transaction(TX):")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"SQL \u8a9e\u53e5\u7684\u96c6\u5408\uff0c\u8996\u70ba\u4e00\u500b\u5de5\u4f5c\u55ae\u5143\uff0c\u8cc7\u6599\u5eab\u8655\u7406\u7684\u908f\u8f2f\u55ae\u4f4d"),(0,i.kt)("li",{parentName:"ul"},"\u9031\u671f\uff1aBegin \u2192 Commit (or Rollback)")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"\u76ee\u7684")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\u4fdd\u6301\u8cc7\u6599\u5eab\u4e2d\u8cc7\u6599\u72c0\u614b\u7684\u300c\u4e00\u81f4\u6027\u300d",(0,i.kt)("strong",{parentName:"p"},"C"),"onsistency"))),(0,i.kt)("p",null,"\u8cc7\u6599\u5eab\u7684\u7d93\u5178\u7406\u8ad6\uff0cTX \u5177\u5099\u7684\u7279\u6027\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u539f\u5b50\u6027"),"\uff08",(0,i.kt)("strong",{parentName:"li"},"A"),"tomic\uff09: \u6bcf\u500b TX \u6709\u5169\u7a2e\u53ef\u80fd\u7d50\u679c \u2192 \u5168\u90e8\u57f7\u884c\u6210\u529f or \u5168\u90e8\u5931\u6557\u4e0d\u57f7\u884c(\u53ea\u8981\u5176\u4e2d\u4e00\u500b\u5931\u6557\u5c31\u8b93\u4fee\u6539\u7684\u8cc7\u6599\u5168\u90e8 rollback \u5230 TX \u958b\u59cb\u524d\u7684\u72c0\u614b)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u9694\u96e2\u6027"),"\uff08",(0,i.kt)("strong",{parentName:"li"},"I"),"solation\uff09\uff1a \u78ba\u4fdd\u6bcf\u500b TX \u5728\u9032\u884c\u6642\u4e0d\u6703\u4e92\u76f8\u5e72\u64fe"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u6301\u4e45\u6027\uff08D"),"urability\uff09: TX \u4fdd\u8b49\u6240\u6709\u6210\u529f\u88ab commit \u7684\u8cc7\u6599\u4fee\u6539\u90fd\u80fd\u5920\u6b63\u78ba\u5730\u88ab\u6c38\u4e45\u5132\u5b58(\u6210\u529f\u5beb\u5230\u786c\u789f\u6216 SSD \u4e0a)")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"\u88dc\u5145")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"\u5132\u5b58\u9ede (save point):"),(0,i.kt)("p",{parentName:"div"},"SAVEPOINT \u6307\u4ee4\u5b9a\u7fa9\u4e00\u500b TX \u5132\u5b58\u9ede\uff0c\u5141\u8a31\u53d6\u6d88\u90e8\u4efdTX\uff0c\u800c\u53ea\u63d0\u4ea4(commit)\u5269\u9918\u7684\u90e8\u4efd\uff0c\u53ef\u4ee5\u5728\u4ea4\u6613\u4e2d\u63d2\u5165\u5132\u5b58\u9ede\uff0c\u6709\u9700\u8981\u6642\u53ef\u4ee5 rollback \u5230\u5132\u5b58\u9ede\uff0c\u800c\u4e0d\u7528 rollback \u6574\u500b TX\u3002"))),(0,i.kt)("p",null,"\u8209\u4f8b\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u9280\u884c\u8f49\u5e33"),(0,i.kt)("li",{parentName:"ul"},"\u8766\u76ae\u8cfc\u7269")),(0,i.kt)("p",null,"TX \u7684\u6982\u5ff5\u5ef6\u4f38\u5230\u6240\u6709\u9700\u8981\u4fdd\u8b49\u8cc7\u6599\u4e00\u81f4\u6027\u7684\u61c9\u7528\u5834\u666f e.g. \u5feb\u53d6\u6a5f\u5236\u3001Message Queue\u3001\u5206\u6563\u5f0f\u7684\u5132\u5b58\u67b6\u69cb\u3002"),(0,i.kt)("p",null,"\u4e0a\u8ff0\u7684\u61c9\u7528\u5834\u666f\u8207\u8cc7\u6599\u5eab\u7684 TX \u4e00\u81f4\u6027\u975e\u5b8c\u5168\u76f8\u540c\u7684\u6982\u5ff5\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5167\u90e8\u4e00\u81f4\u6027\uff1a\u4e00\u500b\u670d\u52d9\u4f7f\u7528\u4e00\u500b\u8cc7\u6599\u6e90\uff0c\u900f\u904e A\u3001I\u3001D \u4f86\u78ba\u4fdd\u8cc7\u6599\u4e00\u81f4\u6027"),(0,i.kt)("li",{parentName:"ul"},"\u5916\u90e8\u4e00\u81f4\u6027\uff1a\u4e00\u500b\u670d\u52d9\u4f7f\u7528\u591a\u500b\u8cc7\u6599\u6e90\u3001\u591a\u500b\u670d\u52d9\u4f7f\u7528\u591a\u500b\u4e0d\u540c\u8cc7\u6599\u6e90\uff0c\u6d89\u53ca\u591a\u500b\u8cc7\u6599\u6e90\u7684 TX \u4e00\u81f4\u6027 \u2192 \u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u96e3\u984c")),(0,i.kt)("p",null,"\u8cc7\u6599\u4e00\u81f4\u6027\u5206\u4e09\u7a2e\u7279\u6027:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5f37\u4e00\u81f4\u6027\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u4efb\u4f55\u8b80\u53d6\u7684\u8cc7\u6599\u90fd\u662f\u6700\u65b0\u7684\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u5f31\u4e00\u81f4\u6027\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u7121\u6cd5\u4fdd\u8b49\u90fd\u80fd\u8b80\u53d6\u5230\u6700\u65b0\u7684\u8cc7\u6599"),(0,i.kt)("li",{parentName:"ul"},"\u6700\u7d42\u4e00\u81f4\u6027(\u5f8c\u9762\u8ac7 CAP \u7406\u8ad6)\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u6700\u5f8c\u4e00\u5b9a\u80fd\u8b80\u5230\u6700\u65b0\u7684\u503c")),(0,i.kt)("h2",{id:"31\u672c\u5730\u4ea4\u6613local-transaction"},"3.1\u3000\u672c\u5730\u4ea4\u6613(Local Transaction)"),(0,i.kt)("p",null,"\u53c8\u4f5c\u300cLocal Transaction\u300d\uff0c\u9069\u7528\u65bc\u55ae\u500b\u670d\u52d9\u4f7f\u7528\u55ae\u500b\u8cc7\u6599\u6e90\u7684\u5834\u666f\u3002"),(0,i.kt)("p",null,"\u5be6\u73fe\u539f\u7406\u6e90\u81ea\u65bc ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Algorithms_for_Recovery_and_Isolation_Exploiting_Semantics"},"ARIES")," \u7406\u8ad6\uff0c\u73fe\u4ee3\u95dc\u4fc2\u578b\u8cc7\u6599\u5eab\u7684\u7406\u8ad6\u57fa\u790e\u3002"),(0,i.kt)("h3",{id:"311-\u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027"},"3.1.1 \u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027"),(0,i.kt)("p",null,"\u6eff\u8db3\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027\u7684\u6700\u5927\u56f0\u96e3\u9ede\uff1a\n\u300c\u5beb\u5165\u786c\u789f\u300d\u9019\u500b\u52d5\u4f5c\u4e26\u975e\u539f\u5b50\u7684\uff0c\u9664\u4e86\u6709\u300c\u5beb\u5165\u300d\u8207\u300c\u672a\u5beb\u5165\u300d\u72c0\u614b\uff0c\u9084\u5b58\u5728\u300c\u6b63\u5728\u5beb\u300d\u504f\u5411\u4e2d\u9593\u7684\u72c0\u614b\u3002"),(0,i.kt)("p",null,"\u53ef\u80fd\u767c\u751f\u5e7e\u7a2e\u60c5\u5f62\uff1a"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u672a\u63d0\u4ea4 TX\uff0c\u5beb\u5165\u5f8c crash"),":"),(0,i.kt)("p",null,"\u61c9\u7528\u7a0b\u5f0f\u9084\u6c92\u4fee\u6539\u5b8c\u8cc7\u6599\uff0c\u4f46\u8cc7\u6599\u5eab\u5df2\u5c07\u90e8\u5206\u8cc7\u6599\u7684\u8b8a\u52d5\u5beb\u5165\u786c\u789f\uff0c\u767c\u751f\u6545\u969c\u7684\u72c0\u6cc1\uff0c\u7d93\u91cd\u555f\u5f8c\uff0c\u8cc7\u6599\u5eab\u5fc5\u9808\u8981\u6709\u8fa6\u6cd5\u5f97\u77e5\u6545\u969c\u524d\u767c\u751f\u904e\u4e00\u6b21\u300c\u4e0d\u5b8c\u6574\u300d\u7684\u64cd\u4f5c\uff0c\u5c07\u5df2\u4fee\u6539\u904e\u7684\u8cc7\u6599\u5f9e\u786c\u789f\u4e2d\u6062\u5fa9\u6210\u6c92\u6709\u6539\u904e\u7684\u6a23\u5b50\uff0c\u78ba\u4fdd\u539f\u5b50\u6027\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u5df2\u63d0\u4ea4 TX\uff0c\u5beb\u5165\u524d crash"),":"),(0,i.kt)("p",null,"\u61c9\u7528\u7a0b\u5f0f\u4fee\u6539\u5b8c\u6240\u6709\u8cc7\u6599\u4e26\u5b8c\u6210 commit\uff0c\u4f46\u8cc7\u6599\u5eab\u9084\u672a\u5c07\u6240\u6709\u8b8a\u52d5\u8cc7\u6599\u5beb\u5165\u786c\u789f\uff0c\u767c\u751f\u6545\u969c\u6642\u7d93\u904e\u91cd\u555f\uff0c\u8cc7\u6599\u5eab\u5fc5\u9808\u5c07\u672a\u5b8c\u6210\u7684\u8cc7\u6599\u91cd\u65b0\u5beb\u5165\u786c\u789f\uff0c\u6eff\u8db3\u6301\u4e45\u6027\u3002"),(0,i.kt)("h3",{id:"commit-logging"},"Commit Logging"),(0,i.kt)("p",null,"\u4ee5\u300c\u65e5\u8a8c\u300d\u7684\u5f62\u5f0f\u4f9d\u5e8f\u5c07\u4fee\u6539\u8cc7\u6599\u7684\u64cd\u4f5c\u5305\u542b\u7684\u6240\u6709\u8a0a\u606f(e.g. \u4fee\u6539\u54ea\u7b46\u8cc7\u6599\u3001\u8cc7\u6599\u4fdd\u5b58\u5728\u786c\u789f\u88e1\u7684\u54ea\u500b\u5340\u584a\u7b49)\uff0c\u90fd\u5148\u8a18\u9304\u5230\u786c\u789f\u88e1\uff0c\u4fdd\u969c\u8cc7\u6599\u6301\u4e45\u6027\u3001\u539f\u5b50\u6027\u5169\u500b\u7279\u6027\u3002"),(0,i.kt)("p",null,"\u53ea\u6709\u5728 commit log \u6210\u529f\u7d00\u9304\u5728\u786c\u789f\u88e1\uff0c\u8cc7\u6599\u5eab\u5728\u65e5\u8a8c\u4e2d\u770b\u5230\u4ee3\u8868 TX \u6210\u529f\u7684\u63d0\u4ea4\u7d00\u9304\uff08Commit Record\uff09\u5f8c\uff0c\u624d\u6703\u6839\u64da\u65e5\u8a8c\u4e0a\u7684\u8a0a\u606f\u5c0d\u771f\u6b63\u7684\u8cc7\u6599\u9032\u884c\u4fee\u6539\u3002"),(0,i.kt)("p",null,"\u4fee\u6539\u5b8c\u6210\u5f8c\uff0c\u5728\u65e5\u8a8c\u4e2d\u52a0\u5165\u4e00\u689d\u201c\u7d50\u675f\u8a18\u9304\u201d \uff08End Record\uff09\u8868\u793a TX \u6eff\u8db3\u6301\u4e45\u6027\u3002"),(0,i.kt)("h4",{id:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record"},"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record):"),(0,i.kt)("p",null,"\u6574\u500b TX \u8996\u70ba\u6210\u529f\uff0c\u5373\u4fbf\u771f\u6b63\u4fee\u6539\u8cc7\u6599\u6642\u767c\u751f\u6545\u969c\uff0c\u8cc7\u6599\u5eab\u91cd\u555f\u5f8c\u6839\u64da\u5df2\u7d93\u5beb\u5165\u786c\u789f\u7684\u65e5\u8a8c\u9032\u884c\u6062\u5fa9\u3001\u7e7c\u7e8c\u4fee\u6539\u8cc7\u6599\u5373\u53ef\uff0c\u4fdd\u8b49\u6301\u4e45\u6027\u3002"),(0,i.kt)("h4",{id:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record\u5c31\u767c\u751f\u6545\u969c"},"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record)\u5c31\u767c\u751f\u6545\u969c\uff1a"),(0,i.kt)("p",null,"\u6574\u500b TX \u5c31\u662f\u5931\u6557\u7684\uff0c\u8cc7\u6599\u5eab\u91cd\u555f\u5f8c\u6703\u770b\u5230\u4e00\u90e8\u5206\u6c92\u6709 commit \u7d00\u9304\u7684\u65e5\u8a8c\uff0c\u6a19\u8a18\u70ba rollback \u72c0\u614b\uff0c\u9000\u56de\u5230 TX \u958b\u59cb\u4e4b\u524d\uff0c\u4fdd\u8b49\u539f\u5b50\u6027\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u7f3a\u9677\uff1a")),(0,i.kt)("p",null,"\u5f71\u97ff\u8cc7\u6599\u5eab\u7684\u6548\u80fd\u3002"),(0,i.kt)("h3",{id:"solution-write-ahead-loggingwal"},"Solution: Write-Ahead Logging(WAL)"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u53c8\u4f5c\u300c\u9810\u5beb\u65e5\u8a8c\u300d\uff0c\u5141\u8a31\u5728 TX commit \u4e4b\u524d\uff0c\u63d0\u524d\u5beb\u5165\u8b8a\u52d5\u8cc7\u6599\u3002")),(0,i.kt)("p",null,"\u5beb\u5165\u8b8a\u52d5\u8cc7\u6599\u7684\u6642\u9593\u9ede\u4ee5 TX commit \u6642\u70ba\u754c\u53bb\u5283\u5206\uff0c\u5206\u4f5c ",(0,i.kt)("inlineCode",{parentName:"p"},"FORCE")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"STEAL")," \u5169\u985e\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FORCE")," :  TX commit \u4e4b\u300c\u5f8c\u300d",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8981\u6c42\u8b8a\u52d5\u8cc7\u6599\u5fc5\u9808\u540c\u6642\u5b8c\u6210\u5beb\u5165\u5247\u7a31\u70ba ",(0,i.kt)("inlineCode",{parentName:"li"},"FORCE")),(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u5f37\u5236\u9808\u540c\u6642\u5b8c\u6210\u5beb\u5165\u5247\u7a31\u70ba ",(0,i.kt)("inlineCode",{parentName:"li"},"NO-FORCE")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"STEAL")," : TX commit \u4e4b\u300c\u524d\u300d",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5141\u8a31\u8b8a\u52d5\u8cc7\u6599\u63d0\u524d\u5beb\u5165\u7a31\u70ba ",(0,i.kt)("inlineCode",{parentName:"li"},"STEAL")),(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u5141\u8a31\u8b8a\u52d5\u8cc7\u6599\u63d0\u524d\u5beb\u5165\u7a31\u70ba ",(0,i.kt)("inlineCode",{parentName:"li"},"NO-STEAL"))))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"LSN\u2013Log (Log Sequence Number Log)"),"\n\u6bcf\u689d WAL log \u90fd\u6703\u5e36\u6709\u4e00\u4e32\u5e8f\u865f\uff0c\u7a31\u4f5c ","[LSN]"," (Log Sequence Number)\uff0c\u7d00\u9304 TX \u6539\u52d5\u5167\u5bb9\u3002"),(0,i.kt)("p",null,"WAL \u63d0\u4f9b\u984d\u5916\u7684\u6a5f\u5236: \u589e\u52a0 ",(0,i.kt)("strong",{parentName:"p"},"Undo Log")," \u7684\u65e5\u8a8c\u985e\u578b\u3002"),(0,i.kt)("h4",{id:"undo-log"},"Undo Log\uff1a"),(0,i.kt)("p",null,"\u5728\u6539\u52d5\u7684\u8cc7\u6599\u5beb\u5165\u786c\u789f\u524d\uff0c\u9808\u5148\u8a18\u9304 Undo log\uff0c\u5f8c\u7e8c\u9047\u5230\u9700\u8981 rollback \u6216\u662f\u6545\u969c\u7684\u60c5\u6cc1\uff0c\u628a\u9019\u4e9b Undo log \u7d00\u9304\u5167\u5bb9\u90fd\u62b9\u9664\u6389\u3002"),(0,i.kt)("h4",{id:"redo-log"},"Redo Log\uff1a"),(0,i.kt)("p",null,"\u7d00\u9304\u4fee\u6539\u8cc7\u6599\u7684\u64cd\u4f5c\u5167\u5bb9\u3002\u9047\u5230\u6545\u969c\u6642\uff0c\u85c9\u7531 WAL \u5beb\u5165\u7684 TX Log \u4f86\u6062\u5fa9\u91cd\u505a\u3002"),(0,i.kt)("h4",{id:"wal-\u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5"},"WAL \u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Analysis(\u5206\u6790)\uff1a\u5f9e\u786c\u789f\u88e1\u5c0b\u627e\u6700\u5f8c(\u65b0)\u4e00\u6b21\u7684\u6aa2\u67e5\u9ede(\u5df2\u6210\u529f\u5730\u5beb\u5165\u786c\u789f\u88e1\u6eff\u8db3\u6301\u4e45\u5316)\uff0c\u958b\u59cb\u5c0d\u65e5\u8a8c\u9032\u884c\u6383\u63cf\uff0c\u627e\u51fa\u6c92\u6709\u7d50\u675f\u8a18\u9304\u7684 TX\uff0c\u7d44\u6210\u96c6\u5408\u5f85\u6062\u5fa9\u7684 TX\u3002"),(0,i.kt)("li",{parentName:"ul"},"Redo(\u91cd\u505a)\uff1a\u5206\u6790\u968e\u6bb5\u4e2d\u7522\u751f\u7684\u5f85\u6062\u5fa9\u7684 TX \u96c6\u5408\u4f86\u9084\u539f\u72c0\u614b\u3002"),(0,i.kt)("li",{parentName:"ul"},"Undo(\u56de\u6efe)\uff1a\u7d93\u904e\u5206\u6790\u3001\u91cd\u505a\u968e\u6bb5\u5f8c\u5269\u9918\u5f85\u6062\u5fa9\u7684 TX \u96c6\u5408\uff0c\u5373\u9700\u8981\u56de\u6efe\u7684 TX\uff0c\u4f9d Undo Log \u5167\u5bb9\u5c07\u63d0\u524d\u5beb\u5165\u786c\u789f\u7684\u8cc7\u6599\u6539\u91cd\u65b0\u5beb\u56de\u53bb\u3002")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"FORCE \u548cSTEAL \u7684\u56db\u7a2e\u7d44\u5408\u95dc\u4fc2",src:n(1805).Z,width:"728",height:"313"})),(0,i.kt)("h2",{id:"312-\u5be6\u73fe\u9694\u96e2\u6027"},"3.1.2 \u5be6\u73fe\u9694\u96e2\u6027"),(0,i.kt)("p",null,"\u5e38\u898b\u624b\u6bb5\uff1a\u52a0\u9396\ud83d\udd12"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5beb\u9396\uff08Write Lock; Exclusive Lock -> X-Lock\uff09"),(0,i.kt)("li",{parentName:"ul"},"\u8b80\u9396\uff08Read Lock; Shared Lock -> S-Lock\uff09\uff1a"),(0,i.kt)("li",{parentName:"ul"},"\u7bc4\u570d\u9396\uff08Range Lock\uff09")),(0,i.kt)("h3",{id:"\u5e38\u898b\u7684\u9694\u96e2\u5c64\u7d1a"},"\u5e38\u898b\u7684\u9694\u96e2\u5c64\u7d1a\uff1a"),(0,i.kt)("h3",{id:"read-uncommitted"},"Read Uncommitted"),(0,i.kt)("p",null,"\u5141\u8a31\u8b80\u53d6\u5c1a\u672a\u88ab committed \u7684\u8cc7\u6599\uff0c\u5c6c\u65bc\u6700\u4f4e\u5c64\u7d1a\u3002"),(0,i.kt)("h3",{id:"read-committed"},"Read Committed"),(0,i.kt)("p",null,"\u53ea\u5141\u8a31\u8b80\u53d6\u5df2\u88ab Commit \u7684\u8cc7\u6599\uff0c\u53ef\u89e3\u6c7a Dirty Read \u7684\u554f\u984c\u3002"),(0,i.kt)("h3",{id:"repeatable-read"},"Repeatable Read"),(0,i.kt)("p",null,"\u8b80\u5230\u7684\u8cc7\u6599\u53ea\u6703\u662f transaction \u958b\u59cb\u524d\u5df2\u7d93 committed \u7684\u8cc7\u6599\uff0c\u4e0d\u6703\u8b80\u53d6\u5230\u5c1a\u672a committed \u7684\u8cc7\u6599\u6216\u8005\u5728 transaction \u671f\u9593\u88ab\u5176\u4ed6\u4e26\u884c\u7684 transaction \u5b8c\u6210 committed \u7684\u8b8a\u66f4 "),(0,i.kt)("h3",{id:"snapshot"},"Snapshot"),(0,i.kt)("p",null,"\u5c0d\u6bcf\u500b\u7522\u751f\u7684\u65b0\u8cc7\u6599\u505a snapshot\uff0c\u7522\u751f\u4e00\u500b\u65b0\u7248\u672c\uff0c\u5141\u8a31 TX \u8b80\u53d6\u9019\u4e9b snapshot \u7684\u6700\u65b0\u7248\u672c => Multi-Version Concurrency Control (MVCC) \u7684\u65b9\u5f0f\u5be6\u73fe"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u597d\u8655: \u4e0d\u9808\u5728\u8cc7\u6599\u8868\u88e1\u8a2d\u7f6e\u9396(lock)\u4f86\u907f\u514d\u885d\u7a81"),(0,i.kt)("li",{parentName:"ul"},"\u7f3a\u9ede: \u6bcf\u7b46\u7d00\u9304\u90fd\u9700\u8981\u984d\u5916\u7684\u5132\u5b58\u7a7a\u9593")),(0,i.kt)("h3",{id:"serializable"},"Serializable"),(0,i.kt)("p",null,"\u63a1\u5e8f\u5217\u5316\uff0c\u6700\u56b4\u683c\u7684\u9694\u96e2\u5c64\u7d1a\uff0c\u591a\u500b TXs \u8b8a\u6210\u4e00\u500b\u500b\u300c\u63a5\u7e8c\u57f7\u884c\u300d\u3002"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"TX \u8017\u6642\u7a0b\u5ea6:")),(0,i.kt)("p",null,"SERIALIZABLE > REPEATABLE READ > READ COMMITTED > READ UNCOMMITTED"),(0,i.kt)("h2",{id:"32-\u5168\u5c40\u4ea4\u6613"},"3.2 \u5168\u5c40\u4ea4\u6613"))}k.isMDXComponent=!0},1805:function(e,t,n){t.Z=n.p+"assets/images/ch3-1-2-da5a5ef800b687ea343ed141ed72d5ed.png"}}]);