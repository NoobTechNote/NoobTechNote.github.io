"use strict";(self.webpackChunknoobtechnote_github_io_source=self.webpackChunknoobtechnote_github_io_source||[]).push([[9763],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>y});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var o=a.createContext({}),p=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(o.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(t),d=l,y=m["".concat(o,".").concat(d)]||m[d]||c[d]||r;return t?a.createElement(y,i(i({ref:n},u),{},{components:t})):a.createElement(y,i({ref:n},u))}));function y(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=d;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s[m]="string"==typeof e?e:l,i[1]=s;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},85162:(e,n,t)=>{t.d(n,{Z:()=>i});var a=t(67294),l=t(86010);const r={tabItem:"tabItem_Ymn6"};function i(e){let{children:n,hidden:t,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r.tabItem,i),hidden:t},n)}},74866:(e,n,t)=>{t.d(n,{Z:()=>k});var a=t(87462),l=t(67294),r=t(86010),i=t(12466),s=t(16550),o=t(91980),p=t(67392),u=t(50012);function m(e){return function(e){return l.Children.map(e,(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:l}}=e;return{value:n,label:t,attributes:a,default:l}}))}function c(e){const{values:n,children:t}=e;return(0,l.useMemo)((()=>{const e=n??m(t);return function(e){const n=(0,p.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function d(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function y(e){let{queryString:n=!1,groupId:t}=e;const a=(0,s.k6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,o._X)(r),(0,l.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,r=c(e),[i,s]=(0,l.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!d({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[o,p]=y({queryString:t,groupId:a}),[m,f]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,u.Nk)(t);return[a,(0,l.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:a}),g=(()=>{const e=o??m;return d({value:e,tabValues:r})?e:null})();(0,l.useLayoutEffect)((()=>{g&&s(g)}),[g]);return{selectedValue:i,selectValue:(0,l.useCallback)((e=>{if(!d({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),p(e),f(e)}),[p,f,r]),tabValues:r}}var g=t(72389);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:n,block:t,selectedValue:s,selectValue:o,tabValues:p}=e;const u=[],{blockElementScrollPositionUntilNextRender:m}=(0,i.o5)(),c=e=>{const n=e.currentTarget,t=u.indexOf(n),a=p[t].value;a!==s&&(m(n),o(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;n=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;n=u[t]??u[u.length-1];break}}n?.focus()};return l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n)},p.map((e=>{let{value:n,label:t,attributes:i}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,key:n,ref:e=>u.push(e),onKeyDown:d,onClick:c},i,{className:(0,r.Z)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":s===n})}),t??n)})))}function h(e){let{lazy:n,children:t,selectedValue:a}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===a));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return l.createElement("div",{className:"margin-top--md"},r.map(((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==a}))))}function v(e){const n=f(e);return l.createElement("div",{className:(0,r.Z)("tabs-container",x.tabList)},l.createElement(b,(0,a.Z)({},e,n)),l.createElement(h,(0,a.Z)({},e,n)))}function k(e){const n=(0,g.Z)();return l.createElement(v,(0,a.Z)({key:String(n)},e))}},43465:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>p,toc:()=>m});var a=t(87462),l=(t(67294),t(3905)),r=t(74866),i=t(85162);const s={title:"Ch5: \u628a\u76f8\u4f3c\u7684\u7a0b\u5f0f\u78bc\u7d71\u5408\u5728\u4e00\u8d77",sidebar_label:"Ch5: \u628a\u76f8\u4f3c\u7684\u7a0b\u5f0f\u78bc\u7d71\u5408\u5728\u4e00\u8d77",sidebar_position:5},o=void 0,p={unversionedId:"sg/five-lines-of-code/ch5",id:"sg/five-lines-of-code/ch5",title:"Ch5: \u628a\u76f8\u4f3c\u7684\u7a0b\u5f0f\u78bc\u7d71\u5408\u5728\u4e00\u8d77",description:"5.1 Unifying Similar classes",source:"@site/docs/sg/five-lines-of-code/ch5.mdx",sourceDirName:"sg/five-lines-of-code",slug:"/sg/five-lines-of-code/ch5",permalink:"/docs/sg/five-lines-of-code/ch5",draft:!1,editUrl:"https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/five-lines-of-code/ch5.mdx",tags:[],version:"current",lastUpdatedBy:"Mech",lastUpdatedAt:1699705851,formattedLastUpdatedAt:"Nov 11, 2023",sidebarPosition:5,frontMatter:{title:"Ch5: \u628a\u76f8\u4f3c\u7684\u7a0b\u5f0f\u78bc\u7d71\u5408\u5728\u4e00\u8d77",sidebar_label:"Ch5: \u628a\u76f8\u4f3c\u7684\u7a0b\u5f0f\u78bc\u7d71\u5408\u5728\u4e00\u8d77",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Ch4: \u8b93\u578b\u5225\u78bc\u80fd\u904b\u4f5c",permalink:"/docs/sg/five-lines-of-code/ch4"},next:{title:"\u8edf\u9ad4\u67b6\u69cb\u539f\u7406 - \u5de5\u7a0b\u65b9\u6cd5",permalink:"/docs/sg/fundamentals-of-software-architecture/"}},u={},m=[{value:"5.1 Unifying Similar classes",id:"51-unifying-similar-classes",level:2},{value:"5.1.1 \u91cd\u69cb\u6a21\u5f0f: Unify Similar Classes",id:"511-\u91cd\u69cb\u6a21\u5f0f-unify-similar-classes",level:3}],c=(d="MultiCol",function(e){return console.warn("Component "+d+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",e)});var d;const y={toc:m},f="wrapper";function g(e){let{components:n,...t}=e;return(0,l.kt)(f,(0,a.Z)({},y,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"51-unifying-similar-classes"},"5.1 Unifying Similar classes"),(0,l.kt)("p",null,'\u63a5\u7e8c\u4e0a\u4e00\u7ae0\uff0cupdateTile\u4f9d\u7136\u9055\u53cd\u4e86\u8a31\u591a\u898f\u5247\uff0c\u6700\u986f\u8457\u7684\u5c31\u662f"\u4e0d\u8981\u8b93IF\u8ddfELSE\u4e00\u8d77\u7528"\u898f\u5247\n\u5f15\u5165isStony, isBoxy\uff0c\u53ef\u88ab\u7406\u89e3\u70ba\uff0c\u50cf\u77f3\u982d\u4e00\u6a23\u505a\u52d5\uff0c\u50cf\u7bb1\u5b50\u4e00\u6a23\u505a\u52d5'),(0,l.kt)(c,{col:2,mdxType:"MultiCol"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Before"',title:'"Before"'},"function updateTile(x: number, y: number) {\n  if ((map[y][x].isStone() || map[y][x].isFallingStone())\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingStone();\n    map[y][x] = new Air();\n  } else if ((map[y][x].isBox() || map[y][x].isFallingBox())\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingBox();\n    map[y][x] = new Air();\n  } else if (map[y][x].isFallingStone()) {\n    map[y][x] = new Stone();\n  } else if (map[y][x].isFallingBox()) {\n    map[y][x] = new Box();\n  }\n}\n"))),(0,l.kt)(c,{col:2,mdxType:"MultiCol"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="After"',title:'"After"'},"function updateTile(x: number, y: number) {\n  if (map[y][x].isStony()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingStone();\n    map[y][x] = new Air();\n  } else if (map[y][x].isBoxy()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingBox();\n    map[y][x] = new Air();\n  } else if (map[y][x].isFallingStone()) {\n    map[y][x] = new Stone();\n  } else if (map[y][x].isFallingBox()) {\n    map[y][x] = new Box();\n  }\n}\ninterface Tile {\n  // ...\n  isStony(): boolean;\n  isBoxy(): boolean;\n}\nclass Air implements Tile {\n  // ...\n  isStony() { return false; }\n  isBoxy() { return false; }\n}\n"))),(0,l.kt)("p",null,"\u56de\u50b3\u4e00\u500b\u5e38\u6578\u7684method\u6211\u5011\u53ebconstant method(\u5e38\u6578\u65b9\u6cd5)"),(0,l.kt)("p",null,"\u6211\u5011\u53ef\u4ee5\u5408\u4f75\u5169\u500bclass\u662f\u56e0\u70ba\u9019\u5169\u500bclass\u5171\u4eab\u4e86\u56de\u50b3\u4e0d\u540c\u5e38\u6578\u7684\u5e38\u6578\u65b9\u6cd5"),(0,l.kt)("p",null,"Steps:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u8b93\u5169\u500bclass\u9664\u4e86\u5e38\u6578\u65b9\u6cd5\u4ee5\u5916\u90fd\u76f8\u7b49")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u5408\u4f75class\n(\u66f8\u4e0a\u8aaa\u5f88\u50cf\u5206\u6578\u52a0\u6cd5\uff0c\u8981\u5148\u628a\u5206\u6bcd\u8b8a\u4e00\u6a23\u518d\u52a0\u8d77\u4f86)"))),(0,l.kt)("p",null,"\u5148\u6bd4\u8f03\u5169\u9846\u77f3\u982d\u985e"),(0,l.kt)(c,{col:2,mdxType:"MultiCol"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Stone"',title:'"Stone"'},"\nclass Stone implements Tile {\n  isAir() { return false; }\n  isFallingStone() { return false; }\n  isFallingBox() { return false; }\n  isLock1() { return false; }\n  isLock2() { return false; }\n  draw(g: CanvasRenderingContext2D,\n    x: number, y: number) {\n    // ...\n  }\n  moveVertical(dy: number) { }\n  isStony() { return true; }\n  isBoxy() { return false; }\n  moveHorizontal(dx: number) {\n    // ...\n  }\n}\n"))),(0,l.kt)(c,{col:2,mdxType:"MultiCol"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="FallingStone"',title:'"FallingStone"'},"class FallingStone implements Tile {\n  isAir() { return false; }\n  isFallingStone() { return true; }\n  isFallingBox() { return false; }\n  isLock1() { return false; }\n  isLock2() { return false; }\n  draw(g: CanvasRenderingContext2D,\n    x: number, y: number) {\n    // ...\n  }\n  moveVertical(dy: number) { }\n  isStony() { return true; }\n  isBoxy() { return false; }\n  moveHorizontal(dx: number) {\n  }\n}\n"))),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"\u628amoveHorizontal\u4e00\u6a23",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (map[playery][playerx + dx + dx].isAir()\n      && !map[playery + 1][playerx + dx].isAir()) {\n      map[playery][playerx + dx + dx] = this;\n      moveToTile(playerx + dx, playery);\n    }\n  }\n}\nclass FallingStone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"\u7528if(true){}\u5305\u8d77\u4f86",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (true) {\n      if (map[playery][playerx + dx + dx].isAir()\n        && !map[playery + 1][playerx + dx].isAir()) {\n        map[playery][playerx + dx + dx] = this;\n        moveToTile(playerx + dx, playery);\n      }\n    }\n  }\n}\nclass FallingStone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (true) { }\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"\u500b\u5225\u52a0\u4e0acondition",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"\nclass Stone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (this.isFallingStone() === false) {\n      if (map[playery][playerx + dx + dx].isAir()\n        && !map[playery + 1][playerx + dx].isAir()) {\n        map[playery][playerx + dx + dx] = this;\n        moveToTile(playerx + dx, playery);\n      }\n    }\n  }\n}\nclass FallingStone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (this.isFallingStone() === true) { }\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"\u628a\u5404\u81ea\u7f3a\u7684\u90e8\u4efd\uff0c\u88dc\u5230\u5c0d\u65b9\u53bb\uff0c\u9019\u6a23\u9664\u4e86constant method\u4e4b\u5916\u90fd\u4e00\u6a23\u4e86",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (this.isFallingStone() === false) {\n      if (map[playery][playerx + dx + dx].isAir()\n        && !map[playery + 1][playerx + dx].isAir()) {\n        map[playery][playerx + dx + dx] = this;\n        moveToTile(playerx + dx, playery);\n      }\n    }\n    else if (this.isFallingStone() === true) {\n    }\n  }\n}\nclass FallingStone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    if (this.isFallingStone() === false) {\n      if (map[playery][playerx + dx + dx].isAir()\n        && !map[playery + 1][playerx + dx].isAir()) {\n        map[playery][playerx + dx + dx] = this;\n        moveToTile(playerx + dx, playery);\n      }\n    }\n    else if (this.isFallingStone() === true) {\n    }\n  }\n}\n")))),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"\u63a5\u4e0b\u4f86\u5f15\u5165falling field",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  isFallingStone() { return false; }\n}\nclass FallingStone implements Tile {\n  // ...\n  isFallingStone() { return true; }\n}\n"))),(0,l.kt)(i.Z,{value:"\u5728constructor\u7d66falling\u8ce6\u503c",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  private falling: boolean;\n  constructor() {\n    this.falling = false;\n  }\n  // ...\n  isFallingStone() { return false; }\n}\nclass FallingStone implements Tile {\n  private falling: boolean;\n  constructor() {\n    this.falling = true;\n  }\n  // ...\n  isFallingStone()\n"))),(0,l.kt)(i.Z,{value:"\u4fee\u6539isFallingStone",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  isFallingStone() { return false; }\n}\nclass FallingStone implements Tile {\n  // ...\n  isFallingStone() { return true; }\n}\n"))),(0,l.kt)(i.Z,{value:"\u6539\u6210\u56de\u50b3falling field",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  // ...\n  isFallingStone() { return this.falling; }\n}\nclass FallingStone implements Tile {\n  // ...\n  isFallingStone() { return this.falling; }\n}\n"))),(0,l.kt)(i.Z,{value:"\u5728constructor\u5403\u5165\u53c3\u6578",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  private falling: boolean;\n  constructor(falling: boolean) {\n    this.falling = falling;\n  }\n  // ...\n}\n")))),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"\u63a5\u4e0b\u4f86compiler\u6703\u5831\u932f",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"/// ...\nnew Stone();\n/// ...\n\n/// ...\nnew FallingStone(true);\n/// ...\n\n"))),(0,l.kt)(i.Z,{value:"\u4fee\u597d\u4ed6",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"/// ...\nnew Stone(false);\n/// ...\n\n/// ...\nnew Stone(true);\n/// ...\n\n")))),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"Before",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"function updateTile(x: number, y: number) {\n  if (map[y][x].isStony()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingStone();\n    map[y][x] = new Air();\n  } else if (map[y][x].isBoxy()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingBox();\n    map[y][x] = new Air();\n  } else if (map[y][x].isFallingStone()) {\n    map[y][x] = new Stone();\n  } else if (map[y][x].isFallingBox()) {\n    map[y][x] = new Box();\n  }\n}\nclass Stone implements Tile {\n  // ...\n  isFallingStone() { return false; }\n  moveHorizontal(dx: number) {\n    if (map[playery][playerx + dx + dx].isAir()\n      && !map[playery + 1][playerx + dx].isAir()) {\n      map[playery][playerx + dx + dx] = this;\n      moveToTile(playerx + dx, playery);\n    }\n  }\n}\nclass FallingStone implements Tile {\n  // ...\n  isFallingStone() { return true; }\n  moveHorizontal(dx: number) { }\n}\n"))),(0,l.kt)(i.Z,{value:"After",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"function updateTile(x: number, y: number) {\n  if (map[y][x].isStony()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new Stone(true);\n    map[y][x] = new Air();\n  } else if (map[y][x].isBoxy()\n    && map[y + 1][x].isAir()) {\n    map[y + 1][x] = new FallingBox();\n    map[y][x] = new Air();\n  } else if (map[y][x].isFallingStone()) {\n    map[y][x] = new Stone(false);\n  } else if (map[y][x].isFallingBox()) {\n    map[y][x] = new Box();\n  }\n}\nclass Stone implements Tile {\n  constructor(private falling: boolean) { }\n  // ...\n  isFallingStone() { return this.falling; }\n  moveHorizontal(dx: number) {\n    if (this.isFallingStone() === false) {\n      if (map[playery][playerx + dx + dx].isAir()\n        && !map[playery + 1][playerx + dx].isAir()) {\n        map[playery][playerx + dx + dx] = this;\n        moveToTile(playerx + dx, playery);\n      }\n    } else if (this.isFallingStone() === true) {\n    }\n  }\n}\n")))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"In TypeScript \u2026\nConstructors behave a little differently than in most languages. First, we can have only one\nconstructor, and it is always called constructor.\nSecond, putting public or private in front of a parameter to the constructor automatically\nmakes an instance variable and assigns it the value of the argument. So the following are\nequivalent."),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\n  private falling: boolean;\n  constructor(falling: boolean) {\n    this.falling = falling;\n  }\n}\n")),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Stone implements Tile {\nconstructor(\nprivate falling: boolean) { }\n}\n"))),(0,l.kt)("p",null,"\u56de\u982d\u770b\u4e00\u4e0b\u767c\u73femoveHorizontal\u6709if\u642d\u914delse\uff0c\u662f\u4e0d\u662f\u53c8\u60f3\u8d77\u54ea\u5e7e\u62db..."),(0,l.kt)("p",null,"\u7576\u628afalling\u8b8a\u6210type code\uff0c\u5c31\u53ef\u4ee5\u4f7f\u51fa\u9023\u7e8c\u6280 -> into enum type -> Replace type code with classes -> push code into classes"),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(i.Z,{value:"Before",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"/// ...\nnew Stone(true);\n/// ...\nnew Stone(false);\n/// ...\nclass Stone implements Tile {\n  constructor(private falling: boolean) { }\n  // ...\n  isFallingStone() {\n    return this.falling;\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"\u8f49\u6210enum",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"enum FallingState {\n  FALLING, RESTING\n}\n/// ...\nnew Stone(FallingState.FALLING);\n/// ...\nnew Stone(FallingState.RESTING);\n/// ...\nclass Stone implements Tile {\n  constructor(private falling: FallingState) { }\n  // ...\n  isFallingStone() {\n    return this.falling\n      === FallingState.FALLING;\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"Replace Type Code with Classes",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"interface FallingState {\n  isFalling(): boolean;\n  isResting(): boolean;\n}\nclass Falling implements FallingState {\n  isFalling() { return true; }\n  isResting() { return false; }\n}\nclass Resting implements FallingState {\n  isFalling() { return false; }\n  isResting() { return true; }\n}\nnew Stone(new Falling());\nnew Stone(new Resting());\nclass Stone implements Tile {\n  constructor(private falling:\n    FallingState) { }\n  // ...\n  isFallingStone() {\n    return this.falling.isFalling();\n  }\n}\n"))),(0,l.kt)(i.Z,{value:"\u767c\u8d77push code into classes\u62db\u6578",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"\ninterface FallingState {\n  // ...\n  moveHorizontal(\n    tile: Tile, dx: number): void;\n}\nclass Falling implements FallingState {\n  // ...\n  moveHorizontal(tile: Tile, dx: number) {\n  }\n"))),(0,l.kt)(i.Z,{value:"\u628afunciton\u901a\u901a\u585e\u9032class\uff0c\u7136\u5f8c\u8abf\u6574condition",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"class Resting implements FallingState {\n  // ...\n  moveHorizontal(tile: Tile, dx: number) {\n    if (map[playery][playerx + dx + dx].isAir()\n      && !map[playery + 1][playerx + dx].isAir()) {\n      map[playery][playerx + dx + dx] = tile;\n      moveToTile(playerx + dx, playery);\n    }\n  }\n}\nclass Stone implements Tile {\n  // ...\n  moveHorizontal(dx: number) {\n    this.falling.moveHorizontal(this, dx);\n  }\n}\n")))),(0,l.kt)("h3",{id:"511-\u91cd\u69cb\u6a21\u5f0f-unify-similar-classes"},"5.1.1 \u91cd\u69cb\u6a21\u5f0f: Unify Similar Classes"),(0,l.kt)("p",null,"\u63cf\u8ff0\uff1a"),(0,l.kt)("p",null,"\u7576\u6709\u5169\u500b\u6216\u591a\u500bclass\uff0c\u53ea\u5dee\u5728constant method\uff0c\u53ef\u4ee5\u670d\u7528\u6b64\u85e5\u65b9\u53bb\u6574\u5408\u4ed6\u5011"),(0,l.kt)("p",null,"Unifying classes is great because having fewer classes usually\nmeans we uncover more structure."),(0,l.kt)("p",null,"\u7a0b\u5e8f"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The first phase is to make all the non-basis methods equal. For each of these\nmethods, perform these steps:"),(0,l.kt)("p",{parentName:"li"},"  a. In the body of each version of the method, add an enclosing if (true) { }\naround the existing code."),(0,l.kt)("p",{parentName:"li"},"  b. Replace true with an expression calling all the basis methods and comparing\ntheir result to their constant values."),(0,l.kt)("p",{parentName:"li"},"  c. Copy the body of each version, and paste it with an else into all the other\nversions.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Now that only the basis methods are different, the second phase begins by\nintroducing a field for each method in the basis and assigning its constant in\nthe constructor.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Change the methods to return the new fields instead of the constants.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Compile to ensure that we have not broken anything yet.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"For each class, one field at a time:"))),(0,l.kt)("p",null,"a Copy the default value of the field, and then make the default value a\nparameter."),(0,l.kt)("p",null,"b Go through the compiler errors, and insert the default value as an argument."),(0,l.kt)("p",null,"6 After all the classes are identical, delete all but one of the unified classes, and\nfix all the compile errors by switching to the remaining class."))}g.isMDXComponent=!0}}]);