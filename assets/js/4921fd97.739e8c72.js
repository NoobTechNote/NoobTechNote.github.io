"use strict";(self.webpackChunknoobtechnote_github_io_source=self.webpackChunknoobtechnote_github_io_source||[]).push([[9698],{3905:(t,e,a)=>{a.d(e,{Zo:()=>u,kt:()=>d});var l=a(67294);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function o(t,e){if(null==t)return{};var a,l,n=function(t,e){if(null==t)return{};var a,l,n={},i=Object.keys(t);for(l=0;l<i.length;l++)a=i[l],e.indexOf(a)>=0||(n[a]=t[a]);return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(l=0;l<i.length;l++)a=i[l],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}var p=l.createContext({}),k=function(t){var e=l.useContext(p),a=e;return t&&(a="function"==typeof t?t(e):r(r({},e),t)),a},u=function(t){var e=k(t.components);return l.createElement(p.Provider,{value:e},t.children)},c="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return l.createElement(l.Fragment,{},e)}},s=l.forwardRef((function(t,e){var a=t.components,n=t.mdxType,i=t.originalType,p=t.parentName,u=o(t,["components","mdxType","originalType","parentName"]),c=k(a),s=n,d=c["".concat(p,".").concat(s)]||c[s]||m[s]||i;return a?l.createElement(d,r(r({ref:e},u),{},{components:a})):l.createElement(d,r({ref:e},u))}));function d(t,e){var a=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var i=a.length,r=new Array(i);r[0]=s;var o={};for(var p in e)hasOwnProperty.call(e,p)&&(o[p]=e[p]);o.originalType=t,o[c]="string"==typeof t?t:n,r[1]=o;for(var k=2;k<i;k++)r[k]=a[k];return l.createElement.apply(null,r)}return l.createElement.apply(null,a)}s.displayName="MDXCreateElement"},33180:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>p,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>k});var l=a(87462),n=(a(67294),a(3905));const i={title:"Ch3: \u4ea4\u6613\u8655\u7406",tsidebar_label:"Ch3: \u4ea4\u6613\u8655\u7406",sidebar_position:3},r="\u4ea4\u6613\u8655\u7406 (Transaction)",o={unversionedId:"sg/fenix-architecture/ch3",id:"sg/fenix-architecture/ch3",title:"Ch3: \u4ea4\u6613\u8655\u7406",description:"\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u7cfb\u7d71\u53ef\u80fd\u9047\u5230\u7684\u5e7e\u7a2e\u932f\u8aa4\uff1a",source:"@site/docs/sg/fenix-architecture/ch3.md",sourceDirName:"sg/fenix-architecture",slug:"/sg/fenix-architecture/ch3",permalink:"/docs/sg/fenix-architecture/ch3",draft:!1,editUrl:"https://github.com/NoobTechNote/NoobTechNote.github.io/tree/main/docs/sg/fenix-architecture/ch3.md",tags:[],version:"current",lastUpdatedBy:"Mech",lastUpdatedAt:1692117700,formattedLastUpdatedAt:"Aug 15, 2023",sidebarPosition:3,frontMatter:{title:"Ch3: \u4ea4\u6613\u8655\u7406",tsidebar_label:"Ch3: \u4ea4\u6613\u8655\u7406",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Ch2: \u5b58\u53d6\u9060\u7aef\u670d\u52d9",permalink:"/docs/sg/fenix-architecture/ch2"},next:{title:"Ch4: \u900f\u660e\u591a\u7d1a\u5206\u6d41\u7cfb\u7d71",permalink:"/docs/sg/fenix-architecture/ch4"}},p={},k=[{value:"3.1\u3000\u672c\u5730\u4ea4\u6613 (Local Transaction)",id:"31\u672c\u5730\u4ea4\u6613-local-transaction",level:2},{value:"3.1.1 \u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027",id:"311-\u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027",level:2},{value:"Commit Logging",id:"commit-logging",level:3},{value:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record):",id:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record",level:4},{value:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record)\u5c31\u767c\u751f\u6545\u969c\uff1a",id:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record\u5c31\u767c\u751f\u6545\u969c",level:4},{value:"Solution: Write-Ahead Logging (WAL)",id:"solution-write-ahead-logging-wal",level:3},{value:"Undo Log\uff1a",id:"undo-log",level:4},{value:"Redo Log\uff1a",id:"redo-log",level:4},{value:"WAL \u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5\uff1a",id:"wal-\u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5",level:4},{value:"3.1.2 \u5be6\u73fe\u9694\u96e2\u6027",id:"312-\u5be6\u73fe\u9694\u96e2\u6027",level:2},{value:"Read Uncommitted",id:"read-uncommitted",level:3},{value:"Read Committed",id:"read-committed",level:3},{value:"Repeatable Read",id:"repeatable-read",level:3},{value:"Serializable",id:"serializable",level:3},{value:"Snapshot(MVCC)",id:"snapshotmvcc",level:3},{value:"3.2 \u5168\u5c40\u4ea4\u6613 (Global Transaction)",id:"32-\u5168\u5c40\u4ea4\u6613-global-transaction",level:2},{value:"\u5169\u6bb5\u5f0f\u63d0\u4ea4(2 Phase Commitment; 2PC)",id:"\u5169\u6bb5\u5f0f\u63d0\u4ea42-phase-commitment-2pc",level:3},{value:"\u4e09\u6bb5\u5f0f\u63d0\u4ea4(3 Phase Commitment; 3PC)",id:"\u4e09\u6bb5\u5f0f\u63d0\u4ea43-phase-commitment-3pc",level:3},{value:"\u5c0f\u7bc0\uff1a",id:"\u5c0f\u7bc0",level:3},{value:"3.3 \u5171\u4eab\u4ea4\u6613 (Share Transaction)",id:"33-\u5171\u4eab\u4ea4\u6613-share-transaction",level:2},{value:"3.4 \u5206\u6563\u5f0f\u4ea4\u6613 (Distributed Transaction)",id:"34-\u5206\u6563\u5f0f\u4ea4\u6613-distributed-transaction",level:2},{value:"CAP \u5b9a\u7406",id:"cap-\u5b9a\u7406",level:3},{value:"\u4e00\u81f4\u6027 (<strong>C</strong>onsistency)",id:"\u4e00\u81f4\u6027-consistency",level:4},{value:"\u53ef\u7528\u6027 (<strong>A</strong>vailability)",id:"\u53ef\u7528\u6027-availability",level:4},{value:"\u5206\u5340\u5bb9\u932f (<strong>P</strong>artition tolerance)",id:"\u5206\u5340\u5bb9\u932f-partition-tolerance",level:4},{value:"CA\uff0c\u6368\u68c4 P",id:"ca\u6368\u68c4-p",level:3},{value:"CP\uff0c\u6368\u68c4 A",id:"cp\u6368\u68c4-a",level:3},{value:"AP\uff0c\u6368\u68c4 C",id:"ap\u6368\u68c4-c",level:3},{value:"\u53ef\u9760\u4e8b\u4ef6\u968a\u5217",id:"\u53ef\u9760\u4e8b\u4ef6\u968a\u5217",level:3},{value:"TCC \u4ea4\u6613",id:"tcc-\u4ea4\u6613",level:3},{value:"SAGA \u4ea4\u6613",id:"saga-\u4ea4\u6613",level:3},{value:"\u7e3d\u7d50\uff1a",id:"\u7e3d\u7d50",level:3}],u={toc:k},c="wrapper";function m(t){let{components:e,...i}=t;return(0,n.kt)(c,(0,l.Z)({},u,i,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"\u4ea4\u6613\u8655\u7406-transaction"},"\u4ea4\u6613\u8655\u7406 (Transaction)"),(0,n.kt)("p",null,"\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u7cfb\u7d71\u53ef\u80fd\u9047\u5230\u7684\u5e7e\u7a2e\u932f\u8aa4\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u8cc7\u6599\u5eab\u6545\u969c"),(0,n.kt)("li",{parentName:"ul"},"\u61c9\u7528\u7a0b\u5f0f\u5d29\u6f70"),(0,n.kt)("li",{parentName:"ul"},"\u61c9\u7528\u7a0b\u5f0f\u8207\u8cc7\u6599\u5eab\u9593\u7684\u7db2\u8def\u9023\u7dda\u4e2d\u65b7"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("del",{parentName:"li"},"\u5404\u7a2e\u9b3c\u6545\u4e8b"),"......")),(0,n.kt)("p",null,"\u8cc7\u6599\u5eab\u7684\u4ea4\u6613(Transaction)\u6d88\u9664\u8cc7\u6599\u662f\u5426\u66f4\u65b0\u7684\u7591\u616e\uff0c\u4fee\u6539\u8cc7\u6599\u5fc5\u9808\u6eff\u8db3\u5b9a\u7fa9\u597d\u7684\u898f\u5247\uff0c\u5305\u542b\u8cc7\u6599\u7684\u5b8c\u6574\u6027\u3001\u5931\u6557\u6642\u89f8\u767c\u56de\u6efe (rollback) \u7b49\u7b49\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Transaction(TX):")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"SQL \u8a9e\u53e5\u7684\u96c6\u5408\uff0c\u8996\u70ba\u4e00\u500b\u5de5\u4f5c\u55ae\u5143\uff0c\u8cc7\u6599\u5eab\u8655\u7406\u7684\u908f\u8f2f\u55ae\u4f4d"),(0,n.kt)("li",{parentName:"ul"},"\u9031\u671f\uff1aBegin \u2192 Commit (or Rollback)")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"ACID TX",src:a(19488).Z,width:"1920",height:"1080"})),(0,n.kt)("admonition",{title:"\u76ee\u7684",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"\u4fdd\u6301\u8cc7\u6599\u5eab\u4e2d\u8cc7\u6599\u72c0\u614b\u7684\u300c\u4e00\u81f4\u6027\u300d",(0,n.kt)("strong",{parentName:"p"},"C"),"onsistency")),(0,n.kt)("p",null,"\u8cc7\u6599\u5eab\u7684\u7d93\u5178\u7406\u8ad6\uff0cTX \u5177\u5099\u7684\u7279\u6027\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u539f\u5b50\u6027"),"\uff08",(0,n.kt)("strong",{parentName:"li"},"A"),"tomic\uff09: \u6bcf\u500b TX \u6709\u5169\u7a2e\u53ef\u80fd\u7d50\u679c \u2192 \u5168\u90e8\u57f7\u884c\u6210\u529f or \u5168\u90e8\u5931\u6557\u4e0d\u57f7\u884c(\u53ea\u8981\u5176\u4e2d\u4e00\u500b\u5931\u6557\u5c31\u8b93\u4fee\u6539\u7684\u8cc7\u6599\u5168\u90e8 rollback \u5230 TX \u958b\u59cb\u524d\u7684\u72c0\u614b)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u9694\u96e2\u6027"),"\uff08",(0,n.kt)("strong",{parentName:"li"},"I"),"solation\uff09\uff1a \u78ba\u4fdd\u6bcf\u500b TX \u5728\u9032\u884c\u6642\u4e0d\u6703\u4e92\u76f8\u5e72\u64fe"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u6301\u4e45\u6027\uff08D"),"urability\uff09: TX \u4fdd\u8b49\u6240\u6709\u6210\u529f\u88ab commit \u7684\u8cc7\u6599\u4fee\u6539\u90fd\u80fd\u5920\u6b63\u78ba\u5730\u88ab\u6c38\u4e45\u5132\u5b58(\u6210\u529f\u5beb\u5230\u786c\u789f\u6216 SSD \u4e0a)")),(0,n.kt)("admonition",{title:"\u88dc\u5145",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"\u5132\u5b58\u9ede (save point):"),(0,n.kt)("p",{parentName:"admonition"},"SAVEPOINT \u6307\u4ee4\u5b9a\u7fa9\u4e00\u500b TX \u5132\u5b58\u9ede\uff0c\u5141\u8a31\u53d6\u6d88\u90e8\u4efdTX\uff0c\u800c\u53ea\u63d0\u4ea4(commit)\u5269\u9918\u7684\u90e8\u4efd\uff0c\u53ef\u4ee5\u5728\u4ea4\u6613\u4e2d\u63d2\u5165\u5132\u5b58\u9ede\uff0c\u6709\u9700\u8981\u6642\u53ef\u4ee5 rollback \u5230\u5132\u5b58\u9ede\uff0c\u800c\u4e0d\u7528 rollback \u6574\u500b TX\u3002")),(0,n.kt)("p",null,"\u8209\u4f8b\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u9280\u884c\u8f49\u5e33"),(0,n.kt)("li",{parentName:"ul"},"\u8766\u76ae\u8cfc\u7269")),(0,n.kt)("p",null,"TX \u7684\u6982\u5ff5\u5ef6\u4f38\u5230\u6240\u6709\u9700\u8981\u4fdd\u8b49\u8cc7\u6599\u4e00\u81f4\u6027\u7684\u61c9\u7528\u5834\u666f e.g. \u5feb\u53d6\u6a5f\u5236\u3001Message Queue\u3001\u5206\u6563\u5f0f\u7684\u5132\u5b58\u67b6\u69cb\u3002"),(0,n.kt)("p",null,"\u4e0a\u8ff0\u7684\u61c9\u7528\u5834\u666f\u8207\u8cc7\u6599\u5eab\u7684 TX \u4e00\u81f4\u6027\u975e\u5b8c\u5168\u76f8\u540c\u7684\u6982\u5ff5\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5167\u90e8\u4e00\u81f4\u6027\uff1a\u4e00\u500b\u670d\u52d9\u4f7f\u7528\u4e00\u500b\u8cc7\u6599\u6e90\uff0c\u900f\u904e A\u3001I\u3001D \u4f86\u78ba\u4fdd\u8cc7\u6599\u4e00\u81f4\u6027"),(0,n.kt)("li",{parentName:"ul"},"\u5916\u90e8\u4e00\u81f4\u6027\uff1a\u4e00\u500b\u670d\u52d9\u4f7f\u7528\u591a\u500b\u8cc7\u6599\u6e90\u3001\u591a\u500b\u670d\u52d9\u4f7f\u7528\u591a\u500b\u4e0d\u540c\u8cc7\u6599\u6e90\uff0c\u6d89\u53ca\u591a\u500b\u8cc7\u6599\u6e90\u7684 TX \u4e00\u81f4\u6027 \u2192 \u5206\u6563\u5f0f\u7cfb\u7d71\u9047\u5230\u7684\u96e3\u984c")),(0,n.kt)("p",null,"\u8cc7\u6599\u4e00\u81f4\u6027\u5206\u4e09\u7a2e\u7279\u6027:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5f37\u4e00\u81f4\u6027\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u4efb\u4f55\u8b80\u53d6\u7684\u8cc7\u6599\u90fd\u662f\u6700\u65b0\u7684\u503c"),(0,n.kt)("li",{parentName:"ul"},"\u5f31\u4e00\u81f4\u6027\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u7121\u6cd5\u4fdd\u8b49\u90fd\u80fd\u8b80\u53d6\u5230\u6700\u65b0\u7684\u8cc7\u6599"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u7d42\u4e00\u81f4\u6027(\u5f8c\u9762\u8ac7 CAP \u7406\u8ad6)\uff1a\u5beb\u5b8c\u4e4b\u5f8c\uff0c\u6700\u5f8c\u4e00\u5b9a\u80fd\u8b80\u5230\u6700\u65b0\u7684\u503c")),(0,n.kt)("h2",{id:"31\u672c\u5730\u4ea4\u6613-local-transaction"},"3.1\u3000\u672c\u5730\u4ea4\u6613 (Local Transaction)"),(0,n.kt)("p",null,"\u53c8\u4f5c\u300cLocal Transaction\u300d\uff0c\u9069\u7528\u65bc\u55ae\u500b\u670d\u52d9\u4f7f\u7528\u55ae\u500b\u8cc7\u6599\u6e90\u7684\u5834\u666f\u3002"),(0,n.kt)("p",null,"\u5be6\u73fe\u539f\u7406\u6e90\u81ea\u65bc ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Algorithms_for_Recovery_and_Isolation_Exploiting_Semantics"},"ARIES")," \u7406\u8ad6\uff0c\u73fe\u4ee3\u95dc\u4fc2\u578b\u8cc7\u6599\u5eab\u7684\u7406\u8ad6\u57fa\u790e\u3002"),(0,n.kt)("h2",{id:"311-\u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027"},"3.1.1 \u5be6\u73fe\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027"),(0,n.kt)("p",null,"\u6eff\u8db3\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027\u7684\u6700\u5927\u56f0\u96e3\u9ede\uff1a\n\u300c\u5beb\u5165\u786c\u789f\u300d\u9019\u500b\u52d5\u4f5c\u4e26\u975e\u539f\u5b50\u7684\uff0c\u9664\u4e86\u6709\u300c\u5beb\u5165\u300d\u8207\u300c\u672a\u5beb\u5165\u300d\u72c0\u614b\uff0c\u9084\u5b58\u5728\u300c\u6b63\u5728\u5beb\u300d\u504f\u5411\u4e2d\u9593\u7684\u72c0\u614b\u3002"),(0,n.kt)("p",null,"\u53ef\u80fd\u767c\u751f\u5e7e\u7a2e\u60c5\u5f62\uff1a"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u672a\u63d0\u4ea4 TX\uff0c\u5beb\u5165\u5f8c crash"),":"),(0,n.kt)("p",null,"\u61c9\u7528\u7a0b\u5f0f\u9084\u6c92\u4fee\u6539\u5b8c\u8cc7\u6599\uff0c\u4f46\u8cc7\u6599\u5eab\u5df2\u5c07\u90e8\u5206\u8cc7\u6599\u7684\u8b8a\u52d5\u5beb\u5165\u786c\u789f\uff0c\u767c\u751f\u6545\u969c\u7684\u72c0\u6cc1\uff0c\u7d93\u91cd\u555f\u5f8c\uff0c\u8cc7\u6599\u5eab\u5fc5\u9808\u8981\u6709\u8fa6\u6cd5\u5f97\u77e5\u6545\u969c\u524d\u767c\u751f\u904e\u4e00\u6b21\u300c\u4e0d\u5b8c\u6574\u300d\u7684\u64cd\u4f5c\uff0c\u5c07\u5df2\u4fee\u6539\u904e\u7684\u8cc7\u6599\u5f9e\u786c\u789f\u4e2d\u6062\u5fa9\u6210\u6c92\u6709\u6539\u904e\u7684\u6a23\u5b50\uff0c\u78ba\u4fdd\u539f\u5b50\u6027\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5df2\u63d0\u4ea4 TX\uff0c\u5beb\u5165\u524d crash"),":"),(0,n.kt)("p",null,"\u61c9\u7528\u7a0b\u5f0f\u4fee\u6539\u5b8c\u6240\u6709\u8cc7\u6599\u4e26\u5b8c\u6210 commit\uff0c\u4f46\u8cc7\u6599\u5eab\u9084\u672a\u5c07\u6240\u6709\u8b8a\u52d5\u8cc7\u6599\u5beb\u5165\u786c\u789f\uff0c\u767c\u751f\u6545\u969c\u6642\u7d93\u904e\u91cd\u555f\uff0c\u8cc7\u6599\u5eab\u5fc5\u9808\u5c07\u672a\u5b8c\u6210\u7684\u8cc7\u6599\u91cd\u65b0\u5beb\u5165\u786c\u789f\uff0c\u6eff\u8db3\u6301\u4e45\u6027\u3002"),(0,n.kt)("h3",{id:"commit-logging"},"Commit Logging"),(0,n.kt)("p",null,"\u4ee5\u300c\u65e5\u8a8c\u300d\u7684\u5f62\u5f0f\u4f9d\u5e8f\u5c07\u4fee\u6539\u8cc7\u6599\u7684\u64cd\u4f5c\u5305\u542b\u7684\u6240\u6709\u8a0a\u606f(e.g. \u4fee\u6539\u54ea\u7b46\u8cc7\u6599\u3001\u8cc7\u6599\u4fdd\u5b58\u5728\u786c\u789f\u88e1\u7684\u54ea\u500b\u5340\u584a\u7b49)\uff0c\u90fd\u5148\u8a18\u9304\u5230\u786c\u789f\u88e1\uff0c\u4fdd\u969c\u8cc7\u6599\u6301\u4e45\u6027\u3001\u539f\u5b50\u6027\u5169\u500b\u7279\u6027\u3002"),(0,n.kt)("p",null,"\u53ea\u6709\u5728 commit log \u6210\u529f\u7d00\u9304\u5728\u786c\u789f\u88e1\uff0c\u8cc7\u6599\u5eab\u5728\u65e5\u8a8c\u4e2d\u770b\u5230\u4ee3\u8868 TX \u6210\u529f\u7684\u63d0\u4ea4\u7d00\u9304\uff08Commit Record\uff09\u5f8c\uff0c\u624d\u6703\u6839\u64da\u65e5\u8a8c\u4e0a\u7684\u8a0a\u606f\u5c0d\u771f\u6b63\u7684\u8cc7\u6599\u9032\u884c\u4fee\u6539\u3002"),(0,n.kt)("p",null,"\u4fee\u6539\u5b8c\u6210\u5f8c\uff0c\u5728\u65e5\u8a8c\u4e2d\u52a0\u5165\u4e00\u689d\u201c\u7d50\u675f\u8a18\u9304\u201d \uff08End Record\uff09\u8868\u793a TX \u6eff\u8db3\u6301\u4e45\u6027\u3002"),(0,n.kt)("h4",{id:"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record"},"\u65e5\u8a8c\u4e00\u65e6\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record):"),(0,n.kt)("p",null,"\u6574\u500b TX \u8996\u70ba\u6210\u529f\uff0c\u5373\u4fbf\u771f\u6b63\u4fee\u6539\u8cc7\u6599\u6642\u767c\u751f\u6545\u969c\uff0c\u8cc7\u6599\u5eab\u91cd\u555f\u5f8c\u6839\u64da\u5df2\u7d93\u5beb\u5165\u786c\u789f\u7684\u65e5\u8a8c\u9032\u884c\u6062\u5fa9\u3001\u7e7c\u7e8c\u4fee\u6539\u8cc7\u6599\u5373\u53ef\uff0c\u4fdd\u8b49\u6301\u4e45\u6027\u3002"),(0,n.kt)("h4",{id:"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304commit-record\u5c31\u767c\u751f\u6545\u969c"},"\u65e5\u8a8c\u6c92\u6709\u6210\u529f\u5beb\u5165\u63d0\u4ea4\u7d00\u9304(Commit Record)\u5c31\u767c\u751f\u6545\u969c\uff1a"),(0,n.kt)("p",null,"\u6574\u500b TX \u5c31\u662f\u5931\u6557\u7684\uff0c\u8cc7\u6599\u5eab\u91cd\u555f\u5f8c\u6703\u770b\u5230\u4e00\u90e8\u5206\u6c92\u6709 commit \u7d00\u9304\u7684\u65e5\u8a8c\uff0c\u6a19\u8a18\u70ba rollback \u72c0\u614b\uff0c\u9000\u56de\u5230 TX \u958b\u59cb\u4e4b\u524d\uff0c\u4fdd\u8b49\u539f\u5b50\u6027\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7f3a\u9677\uff1a")),(0,n.kt)("p",null,"\u5f71\u97ff\u8cc7\u6599\u5eab\u7684\u6548\u80fd\u3002"),(0,n.kt)("h3",{id:"solution-write-ahead-logging-wal"},"Solution: Write-Ahead Logging (WAL)"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u53c8\u4f5c\u300c\u9810\u5beb\u65e5\u8a8c\u300d\uff0c\u5141\u8a31\u5728 TX commit \u4e4b\u524d\uff0c\u63d0\u524d\u5beb\u5165\u8b8a\u52d5\u8cc7\u6599\u3002")),(0,n.kt)("p",null,"\u5beb\u5165\u8b8a\u52d5\u8cc7\u6599\u7684\u6642\u9593\u9ede\u4ee5 TX commit \u6642\u70ba\u754c\u53bb\u5283\u5206\uff0c\u5206\u4f5c ",(0,n.kt)("inlineCode",{parentName:"p"},"FORCE")," \u548c ",(0,n.kt)("inlineCode",{parentName:"p"},"STEAL")," \u5169\u985e\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"FORCE")," :  TX commit \u4e4b\u300c\u5f8c\u300d",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u8981\u6c42\u8b8a\u52d5\u8cc7\u6599\u5fc5\u9808\u540c\u6642\u5b8c\u6210\u5beb\u5165\u5247\u7a31\u70ba ",(0,n.kt)("inlineCode",{parentName:"li"},"FORCE")),(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u5f37\u5236\u9808\u540c\u6642\u5b8c\u6210\u5beb\u5165\u5247\u7a31\u70ba ",(0,n.kt)("inlineCode",{parentName:"li"},"NO-FORCE")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"STEAL")," : TX commit \u4e4b\u300c\u524d\u300d",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"\u5141\u8a31\u8b8a\u52d5\u8cc7\u6599\u63d0\u524d\u5beb\u5165\u7a31\u70ba ",(0,n.kt)("inlineCode",{parentName:"li"},"STEAL")),(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u5141\u8a31\u8b8a\u52d5\u8cc7\u6599\u63d0\u524d\u5beb\u5165\u7a31\u70ba ",(0,n.kt)("inlineCode",{parentName:"li"},"NO-STEAL"))))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"LSN\u2013Log (Log Sequence Number Log)")),(0,n.kt)("p",null,"\u6bcf\u689d WAL log \u90fd\u6703\u5e36\u6709\u4e00\u4e32\u5e8f\u865f\uff0c\u7a31\u4f5c LSN(Log Sequence Number)\uff0c\u7d00\u9304 TX \u6539\u52d5\u5167\u5bb9\u3002"),(0,n.kt)("p",null,"WAL \u63d0\u4f9b\u984d\u5916\u7684\u6a5f\u5236: \u589e\u52a0 ",(0,n.kt)("strong",{parentName:"p"},"Undo Log")," \u7684\u65e5\u8a8c\u985e\u578b\u3002"),(0,n.kt)("h4",{id:"undo-log"},"Undo Log\uff1a"),(0,n.kt)("p",null,"\u5728\u6539\u52d5\u7684\u8cc7\u6599\u5beb\u5165\u786c\u789f\u524d\uff0c\u9808\u5148\u8a18\u9304 Undo log\uff0c\u5f8c\u7e8c\u9047\u5230\u9700\u8981 rollback \u6216\u662f\u6545\u969c\u7684\u60c5\u6cc1\uff0c\u628a\u9019\u4e9b Undo log \u7d00\u9304\u5167\u5bb9\u90fd\u62b9\u9664\u6389\u3002"),(0,n.kt)("h4",{id:"redo-log"},"Redo Log\uff1a"),(0,n.kt)("p",null,"\u7d00\u9304\u4fee\u6539\u8cc7\u6599\u7684\u64cd\u4f5c\u5167\u5bb9\u3002\u9047\u5230\u6545\u969c\u6642\uff0c\u85c9\u7531 WAL \u5beb\u5165\u7684 TX Log \u4f86\u6062\u5fa9\u91cd\u505a\u3002"),(0,n.kt)("h4",{id:"wal-\u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5"},"WAL \u6545\u969c\u6062\u5fa9\u6642\u6703\u57f7\u884c\u4e09\u500b\u968e\u6bb5\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Analysis(\u5206\u6790)\uff1a\u5f9e\u786c\u789f\u88e1\u5c0b\u627e\u6700\u5f8c(\u65b0)\u4e00\u6b21\u7684\u6aa2\u67e5\u9ede(\u5df2\u6210\u529f\u5730\u5beb\u5165\u786c\u789f\u88e1\u6eff\u8db3\u6301\u4e45\u5316)\uff0c\u958b\u59cb\u5c0d\u65e5\u8a8c\u9032\u884c\u6383\u63cf\uff0c\u627e\u51fa\u6c92\u6709\u7d50\u675f\u8a18\u9304\u7684 TX\uff0c\u7d44\u6210\u96c6\u5408\u5f85\u6062\u5fa9\u7684 TX\u3002"),(0,n.kt)("li",{parentName:"ul"},"Redo(\u91cd\u505a)\uff1a\u5206\u6790\u968e\u6bb5\u4e2d\u7522\u751f\u7684\u5f85\u6062\u5fa9\u7684 TX \u96c6\u5408\u4f86\u9084\u539f\u72c0\u614b\u3002"),(0,n.kt)("li",{parentName:"ul"},"Undo(\u56de\u6efe)\uff1a\u7d93\u904e\u5206\u6790\u3001\u91cd\u505a\u968e\u6bb5\u5f8c\u5269\u9918\u5f85\u6062\u5fa9\u7684 TX \u96c6\u5408\uff0c\u5373\u9700\u8981\u56de\u6efe\u7684 TX\uff0c\u4f9d Undo Log \u5167\u5bb9\u5c07\u63d0\u524d\u5beb\u5165\u786c\u789f\u7684\u8cc7\u6599\u4fee\u6539\u91cd\u65b0\u5beb\u56de\u53bb\u3002")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"FORCE \u548cSTEAL \u7684\u56db\u7a2e\u7d44\u5408\u95dc\u4fc2",src:a(91805).Z,width:"728",height:"313"})),(0,n.kt)("h2",{id:"312-\u5be6\u73fe\u9694\u96e2\u6027"},"3.1.2 \u5be6\u73fe\u9694\u96e2\u6027"),(0,n.kt)("p",null,"\u8cc7\u6599\u5eab\u9047\u5230\u591a\u500b TX \u7684\u4f75\u767c(Concurrency)\u554f\u984c\uff1a"),(0,n.kt)("p",null,"\u4ee5\u4e0b\u7686\u4ee5\u5047\u5b9a\u300c\u5169\u500b\u4e26\u884c\u300d\u7684 TX \u70ba\u4f8b\u3002"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u8a3b\uff1a\u7d93 ",(0,n.kt)("a",{parentName:"p",href:"https://www.husseinnasser.com/p/about-hussein.html"},"Hussein Nasser")," \u540c\u610f\uff0c\u4ee5\u4e0b\u5716\u7247\u5747\u4f86\u81ea\u7c21\u5831\u90e8\u5206\u7684\u5167\u5bb9\u3002")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Dirty Read:")),(0,n.kt)("p",null,"\u4e00\u500b TX \u8655\u7406\u904e\u7a0b\u4e2d\u8b80\u53d6\u5230\u53e6\u4e00\u500b TX \u672a ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8cc7\u6599\n",(0,n.kt)("img",{alt:"dirty-read",src:a(85626).Z,width:"1920",height:"1080"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Phantom Read:")),(0,n.kt)("p",null,"\u5169\u500b\u5b8c\u5168\u76f8\u540c\u7684\u7bc4\u570d TX\uff0c\u9023\u7e8c\u5169\u6b21\u8b80\u53d6\u6642\uff0c\u8b80\u53d6\u51fa\u4f86\u7684 ",(0,n.kt)("strong",{parentName:"p"},"\u300c\u7b46\u6578\u300d")," \u8ddf\u4e0a\u6b21\u4e0d\u540c\n",(0,n.kt)("img",{alt:"Phantom-read",src:a(6783).Z,width:"1920",height:"1080"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Non-repeatable Read (Read Skew):")),(0,n.kt)("p",null,"\u540c\u4e00\u500b TX \u4e2d\uff0c\u91cd\u8907\u8b80\u53d6\u6642\u6703\u62ff\u5230\u4e0d\u4e00\u81f4\u7684\u8cc7\u6599\n",(0,n.kt)("img",{alt:"Non-repeatable-read",src:a(87981).Z,width:"1920",height:"1080"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Lost updates:")),(0,n.kt)("p",null,"TX1 \u7684 UPDATE \u906d\u5230 TX2 \u8986\u5beb\uff0c\u5c0e\u81f4\u66f4\u65b0\u7684\u8cc7\u6599\u4e0d\u4e00\u6a23\n",(0,n.kt)("img",{alt:"Lost-updates",src:a(63649).Z,width:"1920",height:"1080"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u5e38\u898b\u624b\u6bb5\uff1a\u52a0\u9396\ud83d\udd12"),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u5beb\u9396\uff08Write Lock; Exclusive Lock -> X-Lock\uff09\uff1a"),"\n\u53ea\u6709\u62ff\u5230\u5beb\u9396\u7684 TX \u624d\u80fd\u5c0d\u8cc7\u6599\u505a\u5beb\u5165\uff0c\u672a\u91cb\u653e\u9396\u7684\u968e\u6bb5\uff0c\u5176\u4ed6 TX \u4e0d\u80fd\u5beb\u5165\u8cc7\u6599\uff0c\u4e5f\u4e0d\u80fd\u52a0\u8b80\u9396"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u8b80\u9396\uff08Read Lock; Shared Lock -> S-Lock\uff09\uff1a"),"\n\u591a\u500b TX \u53ef\u5c0d\u540c\u7b46\u8cc7\u6599\u52a0\u591a\u500b\u8b80\u9396\uff0c\u88ab\u52a0\u4e0a\u8b80\u9396\u7684\u8cc7\u6599\u5c31\u4e0d\u80fd\u518d\u88ab\u52a0\u4e0a\u5beb\u9396\uff0c\u6240\u4ee5\u5176\u4ed6 TX \u4e0d\u80fd\u5c0d\u8a72\u7b46\u8cc7\u6599\u9032\u884c\u5beb\u5165\uff0c\n\u4f46\u4ecd\u7136\u53ef\u8b80\u53d6\u3002"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"\u7bc4\u570d\u9396\uff08Range Lock\uff09:"),"\n\u5c0d\u65bc\u67d0\u500b\u7bc4\u570d\u76f4\u63a5\u52a0\u6392\u4ed6\u9396\uff0c\u5728\u9019\u500b\u7bc4\u570d\u5167\u7684\u8cc7\u6599\u90fd\u4e0d\u80fd\u88ab\u5beb\u5165\ne.g.")),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM purchases FOR UPDATE;\n"))),(0,n.kt)("p",null,"\u5e38\u898b\u7684\u9694\u96e2\u5c64\u7d1a\uff1a"),(0,n.kt)("h3",{id:"read-uncommitted"},"Read Uncommitted"),(0,n.kt)("p",null,"\u5141\u8a31\u8b80\u53d6\u5c1a\u672a\u88ab ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8cc7\u6599\uff0c\u5c6c\u65bc\u6700\u4f4e\u5c64\u7d1a\u3002"),(0,n.kt)("p",null,"\u9396\u7684\u7d44\u5408\uff1a\u5beb\u9396"),(0,n.kt)("h3",{id:"read-committed"},"Read Committed"),(0,n.kt)("p",null,"\u53ea\u5141\u8a31\u8b80\u53d6\u5df2\u88ab ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8cc7\u6599\uff0c\u53ef\u89e3\u6c7a Dirty Read \u7684\u554f\u984c\u3002"),(0,n.kt)("p",null,"\u9396\u7684\u7d44\u5408\uff1a\u5beb\u9396+\u8b80\u9396(\u8b80\u5b8c\u4e4b\u5f8c\u91cb\u653e\u9396)"),(0,n.kt)("h3",{id:"repeatable-read"},"Repeatable Read"),(0,n.kt)("p",null,"\u8b80\u5230\u7684\u8cc7\u6599\u53ea\u6703\u662f TX \u958b\u59cb\u524d\u5df2\u7d93 ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8cc7\u6599\uff0c\u4e0d\u6703\u8b80\u53d6\u5230\u5c1a\u672a ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8cc7\u6599\uff0c\u6216\u8005\u5728 TX \u671f\u9593\u88ab\u5176\u4ed6\u4e26\u884c\u7684 TX \u5b8c\u6210 ",(0,n.kt)("inlineCode",{parentName:"p"},"committed")," \u7684\u8b8a\u66f4"),(0,n.kt)("p",null,"\u9396\u7684\u7d44\u5408\uff1a\u5beb\u9396+\u8b80\u9396(\u6301\u7e8c)"),(0,n.kt)("h3",{id:"serializable"},"Serializable"),(0,n.kt)("p",null,"\u63a1\u5e8f\u5217\u5316\uff0c\u6700\u56b4\u683c\u7684\u9694\u96e2\u5c64\u7d1a\uff0c\u591a\u500b TXs \u8b8a\u6210\u4e00\u500b\u500b\u300c\u63a5\u7e8c\u57f7\u884c\u300d\uff0c\u6548\u80fd\u4e5f\u6700\u5dee\u3002"),(0,n.kt)("p",null,"\u9396\u7684\u7d44\u5408\uff1a\u5beb\u9396+\u8b80\u9396+\u7bc4\u570d\u9396"),(0,n.kt)("p",null,"\u5be6\u73fe\u65b9\u6cd5\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u9023\u7e8c\u57f7\u884c TX\uff1a \u7c21\u55ae\u7c97\u66b4\uff0c\u6bcf\u4e00\u500b\u6642\u9593\u9ede\u53ea\u6703\u6709\u4e00\u500b TX \u57f7\u884c\u3002"),(0,n.kt)("li",{parentName:"ul"},"\u4e8c\u968e\u6bb5\u9396 (Two-Phase Locking; 2PL)\uff1a",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"TX1 \u8b80\u8cc7\u6599 & TX2 \u5beb\u8cc7\u6599\uff0cTX2 \u5fc5\u9808\u7b49 TX1 \u5b8c\u6210\u63d0\u4ea4 or \u4e2d\u65b7"),(0,n.kt)("li",{parentName:"ul"},"TX1 \u5beb\u8cc7\u6599\uff0c\u800c TX2 \u8b80\u8cc7\u6599\uff0cTX2 \u4ecd\u5fc5\u9808\u7b49 TX1 \u5b8c\u6210\u63d0\u4ea4 or \u4e2d\u65b7"))),(0,n.kt)("li",{parentName:"ul"},"\u5e8f\u5217\u5316\u5feb\u7167\u9694\u96e2 (Serializable Snapshot Isolation; SSI)")),(0,n.kt)("p",null,"Two-Phase Locking - source: ",(0,n.kt)("a",{parentName:"p",href:"https://vladmihalcea.com/2pl-two-phase-locking/"},"How does the 2PL (Two-Phase Locking) algorithm work"),"\n",(0,n.kt)("img",{alt:"2PL",src:a(85077).Z,width:"1698",height:"1338"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"TX \u56b4\u683c\u7a0b\u5ea6:")),(0,n.kt)("p",null,"SERIALIZABLE > REPEATABLE READ > READ COMMITTED > READ UNCOMMITTED"),(0,n.kt)("p",null,"\u9694\u96e2\u5c64\u7d1a\u6bd4\u8f03\u8868(\u4ee5 ",(0,n.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/transaction-iso.html"},"Postgres")," \u70ba\u4f8b)\uff1a\n",(0,n.kt)("img",{alt:"PG-Transaction-Isolation-Levels",src:a(48964).Z,width:"787",height:"170"})),(0,n.kt)("h3",{id:"snapshotmvcc"},"Snapshot(MVCC)"),(0,n.kt)("p",null,"\u5c0d\u6bcf\u500b\u7522\u751f\u7684\u65b0\u8cc7\u6599\u505a snapshot\uff0c\u7522\u751f\u4e00\u500b\u65b0\u7248\u672c\uff0c\u540c\u6642\u4fdd\u7559\u820a\u7684\u7248\u672c\uff0c\u5141\u8a31 TX \u8b80\u53d6\u9019\u4e9b snapshot \u7684\u6700\u65b0\u7248\u672c => Multi-Version Concurrency Control (MVCC) \u7684\u65b9\u5f0f\u5be6\u73fe"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u597d\u8655: \u4e0d\u9808\u5728\u8cc7\u6599\u8868\u88e1\u8a2d\u7f6e\u9396(lock)\u4f86\u907f\u514d\u885d\u7a81"),(0,n.kt)("li",{parentName:"ul"},"\u7f3a\u9ede: \u6bcf\u7b46\u7d00\u9304\u90fd\u9700\u8981\u984d\u5916\u7684\u5132\u5b58\u7a7a\u9593")),(0,n.kt)("admonition",{title:"Discussion",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"\u6a02\u89c0\u9396\uff08Optimistic Locking\uff09vs. \u60b2\u89c0\u9396\uff08Pessimistic Locking\uff09")),(0,n.kt)("h2",{id:"32-\u5168\u5c40\u4ea4\u6613-global-transaction"},"3.2 \u5168\u5c40\u4ea4\u6613 (Global Transaction)"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u66f8\u88e1\u5b9a\u8abf\uff1a\u5728\u300c\u5206\u6563\u5f0f\u300d\u74b0\u5883\u4e2d\u4ecd\u8ffd\u6c42\u300c\u5f37\u4e00\u81f4\u6027\u300d\u7684 TX \u65b9\u6848")),(0,n.kt)("p",null,"\u6848\u4f8b\uff1a\u7dda\u4e0a\u66f8\u5e97\uff0c\u7528\u6236\u3001\u5546\u5bb6\u3001\u5009\u5eab\u5206\u5225\u8655\u65bc\u300c\u4e0d\u540c\u7684\u8cc7\u6599\u5eab\u300d\u4e2d"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-java"},"public void buyBook(PaymentBill bill) {\n    userTransaction.begin();\n    warehouseTransaction.begin();\n    businessTransaction.begin();\n    try {\n        userAccountService.pay(bill.getMoney());\n        warehouseService.deliver(bill.getItems());\n        businessAccountService.receipt(bill.getMoney());\n        userTransaction.commit();\n        warehouseTransaction.commit();\n        businessTransaction.commit();\n    } catch(Exception e) {\n        userTransaction.rollback();\n        warehouseTransaction.rollback();\n        businessTransaction.rollback();\n    }\n}\n")),(0,n.kt)("p",null,"\u70ba\u89e3\u6c7a\u300c\u5206\u6563\u5f0f\u300d\u74b0\u5883\u4e2d\u7684\u300c\u4e00\u81f4\u6027\u300d\u554f\u984c\uff0cX/Open \u7d44\u7e54\u63d0\u51fa\u4e86\u4e00\u5957\u540d\u70ba X/Open XA\uff08XA \u662feXtended Architecture \u7684\u7e2e\u5beb; \u64f4\u5c55\u67b6\u69cb\uff09\uff0c\u6982\u5ff5\u6e90\u81ea\u5206\u6563\u5f0f\u4ea4\u6613\u8655\u7406\u53c3\u8003\u6a21\u578b(",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Distributed_transaction"},"Distributed Transaction Processing"),"; DAP)\u3002"),(0,n.kt)("p",null,"DTP\u6a21\u578b\u6982\u5ff5\u5716\n",(0,n.kt)("img",{alt:"Distributed Transaction Processing (DTP)",src:a(41463).Z,width:"1200",height:"514"})),(0,n.kt)("p",null,"\u5143\u4ef6\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Resource Manager\uff1a\u63d0\u4f9b\u4ecb\u9762\u5171\u4eab\u8cc7\u6e90\u7684\u8a2a\u554f(e.g. \u8cc7\u6599\u5eab)"),(0,n.kt)("li",{parentName:"ul"},"Transaction Manager\uff1a\u5354\u8abf AP \u548c RM\uff0c\u8ca0\u8cac\u6307\u793a RM \u8655\u7406 TX \u904b\u4f5c e.g. \u6210\u529f commit\uff0c\u5931\u6557 rollback"),(0,n.kt)("li",{parentName:"ul"},"Application\uff1a\u5b9a\u7fa9\u4ea4\u6613\u908a\u754c\u4e26\u8a2a\u554f\u8cc7\u6e90\u3002")),(0,n.kt)("p",null,"\u70ba\u4e86\u80fd\u8b93\u591a\u500b\u8cc7\u6599\u5eab\u5171\u540c\u53c3\u8207\u7684 TX \u4fdd\u6301\u539f\u5b50\u6027\u8207\u4e00\u81f4\u6027\uff0cXA \u5c07 TX \u63d0\u4ea4(commit)\u904e\u7a0b\u62c6\u5206\u6210\u70ba\u5169\u968e\u6bb5"),(0,n.kt)("h3",{id:"\u5169\u6bb5\u5f0f\u63d0\u4ea42-phase-commitment-2pc"},"\u5169\u6bb5\u5f0f\u63d0\u4ea4(2 Phase Commitment; 2PC)"),(0,n.kt)("p",null,"\u524d\u63d0\u5047\u8a2d\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u7db2\u8def\u5728\u63d0\u4ea4\u968e\u6bb5\u7684\u77ed\u6642\u9593\u5167\u662f\u53ef\u9760\u7684\uff0c\u7db2\u8def\u50b3\u8f38\u5728\u6574\u500b\u904e\u7a0b\u90fd\u4e0d\u6703\u51fa\u73fe\u8aa4\u5dee"),(0,n.kt)("li",{parentName:"ul"},"\u6bcf\u500b\u53c3\u8207\u7684 TX \u90fd\u6709 WAL \u65e5\u8a8c"),(0,n.kt)("li",{parentName:"ul"},"\u6240\u6709\u5d29\u6f70\u7684\u7bc0\u9ede\u6700\u7d42\u90fd\u6703\u6062\u5fa9\uff0c\u4e0d\u6703\u4e00\u76f4\u8655\u65bc\u5d29\u6f70\u72c0\u614b"),(0,n.kt)("li",{parentName:"ul"},"\u5404\u7bc0\u9ede\u4e0a\u7684 TX \u72c0\u614b\u5373\u4f7f\u78b0\u5230\u6a5f\u5668\u5d29\u6f70\u90fd\u53ef\u5f9e WAL \u65e5\u8a8c\u4e0a\u6062\u5fa9")),(0,n.kt)("p",null,"\u89d2\u8272\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5354\u8abf\u8005(Coordinator)\uff1a\u8ca0\u8cac\u767c\u8d77\u8207\u7dad\u8b77\u5169\u6bb5\u5f0f\u63d0\u4ea4\u6d41\u7a0b"),(0,n.kt)("li",{parentName:"ul"},"\u53c3\u8207\u8005(Participant)\uff1a\u53c3\u8207 TX \u7684\u8cc7\u6599\u5eab")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"2 Phase Commitment",src:a(92022).Z,width:"639",height:"214"})),(0,n.kt)("p",null,"\u968e\u6bb5\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u6295\u7968\u968e\u6bb5(Voting Phase)\uff1a",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"\u5354\u8abf\u8005\u767c\u9001\u8acb\u6c42\u7d66\u6240\u6709\u7684\u53c3\u8207\u8005 "),(0,n.kt)("li",{parentName:"ol"},"\u53c3\u8207\u8005\u6703\u56de\u8986\u662f\u5426\u5df2\u7d93\u6e96\u5099\u597d\u63d0\u4ea4(e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"Prepare"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"Abort"),")\u3002 Note: \u5354\u8abf\u8005\u6703\u6709 timeout \u6a5f\u5236\u3002"))),(0,n.kt)("li",{parentName:"ul"},"\u63d0\u4ea4\u968e\u6bb5(Commit Phase)\uff1a",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"\u5354\u8abf\u8005\u641c\u96c6\u6295\u7968\u7d50\u679c\uff1a",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"All ",(0,n.kt)("inlineCode",{parentName:"li"},"Yes"),": \u5ba3\u544a\u6210\u529f\uff0c\u767c\u9001 ",(0,n.kt)("inlineCode",{parentName:"li"},"Commit")," \u8acb\u6c42\u7d66\u6bcf\u500b\u53c3\u8207\u8005"),(0,n.kt)("li",{parentName:"ol"},"Not all ",(0,n.kt)("inlineCode",{parentName:"li"},"Yes"),"\uff0c\u5354\u8abf\u8005\u6c7a\u5b9a\u653e\u68c4\u4ea4\u6613\uff0c\u767c\u9001 ",(0,n.kt)("inlineCode",{parentName:"li"},"Abort")," \u7d66\u53c3\u8207\u8005")))))),(0,n.kt)("p",null,"\u7f3a\u9ede\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u55ae\u9ede\u554f\u984c\uff1a\u5354\u8abf\u8005\u7684 TX \u7ba1\u7406\u5668\u7121\u6cd5\u6b63\u5e38\u904b\u4f5c => \u6574\u500b TX \u88ab blocking"),(0,n.kt)("li",{parentName:"ul"},"\u6548\u80fd\u554f\u984c\uff1a\u7d93\u6b77\u5169\u6b21\u9060\u7aef\u7684\u547c\u53eb\uff0c\u591a\u6b21\u8cc7\u6599\u6301\u4e45\u5316"),(0,n.kt)("li",{parentName:"ul"},"\u8cc7\u6599\u4e0d\u4e00\u81f4\uff1a\u7576\u7db2\u8def\u7a69\u5b9a\u6027\u548c\u6545\u969c\u6062\u5fa9\u80fd\u529b\u7684\u5047\u8a2d\u4e0d\u6210\u7acb\u6642\uff0c\u4ecd\u53ef\u80fd\u51fa\u73fe\u4e00\u81f4\u6027\u554f\u984c")),(0,n.kt)("h3",{id:"\u4e09\u6bb5\u5f0f\u63d0\u4ea43-phase-commitment-3pc"},"\u4e09\u6bb5\u5f0f\u63d0\u4ea4(3 Phase Commitment; 3PC)"),(0,n.kt)("p",null,"\u91dd\u5c0d 2PC \u63d0\u51fa\u7684\u6539\u9032\u65b9\u6848\u3002"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u300c\u6e96\u5099\u968e\u6bb5\u300d=> ",(0,n.kt)("inlineCode",{parentName:"li"},"CanCommit"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"PreCommit")," \u968e\u6bb5"),(0,n.kt)("li",{parentName:"ul"},"\u300c\u63d0\u4ea4\u968e\u6bb5\u300d => ",(0,n.kt)("inlineCode",{parentName:"li"},"DoCommit")," \u968e\u6bb5")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"3 Phase Commitment",src:a(88750).Z,width:"702",height:"564"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"CanCommit"),": \u985e\u4f3c\u65bc 2PC \u7684\u6295\u7968\u968e\u6bb5"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"PreCommit"),": \u6839\u64da\u53c3\u8207\u8005\u7684\u7b54\u8986\uff0c\u6c7a\u5b9a\u9810\u5099\u7684 TX\u3002"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"DoCommit"),": \u539f 2PC \u7684\u63d0\u4ea4\u968e\u6bb5")),(0,n.kt)("p",null,"\u7f3a\u9ede\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u4f9d\u820a\u6c92\u6709\u89e3\u6c7a 2PC \u8cc7\u6599\u4e0d\u4e00\u81f4\u7684\u554f\u984c"),(0,n.kt)("li",{parentName:"ul"},"\u8655\u7406\u6642\u9593\u4e5f\u5ef6\u9072\u4e86(\u591a\u4e86\u4e00\u500b ",(0,n.kt)("inlineCode",{parentName:"li"},"PreCommit")," \u968e\u6bb5)")),(0,n.kt)("h3",{id:"\u5c0f\u7bc0"},"\u5c0f\u7bc0\uff1a"),(0,n.kt)("p",null,"\u5169\u500b\u6f14\u7b97\u6cd5\u90fd\u662f\u70ba\u4e86\u80fd\u9054\u5230\u300c\u5f37\u4e00\u81f4\u6027\u300d\u7684\u6a19\u6e96\u800c\u8a2d\u8a08\uff0c\u90fd\u4e0d\u662f\u5f88\u5b8c\u7f8e\uff0c\u4ecd\u7121\u6cd5\u5b8c\u5168\u6eff\u8db3\u5206\u6563\u5f0f\u4ea4\u6613\u6240\u9700\u8981\u7684\u300c\u4e00\u81f4\u6027\u300d\u3001\n\u300c\u53ef\u7528\u6027\u300d\u3002"),(0,n.kt)("h2",{id:"33-\u5171\u4eab\u4ea4\u6613-share-transaction"},"3.3 \u5171\u4eab\u4ea4\u6613 (Share Transaction)"),(0,n.kt)("p",null,"\u591a\u500b\u670d\u52d9\u4e4b\u9593\u6703\u7522\u751f\u696d\u52d9\u908f\u8f2f\u6703\u6709\u4ea4\u96c6\uff0c\u76f4\u63a5\u8b93\u5404\u500b\u670d\u52d9\u5171\u4eab\u540c\u500b\u8cc7\u6599\u5eab\u3002"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"\u5171\u4eab\u4ea4\u6613",src:a(5207).Z,width:"435",height:"289"})),(0,n.kt)("h2",{id:"34-\u5206\u6563\u5f0f\u4ea4\u6613-distributed-transaction"},"3.4 \u5206\u6563\u5f0f\u4ea4\u6613 (Distributed Transaction)"),(0,n.kt)("p",null,"\u8cc7\u6599\u5eab\u6b63\u5f0f\u9081\u5165\u5206\u6563\u5f0f\u7684\u7cfb\u7d71\u67b6\u69cb\u3002\n",(0,n.kt)("img",{alt:"Distributed Transaction",src:a(64265).Z,width:"1225",height:"341"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u6311\u6230\uff1a \u591a\u500b\u7bc0\u9ede\u7684\u8cc7\u6599\u5206\u5340\u3001\u8de8\u7bc0\u9ede\u4f5c\u8cc7\u6599\u540c\u6b65")),(0,n.kt)("h3",{id:"cap-\u5b9a\u7406"},"CAP \u5b9a\u7406"),(0,n.kt)("p",null,"\u5206\u6563\u5f0f\u8a08\u7b97\u9818\u57df\u6240\u516c\u8a8d\u7684\u8457\u540d\u5b9a\u7406 - ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/CAP_theorem"},"CAP \u7406\u8ad6"),"\u6e90\u81ea Eric Brewer ",(0,n.kt)("a",{parentName:"p",href:"https://users.ece.cmu.edu/~adrian/731-sp04/readings/GL-cap.pdf"},"\u8ad6\u6587"),"\u3002"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"CAP",src:a(61386).Z,width:"220",height:"207"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u5206\u6563\u5f0f\u7cfb\u7d71\u88e1\uff0c\u4e00\u81f4\u6027(Consistence)\u3001\u53ef\u7528\u6027(Availability)\u3001\u5206\u5340\u5bb9\u932f\u6027(Partition Tolerance)\u4e09\u8005\u4e2d\u7684\u5169\u500b\uff0c\u53e6\u5916\u4e00\u500b\u5fc5\u9808\u88ab\u72a7\u7272\u3002")),(0,n.kt)("h4",{id:"\u4e00\u81f4\u6027-consistency"},"\u4e00\u81f4\u6027 (",(0,n.kt)("strong",{parentName:"h4"},"C"),"onsistency)"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"*\u5f37\u4e00\u81f4\u6027\uff1a\u8b80\u5230\u7684\u8cc7\u6599\u300c\u7e3d\u662f\u300d\u6700\u65b0\u7684 e.g. \u9280\u884c\u7cfb\u7d71"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u7d42\u4e00\u81f4\u6027\uff1a\u5728\u4e00\u6bb5\u6642\u9593\u5f8c\uff0c\u8cc7\u6599\u6703\u6700\u7d42\u9054\u5230\u4e00\u81f4\u72c0\u614b e.g. DNS \u7cfb\u7d71")),(0,n.kt)("h4",{id:"\u53ef\u7528\u6027-availability"},"\u53ef\u7528\u6027 (",(0,n.kt)("strong",{parentName:"h4"},"A"),"vailability)"),(0,n.kt)("p",null,"\u7cfb\u7d71\u4e0d\u9593\u65b7\u5730\u63d0\u4f9b\u670d\u52d9\u7684\u80fd\u529b e.g. SLA"),(0,n.kt)("p",null,"\u5ba2\u6236\u7aef\u5728\u53ef\u7528\u7684\u6642\u9593\u7bc4\u570d\u4e4b\u5167\uff0c\u76e1\u529b\u63d0\u4f9b\u670d\u52d9\u3002"),(0,n.kt)("p",null,"\u5197\u9918(Redundant) \u7b56\u7565\uff1a \u63d0\u4f9b 2+ \u4ee5\u4e0a\u7684\u7bc0\u9ede"),(0,n.kt)("h4",{id:"\u5206\u5340\u5bb9\u932f-partition-tolerance"},"\u5206\u5340\u5bb9\u932f (",(0,n.kt)("strong",{parentName:"h4"},"P"),"artition tolerance)"),(0,n.kt)("p",null,"\u4efb\u610f\u6578\u91cf\u7684\u7bc0\u9ede\u9593\u7db2\u8def\u51fa\u73fe\u554f\u984c\uff0c\u7cfb\u7d71\u4ecd\u80fd\u5920\u6301\u7e8c\u904b\u4f5c\u3002"),(0,n.kt)("p",null,"\u5206\u5340:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u7bc0\u9ede\u5728\u4e0d\u540c\u5730\u7406\u4f4d\u7f6e"),(0,n.kt)("li",{parentName:"ul"},"\u7bc0\u9ede\u5728\u540c\u500b\u5730\u7406\u4f4d\u7f6e\u7684\u5340\u57df\u7db2\u8def"),(0,n.kt)("li",{parentName:"ul"},"\u7bc0\u9ede\u5728\u4e0d\u540c\u5730\u7406\u4f4d\u7f6e\uff0c\u4f46\u5c6c\u65bc\u5167\u7db2\u67b6\u69cb")),(0,n.kt)("p",null,"\u6bd4\u8f03\u500b\u5225\u6368\u68c4 C\u3001A\u3001P \u6642\u6240\u5e36\u4f86\u7684\u5f71\u97ff"),(0,n.kt)("h3",{id:"ca\u6368\u68c4-p"},"CA\uff0c\u6368\u68c4 P"),(0,n.kt)("p",null,"\u653e\u68c4\u5206\u5340\u5bb9\u932f\uff0c\u7b49\u65bc\u4e0d\u8003\u616e\u5206\u6563\u5f0f\u7cfb\u7d71\u67b6\u69cb\u3002"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u55ae\u6a5f\u8cc7\u6599\u5eab\u4e0b\u5f15\u9032 CAP \u5b9a\u7406\u4f3c\u4e4e\u6c92\u592a\u5927\u610f\u7fa9\uff1f\u975e\u7368\u7acb\u7684\u9078\u64c7\u689d\u4ef6")),(0,n.kt)("h3",{id:"cp\u6368\u68c4-a"},"CP\uff0c\u6368\u68c4 A"),(0,n.kt)("p",null,"\u95dc\u6ce8\u8cc7\u6599\u7684\u300c\u5f37\u4e00\u81f4\u6027\u300d\uff0c\u6eff\u8db3\u4e00\u81f4\u6027(C)\u3001\u5206\u5340\u5bb9\u932f\u6027(P)\uff0c\u7528\u65bc\u5c0d\u8cc7\u6599\u54c1\u8cea\u8981\u6c42\u5f88\u9ad8\u7684\u5834\u57df\u3002"),(0,n.kt)("h3",{id:"ap\u6368\u68c4-c"},"AP\uff0c\u6368\u68c4 C"),(0,n.kt)("p",null,"\u95dc\u6ce8\u8cc7\u6599\u7684\u300c\u53ef\u7528\u6027\u300da.k.a. \u6c34\u5e73\u64f4\u5c55\uff0c\u6eff\u8db3\u53ef\u7528\u6027(A)\u3001\u5206\u5340\u5bb9\u932f\u6027(P)"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u53d6\u5f97\u5e73\u8861\u7684\u8a2d\u8a08:"),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"\u4e0d\u8ffd\u6c42\u300c\u5f37\u4e00\u81f4\u6027\u300d\uff0c\u63a1\u7528\u300c\u6700\u7d42\u4e00\u81f4\u6027\u300d => \u9069\u5408\u8cc7\u6599\u66f4\u65b0\u5bb9\u8a31\u4e00\u9ede\u5ef6\u9072\u7684\u5834\u5408"),(0,n.kt)("li",{parentName:"ul"},"\u73fe\u5be6\u8a2d\u8a08\u7684\u7cfb\u7d71\u53ef\u653e\u5bec\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u6a19\u6e96"))),(0,n.kt)("admonition",{title:"Discussion",type:"info"},(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"CAP \u4e2d\u7684 Consistency vs. ACID \u4e2d\u7684 Consistency"),(0,n.kt)("li",{parentName:"ul"},"CAP \u7406\u8ad6\u843d\u5730\u5be6\u8e10\u7684\u7d30\u7bc0"))),(0,n.kt)("p",null,"\u88dc\u5145\u8cc7\u6599\uff1a",(0,n.kt)("a",{parentName:"p",href:"https://github.com/henryr/cap-faq"},"CAP-FAQ")),(0,n.kt)("h3",{id:"\u53ef\u9760\u4e8b\u4ef6\u968a\u5217"},"\u53ef\u9760\u4e8b\u4ef6\u968a\u5217"),(0,n.kt)("p",null,"\u300c\u6700\u7d42\u4e00\u81f4\u6027\u7684\u6982\u5ff5\u300d\u6e90\u81ea Dan Pritchett \u767c\u8868\u7684\u8ad6\u6587 - ",(0,n.kt)("a",{parentName:"p",href:"https://queue.acm.org/detail.cfm?id=1394128"},"Base: An Acid Alternative")),(0,n.kt)("p",null,"BASE \u5206\u5225\u662f\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u57fa\u672c\u53ef\u7528\u6027(",(0,n.kt)("strong",{parentName:"li"},"B"),"asically ",(0,n.kt)("strong",{parentName:"li"},"A"),"vailable)\uff1a\u5206\u6563\u5f0f\u7cfb\u7d71\u5728\u51fa\u73fe\u6545\u969c\u6642\uff0c\u4fdd\u8b49\u6838\u5fc3\u53ef\u7528"),(0,n.kt)("li",{parentName:"ul"},"\u8edf\u72c0\u614b(",(0,n.kt)("strong",{parentName:"li"},"S"),"oft State)\uff1a\u5141\u8a31\u7cfb\u7d71\u5b58\u5728\u4e2d\u9593\u72c0\u614b\uff0c\u800c\u8a72\u4e2d\u9593\u72c0\u614b\u4e0d\u6703\u5f71\u97ff\u7cfb\u7d71\u6574\u9ad4\u53ef\u7528\u6027"),(0,n.kt)("li",{parentName:"ul"},"\u6700\u7d42\u4e00\u81f4\u6027(",(0,n.kt)("strong",{parentName:"li"},"E"),"ventually Consistent)\uff1a\u5728\u4e00\u6bb5\u6642\u9593\u5f8c\uff0c\u8cc7\u6599\u6703\u6700\u7d42\u9054\u5230\u4e00\u81f4\u72c0\u614b")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u5c0d CAP \u7684\u5ef6\u4f38\u548c\u88dc\u5145\uff0c\u5373\u4fbf\u7121\u6cd5\u9054\u6210\u5f37\u4e00\u81f4\u6027\uff0c\u4f46\u63a1\u7528\u5408\u9069\u7684\u65b9\u6cd5\u9054\u5230\u6700\u7d42\u4e00\u81f4\u6027")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"\u53ef\u9760\u4e8b\u4ef6\u968a\u5217",src:a(80995).Z,width:"982",height:"766"})),(0,n.kt)("p",null,"\u5ef6\u4f38\uff1a ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Best-effort_delivery"},"\u6700\u5927\u52aa\u529b\u4ea4\u4ed8(Best-effort delivery)")," e.g. TCP \u5354\u8b70"),(0,n.kt)("h3",{id:"tcc-\u4ea4\u6613"},"TCC \u4ea4\u6613"),(0,n.kt)("p",null,"\u53ef\u9760\u6d88\u606f\u968a\u5217\u96d6\u4fdd\u8b49\u6700\u7d42\u7684\u7d50\u679c\u76f8\u5c0d\u53ef\u9760\uff0c\u4f46\u6574\u500b\u904e\u7a0b\u5b8c\u5168\u6c92\u6709\u4efb\u4f55\u9694\u96e2\u6027\uff0cTCC \u89e3\u6c7a\u7f3a\u4e4f\u9694\u96e2\u6027\u5e36\u4f86\u7684\u554f\u984c\u3002"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"Try"),"\uff1a\u5617\u8a66\u57f7\u884c\u968e\u6bb5\uff0c\u5b8c\u6210\u6240\u6709\u696d\u52d9\u53ef\u57f7\u884c\u6027\u7684\u6aa2\u67e5\uff0c\u4e26\u4e14\u9810\u7559\u597d\u5168\u90e8\u9700\u7528\u5230\u7684\u696d\u52d9\u8cc7\u6e90\u3002"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"Confirm"),"\uff1a\u78ba\u8a8d\u57f7\u884c\u968e\u6bb5\uff0c\u4e0d\u505a\u4efb\u4f55\u696d\u52d9\u6aa2\u67e5\uff0c\u76f4\u63a5\u4f7f\u7528 ",(0,n.kt)("inlineCode",{parentName:"li"},"Try")," \u968e\u6bb5\u6e96\u5099\u7684\u8cc7\u6e90\u4f86\u5b8c\u6210\u696d\u52d9\u8655\u7406\u3002"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"Cancel"),"\uff1a\u53d6\u6d88\u57f7\u884c\u968e\u6bb5\uff0c\u91cb\u653e ",(0,n.kt)("inlineCode",{parentName:"li"},"Try")," \u968e\u6bb5\u9810\u7559\u7684\u696d\u52d9\u8cc7\u6e90\u3002 ")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"TCC - Try")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"TCC-Try",src:a(79534).Z,width:"531",height:"232"})),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"TCC - Confirm")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"TCC-Try",src:a(67154).Z,width:"531",height:"235"})),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"http://icyfenix.cn/architect-perspective/general-architecture/transaction/distributed.html#tcc-%E4%BA%8B%E5%8A%A1"},"\u57163-8 TCC \u7684\u57f7\u884c\u904e\u7a0b")),(0,n.kt)("h3",{id:"saga-\u4ea4\u6613"},"SAGA \u4ea4\u6613"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"\u5c07\u5927\u7684 TX \u62c6\u6210\u591a\u500b\u5c0f\u7684 TX\uff0c\u9069\u7528\u5728\u9577\u6642\u9593\u4ea4\u6613(long running transactions)\uff0c\u3002")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u5927 TX \u62c6\u6210\u82e5\u5e72\u500b\u5c0f TXs\uff0c\u6309\u9806\u5e8f\u9032\u884c\u63d0\u4ea4 -> Ti"),(0,n.kt)("li",{parentName:"ul"},"\u66ff\u6bcf\u4e00\u500b\u5c0f\u7684 TX \u8a2d\u8a08\u88dc\u511f\u6a5f\u5236 -> Ci")),(0,n.kt)("p",null,"\u82e5\u6240\u6709\u5c0f\u7684 TX \u672a\u5b8c\u6574\u6210\u529f\u63d0\u4ea4\uff0c\u4fbf\u555f\u52d5\u6062\u5fa9\u6a5f\u5236\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u6b63\u5411\u6062\u5fa9(Forward Recovery): TX\u63d0\u4ea4\u5931\u6557\uff0c\u5247\u4e00\u76f4\u5c0dTX\u9032\u884c\u300c\u91cd\u8a66\u300d\uff0c\u76f4\u5230\u6210\u529f\u70ba\u6b62; T1,T2....Ti(\u5931\u6557),Ti(\u91cd\u8a66)....Ti+1....Tn"),(0,n.kt)("li",{parentName:"ul"},"\u53cd\u5411\u6062\u5fa9(Backward Recovery): TX \u63d0\u4ea4\u5931\u6557\uff0c\u5247\u4e00\u76f4\u57f7\u884c Ci \u5c0d Ti \u9032\u884c\u300c\u88dc\u511f\u300d\uff0c\u76f4\u5230\u6210\u529f\u70ba\u6b62; T1,T2....Ti(\u5931\u6557),Ci(\u88dc\u511f)...,C2,C1\u3002")),(0,n.kt)("p",null,"\u8003\u91cf\u5230\u672c\u8eab\u53ef\u80fd\u6703\u5d29\u6f70\uff0c\u8a2d\u8a08\u65e5\u8a8c\u6a5f\u5236(a.k.a SAGA Log)\u4ee5\u4fdd\u8b49\u7cfb\u7d71\u6062\u5fa9\u5f8c\u80fd\u8ffd\u8e64\u5230\u5c0f\u7684 TX \u7684\u57f7\u884c\u60c5\u6cc1\u3002"),(0,n.kt)("h3",{id:"\u7e3d\u7d50"},"\u7e3d\u7d50\uff1a"),(0,n.kt)("p",null,"\u5206\u6563\u5f0f\u4ea4\u6613\u4e2d\u6c92\u6709\u4e00\u62db\u6253\u5929\u4e0b\u7684\u89e3\u6c7a\u8fa6\u6cd5\uff0c\u8a55\u4f30\u7576\u4e0b\u7684\u60c5\u5883\uff0c\u9078\u7528\u5408\u9069\u7684 TX \u8655\u7406\u65b9\u6848\u624d\u662f\u6709\u6548\u7684\u505a\u6cd5"))}m.isMDXComponent=!0},85077:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/2PL-2019da103259ba85164fd84b773ff67a.png"},63649:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ACID-Lost-updates-57d242d020c2751ad9a29124a8487b92.gif"},87981:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ACID-Non-repeatable-read-f1aee4b6867e2b1fb17754d90bc3b2fb.gif"},6783:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ACID-Phantom-read-a7656992f83a133d4e21cde8ac7c7ec2.gif"},19488:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ACID-TX-2c899cc95345a70375ad6ce20fd59c34.gif"},85626:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ACID-dirty-read-6e170abc37c2423806ee9a1ab46420e9.gif"},48964:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/PG-Transaction-Isolation-Levels-76977fa3161757a8902bab9989fd3358.png"},91805:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-1-2-da5a5ef800b687ea343ed141ed72d5ed.png"},41463:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-2-1-15d52c2fe9f5b4625bc94ed9b50d516d.png"},92022:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-2-2-cb0b6f3d8f024a6bb35175abfda80ae9.png"},88750:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-2-3-a1e20fafb1da193c65711abdb10b42d3.png"},5207:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-3-1145a44ad760fd91ecfb59ff3f8430a1.png"},64265:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-4-1-89f2d10c2f09b0ee0d1425219a4e1eaa.png"},61386:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-4-2-04ff3f9b966ff7b95f10001f26f62415.png"},80995:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-4-3-3fb5b6ea3fecd8cce600f09b60c5a5c6.png"},79534:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-4-4-5c0ebc6ad41d096d58ea66641a5b4bcd.png"},67154:(t,e,a)=>{a.d(e,{Z:()=>l});const l=a.p+"assets/images/ch3-4-5-091be71f0a495c464cedad45f1a5039e.png"}}]);